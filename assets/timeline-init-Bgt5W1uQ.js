import{m as d,b as c,U as m,d as p,p as f}from"./index-DQ-9F6AZ.js";const y=e=>{const i=document.getElementById("timeline-strip"),s=document.getElementById("timeline-wrapper");i.style.width=`${i.clientWidth+e}px`,s.style.width=`${s.clientWidth+e}px`},o=(e=0)=>{const i=document.getElementById("timeline-strip");for(let s=e>0?i.clientWidth-e:0;s<=i.clientWidth;s+=e>0?1:50)if(s%200===0||s%50===0){const l=document.getElementById(`tickbase-${s}`)||document.createElement("div");l.setAttribute("id",`tickbase-${s}`),l.classList.add("tickbase"),l.style.left=`${s}px`,s%200===0?(l.classList.add("boom"),l.innerHTML=`<small style="transform:translateX(-50%);position:absolute;" >${p(f(s))}</small>`):s%50===0&&l.classList.add("tick"),i.appendChild(l)}};d("timeline-width-adjust",{onMoveCb:e=>{const i=document.getElementById("timeline-header");i.style.width=`${e.clientX}px`}});d("timeline-height-adjust",{onMoveCb:e=>{const i=document.getElementById("workspace");i.style.height=`${e.clientY}px`,window.editor.myProject.recalculateCanvasSize()}});const a=document.getElementById("timeline-cursor");o();const t=document.getElementById("timeline"),g=document.getElementById("timeline-strip");t.dataset.prevScrollLeft="0";t.dataset.prevScrollTop="0";t.addEventListener("pointermove",e=>{if(a&&a.dataset.trimming==="false"&&["timeline","timeline-strip"].includes(e.target.id)){a.style.visibility="visible",t.setPointerCapture(e.pointerId);let i=t.scrollLeft+e.offsetX;e.target.id==="timeline-strip"&&(i-=g.clientWidth-t.clientWidth+(t.scrollLeft-+t.dataset.prevScrollLeft)),a.style.left=`${i}px`}else a.style.visibility="hidden"});t.addEventListener("scroll",()=>{t.scrollTop-+t.dataset.prevScrollTop>0&&(a.style.top=`${t.scrollTop}px`);const e=t.scrollLeft-+t.dataset.prevScrollLeft;e>0&&(y(e),o(e),t.dataset.prevScrollLeft=t.scrollLeft.toString())});t.addEventListener("dragover",e=>{e.preventDefault(),document.activeElement&&document.activeElement.classList.contains("file-item")&&(a.style.left=`${t.scrollLeft+e.offsetX}px`,t.classList.add("dragover"))});t.addEventListener("drop",async e=>{var n,r;if(e.preventDefault(),((n=e.dataTransfer)==null?void 0:n.getData("dragtype"))!=="file-item")return;window.editor.playHead.positionPx(c(a.style.left));const s=(r=e.dataTransfer)==null?void 0:r.getData("primaryKey"),{data:l}=await m.findById(s);window.editor.myProject.insertNodeFromFile(l),t.classList.remove("dragover")});t.addEventListener("dragleave",()=>{t.classList.remove("dragover")});window.addEventListener("resize",()=>{o(),window.editor.myProject.recalculateCanvasSize()});window.editor.myProject.stage.on("pointerdown",e=>{e.target===window.editor.myProject.stage&&window.editor.myProject.nodes.forEach(i=>{i.transformerBlur()})});
