const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-5DIdEHWt.js","assets/index-DyclTqX8.css"])))=>i.map(i=>d[i]);
var zs=Object.defineProperty;var Di=s=>{throw TypeError(s)};var Xs=(s,t,u)=>t in s?zs(s,t,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[t]=u;var $=(s,t,u)=>Xs(s,typeof t!="symbol"?t+"":t,u),mi=(s,t,u)=>t.has(s)||Di("Cannot "+u);var Z=(s,t,u)=>(mi(s,t,"read from private field"),u?u.call(s):t.get(s)),dt=(s,t,u)=>t.has(s)?Di("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,u),ct=(s,t,u,f)=>(mi(s,t,"write to private field"),f?f.call(s,u):t.set(s,u),u),q=(s,t,u)=>(mi(s,t,"access private method"),u);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))f(m);new MutationObserver(m=>{for(const o of m)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&f(n)}).observe(document,{childList:!0,subtree:!0});function u(m){const o={};return m.integrity&&(o.integrity=m.integrity),m.referrerPolicy&&(o.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?o.credentials="include":m.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function f(m){if(m.ep)return;m.ep=!0;const o=u(m);fetch(m.href,o)}})();/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=([s,t,u])=>{const f=document.createElementNS("http://www.w3.org/2000/svg",s);return Object.keys(t).forEach(m=>{f.setAttribute(m,String(t[m]))}),u!=null&&u.length&&u.forEach(m=>{const o=Jn(m);f.appendChild(o)}),f},$e=(s,t={})=>{const u="svg",f={...$n,...t};return Jn([u,f,s])};/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=s=>Array.from(s.attributes).reduce((t,u)=>(t[u.name]=u.value,t),{}),Ys=s=>typeof s=="string"?s:!s||!s.class?"":s.class&&typeof s.class=="string"?s.class.split(" "):s.class&&Array.isArray(s.class)?s.class:"",Ks=s=>s.flatMap(Ys).map(u=>u.trim()).filter(Boolean).filter((u,f,m)=>m.indexOf(u)===f).join(" "),qs=s=>s.replace(/(\w)(\w*)(_|-|\s*)/g,(t,u,f)=>u.toUpperCase()+f.toLowerCase()),Vi=(s,{nameAttr:t,icons:u,attrs:f})=>{var v;const m=s.getAttribute(t);if(m==null)return;const o=qs(m),n=u[o];if(!n)return console.warn(`${s.outerHTML} icon name was not found in the provided icons object.`);const i=js(s),c={...$n,"data-lucide":m,...f,...i},l=Ks(["lucide",`lucide-${m}`,i,f]);l&&Object.assign(c,{class:l});const g=$e(n,c);return(v=s.parentNode)==null?void 0:v.replaceChild(g,s)};/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"m18 9-6-6-6 6"}],["path",{d:"M12 3v14"}],["path",{d:"M5 21h14"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["path",{d:"m15 18-.722-3.25"}],["path",{d:"M2 8a10.645 10.645 0 0 0 20 0"}],["path",{d:"m20 15-1.726-2.05"}],["path",{d:"m4 15 1.726-2.05"}],["path",{d:"m9 18 .722-3.25"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=[["path",{d:"m9 10 3-3 3 3"}],["path",{d:"M12 13V7"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2"}],["path",{d:"M12 17v4"}],["path",{d:"M8 21h8"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=[["rect",{width:"12",height:"20",x:"6",y:"2",rx:"2"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["path",{d:"M16 9a5 5 0 0 1 0 6"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=[["path",{d:"M16 9a5 5 0 0 1 .95 2.293"}],["path",{d:"M19.364 5.636a9 9 0 0 1 1.889 9.96"}],["path",{d:"m2 2 20 20"}],["path",{d:"m7 7-.587.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298V11"}],["path",{d:"M9.828 4.172A.686.686 0 0 1 11 4.657v.686"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=({icons:s={},nameAttr:t="data-lucide",attrs:u={}}={})=>{if(!Object.values(s).length)throw new Error(`Please provide an icons object.
If you want to use all the icons you can import it like:
 \`import { createIcons, icons } from 'lucide';
lucide.createIcons({icons});\``);if(typeof document>"u")throw new Error("`createIcons()` only works in a browser environment.");const f=document.querySelectorAll(`[${t}]`);if(Array.from(f).forEach(m=>Vi(m,{nameAttr:t,icons:s,attrs:u})),t==="data-lucide"){const m=document.querySelectorAll("[icon-name]");m.length>0&&(console.warn("[Lucide] Some icons were found with the now deprecated icon-name attribute. These will still be replaced for backwards compatibility, but will no longer be supported in v1.0 and you should switch to data-lucide"),Array.from(m).forEach(o=>Vi(o,{nameAttr:"icon-name",icons:s,attrs:u})))}};lr({icons:{MonitorUp:er,Wrench:hr,X:es,Play:ts,Pause:Qn,ArrowUpFromLine:Zs,Save:sr}});window.blobUrls={};const dr="modulepreload",cr=function(s){return"/ratreel-web/"+s},Ui={},Ii=function(t,u,f){let m=Promise.resolve();if(u&&u.length>0){let n=function(l){return Promise.all(l.map(g=>Promise.resolve(g).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));m=n(u.map(l=>{if(l=cr(l),l in Ui)return;Ui[l]=!0;const g=l.endsWith(".css"),v=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${v}`))return;const C=document.createElement("link");if(C.rel=g?"stylesheet":dr,g||(C.as="script"),C.crossOrigin="",C.href=l,c&&C.setAttribute("nonce",c),document.head.appendChild(C),g)return new Promise((d,a)=>{C.addEventListener("load",d),C.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(n){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n}return m.then(n=>{for(const i of n||[])i.status==="rejected"&&o(i.reason);return t().catch(o)})},ur=s=>{var t;for(const u in s.children)(t=document.getElementById(u))==null||t.classList.add("disable-pointer-event")},Hi=s=>{var t;for(const u in s.children)(t=document.getElementById(u))==null||t.classList.remove("disable-pointer-event")},gr=s=>{var t;(t=document.getElementById(s.parentElement.id))==null||t.classList.add("disable-pointer-event")},fr=s=>{var t;(t=document.getElementById(s.parentElement.id))==null||t.classList.remove("disable-pointer-event")},Sa=(s,{onDownCb:t=()=>{},onMoveCb:u=()=>{},onUpCb:f=()=>{}})=>{const m=s instanceof HTMLDivElement?s:document.getElementById(s);m.addEventListener("pointerdown",o=>{m.setPointerCapture(o.pointerId),t(o),m.addEventListener("pointermove",u),m.addEventListener("pointerup",n=>{m.releasePointerCapture(n.pointerId),f(n),m.removeEventListener("pointermove",u)})})},Pi=s=>new Date(s*1e3).toISOString().substring(11,19),mr=s=>document.querySelectorAll(s).forEach(t=>{t.classList.add("enable-pointer-event")}),pr=s=>document.querySelectorAll(s).forEach(t=>{t.classList.remove("enable-pointer-event")}),Jt=s=>+s.slice(0,-2),Ct=s=>+s.toFixed(2),wa=async s=>await(await fetch(s)).blob(),di=()=>crypto.randomUUID().split("-").slice(-1)[0],is=(s,t)=>{const u=(n,i)=>i===0?n:u(i,n%i),f=u(s,t),m=s/f,o=t/f;return{aspectRatio:m/o,orientation:m<=o?"POTRAIT":"LANDSCAPE"}},xi=[];var bt,ns,ss,$t;class ci{constructor(t){dt(this,bt);$(this,"collectionName");this.collectionName=t,xi.push(t)}findById(t){return q(this,bt,$t).call(this,u=>u.get(t),"readonly")}create(t,u){return q(this,bt,$t).call(this,f=>f.add(t,u),"readwrite")}update(t,u){return q(this,bt,$t).call(this,f=>f.put(t,u),"readwrite")}deleteById(t){return q(this,bt,$t).call(this,u=>u.delete(t),"readwrite")}getAllKeys(){return q(this,bt,$t).call(this,t=>t.getAllKeys(),"readwrite")}findAll(t){return q(this,bt,$t).call(this,u=>u.openCursor(t),"readwrite",!0)}}bt=new WeakSet,ns=function(t="failed"){const u={success:!1,status:t};return console.error(u),u},ss=function(t="success",u){return{success:!0,status:t,data:u}},$t=function(t,u,f=!1){return new Promise((m,o)=>{if(ti.isConnected&&ti.db){const n=ti.db.transaction(this.collectionName,u),i=n.objectStore(this.collectionName),c=t(i),l={};c.onsuccess=g=>{if(f){const v=g.target.result;v&&(l[v.primaryKey]=v.value,v.continue())}},n.oncomplete=()=>{const g=q(this,bt,ss).call(this,"transaction success",f?l:c.result);m(g)},n.onerror=()=>{const g=q(this,bt,ns).call(this,c.error);o(g)}}else o({success:!1,status:"MyDB not connected"})})};const Je=new ci("fileChunks");Je.saveFile=async s=>{const t=[],f=di(),m=Math.ceil(s.size/1048576);for(let o=0;o<m;o++)try{const n=o*1048576,i=Math.min(n+1048576,s.size),c=await s.slice(n,i).arrayBuffer(),{data:l}=await Je.create(c,`${f}-${o}`);t.push(l)}catch(n){console.error(n)}return t};Je.getFile=async s=>{const u=(await Promise.all(s.map(f=>Je.findById(f)))).map(({data:f})=>f&&new Blob([f]));return new Blob(u,{type:u[0].type})};const rs=new ci("myProject"),Ze=new ci("tempExportedChunks");Ze.saveChunk=async s=>{await Ze.create(s)};Ze.getFile=async()=>{const{data:s}=await Ze.findAll(),t=Object.values(s).map(u=>u&&new Blob([u]));return Ze.deleteById(IDBKeyRange.lowerBound(0)),new Blob(t,{type:t[0].type})};const Aa=new ci("uploadedFiles");var ai,as;class yr{constructor(){dt(this,ai);$(this,"db");$(this,"isConnected");this.isConnected=!1}async connect(t,u=1){return new Promise((f,m)=>{const o=window.indexedDB.open(t,u);o.onerror=()=>{this.isConnected=!1,m({data:void 0,success:this.isConnected,status:"connection failed"})},o.onupgradeneeded=n=>{this.db=o.result,console.log("versions",n==null?void 0:n.newVersion,n==null?void 0:n.oldVersion,xi),(n==null?void 0:n.newVersion)===9999&&(console.log("RESET DB"),q(this,ai,as).call(this)),xi.forEach(i=>{this.db.objectStoreNames.contains(i)||(this.db.createObjectStore(i,{autoIncrement:!0}),console.log(i," collection added"))})},o.onsuccess=()=>{this.isConnected=!0,this.db=o.result,f({data:this.db,success:this.isConnected,status:"connection success"})}})}}ai=new WeakSet,as=function(){for(const t of this.db.objectStoreNames)this.db.deleteObjectStore(t),console.log(t," collection deleted")};const ti=new yr;var mt,Ht,os,hs,Ri;class _r{constructor(){dt(this,Ht);dt(this,mt);$(this,"persistW");ct(this,mt,document.getElementById("context-menu")),this.persistW=125,Z(this,mt).style.width=`${this.persistW}px`,q(this,Ht,os).call(this)}open(t,u,f){q(this,Ht,Ri).call(this);const m=10;return Z(this,mt).style.left=`${u+this.persistW-window.innerWidth>=0?u-(this.persistW+m):u+m}px`,window.innerHeight-(f-m+this.persistW)<=0?(Z(this,mt).style.bottom="10px",Z(this,mt).style.top="unset"):(Z(this,mt).style.top=`${f-m}px`,Z(this,mt).style.bottom="unset"),Z(this,mt).style.display="block",t.map(o=>q(this,Ht,hs).call(this,o,di()))}close(){q(this,Ht,Ri).call(this),Z(this,mt).style.display="none"}}mt=new WeakMap,Ht=new WeakSet,os=function(){document.body.addEventListener("pointerdown",t=>{t.target.classList.contains("item")||this.close()})},hs=function({title:t,cb:u,skip:f=!1},m){if(f)return;const o=document.createElement("div");o.addEventListener("click",()=>{Z(this,mt).style.display="none",u&&u()},!1);const n=`${m}-${t}`;return o.classList.add("item"),o.setAttribute("id",n),o.textContent=t,Z(this,mt).appendChild(o),n},Ri=function(){Z(this,mt).innerHTML=""};const ls=new _r,ds=40,vr=5,Ti=1,Yt=10,Qe=5,It=s=>s*ds,Ft=s=>s/ds;var At,Gt,vt,ft,us,gs,fs,ei,ms,ps;class cs{constructor(t){dt(this,ft);$(this,"id",di());$(this,"element");dt(this,At);dt(this,Gt);dt(this,vt);var u;ct(this,Gt,!1),ct(this,vt,!1),ct(this,At,document.createElement("div")),this.element=document.createElement("div"),this.element.setAttribute("id",`timeline-layer-${this.id}`),this.element.classList.add("timeline-layer"),this.element.dataset.timelineLayerContentId=this.id,this.element.dataset.isMuted=Z(this,Gt).toString(),this.element.dataset.isHidden=Z(this,vt).toString();for(const f of t)this.element.appendChild(f);(u=document.getElementById("timeline-content-wrapper"))==null||u.appendChild(this.element),q(this,ft,gs).call(this),q(this,ft,fs).call(this)}setIsProcessing(t){const u=Z(this,At).querySelector(".processing")||document.createElement("div");return t===!0?(u.classList.add("processing"),Z(this,At).appendChild(u)):t===!1&&u&&(u.classList.remove("processing"),u.remove()),u}appendChild(t){this.element.appendChild(t)}delete(){q(this,ft,ei).call(this).forEach(t=>{t.delete()}),this.element.remove(),Z(this,At).remove()}}At=new WeakMap,Gt=new WeakMap,vt=new WeakMap,ft=new WeakSet,us=function(t){const u=document.createElement("div");return u.classList.add("action-wrap"),t.forEach(({title:f,actionCb:m,icon:o})=>{const n=document.createElement("button");n.setAttribute("id",`timeline-layer-head-${this.id}-${f()}`),n.setAttribute("title",f()),n.classList.add("action-item"),n.appendChild($e(o())),n.addEventListener("click",()=>{for(const i of n.children)i.remove();m(),n.setAttribute("title",f()),n.appendChild($e(o()))}),u.appendChild(n)}),u},gs=function(){const t=document.getElementById("timeline-header-layer");Z(this,At).setAttribute("id",`timeline-layer-head-${this.id}`),Z(this,At).classList.add("timeline-layer-head-item");let u=+t.dataset.layerCount;Z(this,At).textContent=`Layer #${u++}`,t.dataset.layerCount=u.toString(),this.element.dataset.layerCount=u.toString();const f=q(this,ft,us).call(this,[{title:()=>"delete",actionCb:()=>this.delete(),icon:()=>es},{title:()=>Z(this,Gt)?"unmute":"mute",actionCb:()=>q(this,ft,ps).call(this),icon:()=>Z(this,Gt)?or:ar},{title:()=>Z(this,vt)?"show":"hide",actionCb:()=>q(this,ft,ms).call(this),icon:()=>Z(this,vt)?$s:Js}]);Z(this,At).appendChild(f);const m=document.getElementById("timeline");m.addEventListener("scroll",()=>{t.style.marginTop=`${-m.scrollTop}px`}),t.appendChild(Z(this,At))},fs=function(){this.element.addEventListener("dragover",t=>{if(t.preventDefault(),Z(this,vt))return;const u=document.getElementById("timeline"),f=document.getElementById("timeline-cursor");f.style.outline="unset",f.style.visibility="hidden";const m=document.getElementById("timeline-header").getBoundingClientRect().width+document.getElementById("timeline-width-adjust").getBoundingClientRect().width;if(document.activeElement&&document.activeElement.draggable&&document.activeElement.classList.contains("timeline-layer-content")){ur(this.element);const o=document.getElementById(document.activeElement.id);if(o){let n=t.clientX-+o.dataset.prevOffsetX+u.scrollLeft-m;Math.floor(n)%Ti===0&&(window.editor.myProject.getTLSnapPoints(o.id).forEach(i=>{const c=Jt(o.style.width),l=n+c;n<=i+Yt&&n>=i-Yt?(n=i,f.style.left=`${i}px`,f.style.outline="solid 2px yellow",f.style.visibility="visible"):l<=i+Yt&&l>=i-Yt&&(n=i-c,f.style.left=`${i}px`,f.style.outline="solid 2px yellow",f.style.visibility="visible")}),o.style.opacity="0.5",o.style.left=`${Math.max(n,0)}px`,this.element.children.namedItem(`${o.id}`)||(this.element.appendChild(o),o.focus()))}}}),this.element.addEventListener("dragleave",t=>{t.preventDefault(),document.activeElement&&Hi(this.element)}),this.element.addEventListener("drop",t=>{var n,i;if(t.preventDefault(),Z(this,vt)||((n=t.dataTransfer)==null?void 0:n.getData("dragtype"))!=="timeline-content")return;const f=document.getElementById((i=t.dataTransfer)==null?void 0:i.getData("clipid")),m=Jt(f.style.left),o=Jt(f.style.width);f.dataset.tlStart=`${Ft(m)}`,f.dataset.tlEnd=`${Ft(o+m)}`,f.style.opacity="unset",this.element.appendChild(f),f.focus(),Hi(this.element)})},ei=function(){const t=[];for(const u of this.element.children)t.push(u.dataset.nodeId);return window.editor.myProject.nodes.filter(({id:u})=>t.includes(u))},ms=function(){ct(this,vt,!Z(this,vt)),q(this,ft,ei).call(this).forEach(t=>{t.toggleHide(Z(this,vt))}),Z(this,vt)?this.element.classList.add("hide"):this.element.classList.remove("hide"),this.element.dataset.isHidden=Z(this,vt).toString()},ps=function(){ct(this,Gt,!Z(this,Gt)),q(this,ft,ei).call(this).forEach(t=>{t.toggleMute(Z(this,Gt))}),this.element.dataset.isMuted=Z(this,Gt).toString()};var Nt,ys,_s,vs,Cs;class Cr{constructor(t,u,f,m){dt(this,Nt);$(this,"id");$(this,"element");$(this,"duration");$(this,"trimLeft");$(this,"trimRight");$(this,"tlLayerParent");this.id=t,this.duration=u&&(u instanceof HTMLVideoElement||u instanceof HTMLAudioElement)&&u.duration||vr,this.element=document.createElement("div"),this.element.setAttribute("id",`timeline-layer-content-${this.id}`),this.element.setAttribute("tabindex","0"),this.element.setAttribute("draggable","true"),this.element.classList.add("timeline-layer-content"),this.element.style.backgroundColor=`rgb(${Math.random()*100},${Math.random()*100},${Math.random()*100})`,this.element.dataset.nodeId=this.id,f?q(this,Nt,_s).call(this,f):(q(this,Nt,ys).call(this),this.element.style.left=`${window.editor.playHead.positionPx()}px`,this.element.style.width=`${It(this.duration)}px`),m?(m.appendChild(this.element),this.tlLayerParent=m):this.tlLayerParent=new cs([this.element]),this.trimLeft=new Wi(this,"pretrim"),this.trimRight=new Wi(this,"posttrim"),q(this,Nt,Cs).call(this)}dataset(t,u){return u&&(this.element.dataset[t]=u),this.element.dataset[t]}getAllDataset(){const t={};return Object.entries(this.element.dataset).forEach(([u,f])=>{["nodeId","prevOffsetX"].includes(u)||(t[u]=f||"")}),t}getParentTlLayerCount(){return this.element.parentElement.dataset.layerCount}}Nt=new WeakSet,ys=function(){this.element.dataset.prevOffsetX="0",this.element.dataset.trimStart="0",this.element.dataset.trimEnd=`${this.duration}`,this.element.dataset.trimDuration=`${this.duration}`,this.element.dataset.originalDuration=`${this.duration}`;const t=window.editor.playHead.positionSec();this.element.dataset.tlStart=`${t}`,this.element.dataset.tlEnd=`${t+this.duration}`},_s=function(t){Object.entries(t).forEach(([u,f])=>{this.element.dataset[u]=f}),this.element.dataset.prevOffsetX="0",this.element.style.left=`${It(+t.tlStart)}px`,this.element.style.width=`${It(+t.trimDuration)}px`},vs=function(){return window.editor.myProject.nodes.find(({id:t})=>t===this.id)},Cs=function(){const t=document.getElementById("timeline-cursor");this.element.addEventListener("dragstart",f=>{var m,o;this.trimLeft&&this.trimLeft.visibility("hidden"),this.trimRight&&this.trimRight.visibility("hidden"),mr(".timeline-layer"),this.element.dataset.prevOffsetX=`${f.offsetX}`,(m=f.dataTransfer)==null||m.setData("clipid",this.element.id),(o=f.dataTransfer)==null||o.setData("dragtype","timeline-content"),t.style.visibility="visible",t.dataset.trimming="true",t.style.outline="unset"}),this.element.addEventListener("dragend",()=>{this.trimLeft&&this.trimLeft.visibility("visible"),this.trimRight&&this.trimRight.visibility("visible"),pr(".timeline-layer"),this.element.style.opacity="unset",t.dataset.trimming="false",t.style.visibility="hidden",t.style.outline="unset"});const u=q(this,Nt,vs).call(this);u&&this.element.addEventListener("contextmenu",f=>{f.preventDefault();const{isMuted:m,isHidden:o}=this.element.parentElement.dataset,n=m!==void 0&&m==="true",i=o!==void 0&&o==="true";ls.open([{title:"auto trim (experimental)",cb:()=>u.autoTrim()},{title:"delete",cb:()=>u.delete()},{title:"split",cb:()=>u.split()},{title:"duplicate",cb:()=>u.duplicate()},{title:u.isMuted?"unmute":"mute",cb:()=>u.toggleMute(),skip:n},{title:u.isHidden?"show":"hide",cb:()=>u.toggleHide(),skip:i}],f.clientX,f.clientY)})};var se,oi,bs;class Wi{constructor(t,u){dt(this,oi);$(this,"id");$(this,"dir");$(this,"element");$(this,"parent");dt(this,se,!1);this.id=`${t.id}-${u}`,this.dir=u,this.parent=t,this.element=document.createElement("div"),this.element.setAttribute("id",this.id),this.element.setAttribute("tabindex","0"),this.element.setAttribute("draggable","false"),this.element.classList.add("timeline-layer-content-trimmer"),this.element.classList.add(u),q(this,oi,bs).call(this),this.parent.element.appendChild(this.element)}visibility(t){this.element.style.visibility=t}}se=new WeakMap,oi=new WeakSet,bs=function(){const t=document.getElementById("timeline-cursor"),u=m=>{this.element.style.border="unset",this.element.releasePointerCapture(m.pointerId),ct(this,se,!1),document.body.removeEventListener("pointermove",f),fr(this.element),this.parent.element.setAttribute("draggable","true"),t.dataset.trimming="false",t.style.outline="unset"},f=m=>{if(t.style.outline="unset",Z(this,se)&&m.target.id!=="timeline-header"){const{left:o,right:n,width:i}=this.parent.element.getBoundingClientRect(),c=+this.element.dataset.prevOffsetX,l=+this.parent.element.dataset.originalDuration,g=It(l);switch(t.dataset.trimming="true",t.style.visibility="visible",this.dir){case"pretrim":{const v=Ct(m.clientX-c+this.element.clientWidth);if(Math.floor(v)%Ti!==0)break;const C=o-v;let d=Ct(Math.min(i+C,g)),a=Jt(this.parent.element.style.left)-C;const p=Ct(+this.parent.element.dataset.trimStart-Ft(C));v<=n-Qe&&d<=g-Qe&&p>=0?(window.editor.myProject.getTLSnapPoints(this.parent.element.id).forEach(b=>{if(a<=b+Yt&&a>=b-Yt){const I=a-b;a=b,d+=I,t.style.outline="solid 2px yellow"}}),this.element.style.border="unset",this.parent.element.style.left=`${a}px`,this.parent.element.style.width=`${d}px`,this.parent.dataset("trimDuration",`${Ft(d)}`),this.parent.dataset("trimStart",`${p}`),this.parent.dataset("tlStart",`${Ft(a)}`)):this.element.style.border="red 2px solid",t.style.left=this.parent.element.style.left;break}case"posttrim":{let v=Ct(m.clientX-c+document.getElementById("timeline").scrollLeft-(document.getElementById("timeline-header").getBoundingClientRect().width+document.getElementById("timeline-width-adjust").getBoundingClientRect().width));if(Math.floor(v)%Ti!==0)break;const C=Jt(this.parent.element.style.left),d=C+i;let a=v-d,p=Ct(i+a),b=Ft(a),I=Ct(+this.parent.element.dataset.trimEnd+b);v>=C+Qe&&p<=g-Qe&&I<=l&&I>=+this.parent.element.dataset.trimStart?(window.editor.myProject.getTLSnapPoints(this.parent.element.id).forEach(r=>{if(v<=r+Yt&&v>=r-Yt){const e=r-v;v=r,p+=e,a+=e,b=Ft(a),I=Ct(+this.parent.element.dataset.trimEnd+b),t.style.outline="solid 2px yellow"}}),this.element.style.border="unset",this.parent.element.style.width=`${p}px`,this.parent.element.dataset.trimDuration=`${Ft(p)}`,this.parent.element.dataset.tlEnd=`${Ct(+this.parent.element.dataset.tlEnd+b)}`,this.parent.element.dataset.trimEnd=`${I}`):this.element.style.border="red 2px solid",t.style.left=`calc(${this.parent.element.style.left} + ${this.parent.element.style.width})`;break}}}};this.element.addEventListener("pointerdown",m=>{this.parent.element.setAttribute("draggable","false"),gr(this.element),this.element.setPointerCapture(m.pointerId),ct(this,se,!0),this.element.dataset.prevOffsetX=`${m.offsetX}`,document.body.addEventListener("pointermove",f)}),this.element.addEventListener("pointerup",u),this.element.addEventListener("pointercancel",u)};var zi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function br(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ii={exports:{}},le={},pi={},yi={},Xi;function Q(){return Xi||(Xi=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s._registerNode=s.Konva=s.glob=void 0;const t=Math.PI/180;function u(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}s.glob=typeof zi<"u"?zi:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},s.Konva={_global:s.glob,version:"9.3.20",isBrowser:u(),isUnminified:/param/.test((function(m){}).toString()),dblClickWindow:400,getAngle(m){return s.Konva.angleDeg?m*t:m},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return s.Konva.DD.isDragging},isTransforming(){var m;return(m=s.Konva.Transformer)===null||m===void 0?void 0:m.isTransforming()},isDragReady(){return!!s.Konva.DD.node},releaseCanvasOnDestroy:!0,document:s.glob.document,_injectGlobal(m){s.glob.Konva=m}};const f=m=>{s.Konva[m.prototype.getClassName()]=m};s._registerNode=f,s.Konva._injectGlobal(s.Konva)}(yi)),yi}var _i={},ji;function ot(){return ji||(ji=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Util=s.Transform=void 0;const t=Q();class u{constructor(y=[1,0,0,1,0,0]){this.dirty=!1,this.m=y&&y.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new u(this.m)}copyInto(y){y.m[0]=this.m[0],y.m[1]=this.m[1],y.m[2]=this.m[2],y.m[3]=this.m[3],y.m[4]=this.m[4],y.m[5]=this.m[5]}point(y){const w=this.m;return{x:w[0]*y.x+w[2]*y.y+w[4],y:w[1]*y.x+w[3]*y.y+w[5]}}translate(y,w){return this.m[4]+=this.m[0]*y+this.m[2]*w,this.m[5]+=this.m[1]*y+this.m[3]*w,this}scale(y,w){return this.m[0]*=y,this.m[1]*=y,this.m[2]*=w,this.m[3]*=w,this}rotate(y){const w=Math.cos(y),P=Math.sin(y),M=this.m[0]*w+this.m[2]*P,x=this.m[1]*w+this.m[3]*P,E=this.m[0]*-P+this.m[2]*w,A=this.m[1]*-P+this.m[3]*w;return this.m[0]=M,this.m[1]=x,this.m[2]=E,this.m[3]=A,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(y,w){const P=this.m[0]+this.m[2]*w,M=this.m[1]+this.m[3]*w,x=this.m[2]+this.m[0]*y,E=this.m[3]+this.m[1]*y;return this.m[0]=P,this.m[1]=M,this.m[2]=x,this.m[3]=E,this}multiply(y){const w=this.m[0]*y.m[0]+this.m[2]*y.m[1],P=this.m[1]*y.m[0]+this.m[3]*y.m[1],M=this.m[0]*y.m[2]+this.m[2]*y.m[3],x=this.m[1]*y.m[2]+this.m[3]*y.m[3],E=this.m[0]*y.m[4]+this.m[2]*y.m[5]+this.m[4],A=this.m[1]*y.m[4]+this.m[3]*y.m[5]+this.m[5];return this.m[0]=w,this.m[1]=P,this.m[2]=M,this.m[3]=x,this.m[4]=E,this.m[5]=A,this}invert(){const y=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),w=this.m[3]*y,P=-this.m[1]*y,M=-this.m[2]*y,x=this.m[0]*y,E=y*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),A=y*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=w,this.m[1]=P,this.m[2]=M,this.m[3]=x,this.m[4]=E,this.m[5]=A,this}getMatrix(){return this.m}decompose(){const y=this.m[0],w=this.m[1],P=this.m[2],M=this.m[3],x=this.m[4],E=this.m[5],A=y*M-w*P,R={x,y:E,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(y!=0||w!=0){const k=Math.sqrt(y*y+w*w);R.rotation=w>0?Math.acos(y/k):-Math.acos(y/k),R.scaleX=k,R.scaleY=A/k,R.skewX=(y*P+w*M)/A,R.skewY=0}else if(P!=0||M!=0){const k=Math.sqrt(P*P+M*M);R.rotation=Math.PI/2-(M>0?Math.acos(-P/k):-Math.acos(P/k)),R.scaleX=A/k,R.scaleY=k,R.skewX=0,R.skewY=(y*P+w*M)/A}return R.rotation=s.Util._getRotation(R.rotation),R}}s.Transform=u;const f="[object Array]",m="[object Number]",o="[object String]",n="[object Boolean]",i=Math.PI/180,c=180/Math.PI,l="#",g="",v="0",C="Konva warning: ",d="Konva error: ",a="rgb(",p={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},b=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let I=[];const r=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(e){setTimeout(e,60)};s.Util={_isElement(e){return!!(e&&e.nodeType==1)},_isFunction(e){return!!(e&&e.constructor&&e.call&&e.apply)},_isPlainObject(e){return!!e&&e.constructor===Object},_isArray(e){return Object.prototype.toString.call(e)===f},_isNumber(e){return Object.prototype.toString.call(e)===m&&!isNaN(e)&&isFinite(e)},_isString(e){return Object.prototype.toString.call(e)===o},_isBoolean(e){return Object.prototype.toString.call(e)===n},isObject(e){return e instanceof Object},isValidSelector(e){if(typeof e!="string")return!1;const y=e[0];return y==="#"||y==="."||y===y.toUpperCase()},_sign(e){return e===0||e>0?1:-1},requestAnimFrame(e){I.push(e),I.length===1&&r(function(){const y=I;I=[],y.forEach(function(w){w()})})},createCanvasElement(){const e=document.createElement("canvas");try{e.style=e.style||{}}catch{}return e},createImageElement(){return document.createElement("img")},_isInDocument(e){for(;e=e.parentNode;)if(e==document)return!0;return!1},_urlToImage(e,y){const w=s.Util.createImageElement();w.onload=function(){y(w)},w.src=e},_rgbToHex(e,y,w){return((1<<24)+(e<<16)+(y<<8)+w).toString(16).slice(1)},_hexToRgb(e){e=e.replace(l,g);const y=parseInt(e,16);return{r:y>>16&255,g:y>>8&255,b:y&255}},getRandomColor(){let e=(Math.random()*16777215<<0).toString(16);for(;e.length<6;)e=v+e;return l+e},getRGB(e){let y;return e in p?(y=p[e],{r:y[0],g:y[1],b:y[2]}):e[0]===l?this._hexToRgb(e.substring(1)):e.substr(0,4)===a?(y=b.exec(e.replace(/ /g,"")),{r:parseInt(y[1],10),g:parseInt(y[2],10),b:parseInt(y[3],10)}):{r:0,g:0,b:0}},colorToRGBA(e){return e=e||"black",s.Util._namedColorToRBA(e)||s.Util._hex3ColorToRGBA(e)||s.Util._hex4ColorToRGBA(e)||s.Util._hex6ColorToRGBA(e)||s.Util._hex8ColorToRGBA(e)||s.Util._rgbColorToRGBA(e)||s.Util._rgbaColorToRGBA(e)||s.Util._hslColorToRGBA(e)},_namedColorToRBA(e){const y=p[e.toLowerCase()];return y?{r:y[0],g:y[1],b:y[2],a:1}:null},_rgbColorToRGBA(e){if(e.indexOf("rgb(")===0){e=e.match(/rgb\(([^)]+)\)/)[1];const y=e.split(/ *, */).map(Number);return{r:y[0],g:y[1],b:y[2],a:1}}},_rgbaColorToRGBA(e){if(e.indexOf("rgba(")===0){e=e.match(/rgba\(([^)]+)\)/)[1];const y=e.split(/ *, */).map((w,P)=>w.slice(-1)==="%"?P===3?parseInt(w)/100:parseInt(w)/100*255:Number(w));return{r:y[0],g:y[1],b:y[2],a:y[3]}}},_hex8ColorToRGBA(e){if(e[0]==="#"&&e.length===9)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:parseInt(e.slice(7,9),16)/255}},_hex6ColorToRGBA(e){if(e[0]==="#"&&e.length===7)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:1}},_hex4ColorToRGBA(e){if(e[0]==="#"&&e.length===5)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:parseInt(e[4]+e[4],16)/255}},_hex3ColorToRGBA(e){if(e[0]==="#"&&e.length===4)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:1}},_hslColorToRGBA(e){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(e)){const[y,...w]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e),P=Number(w[0])/360,M=Number(w[1])/100,x=Number(w[2])/100;let E,A,R;if(M===0)return R=x*255,{r:Math.round(R),g:Math.round(R),b:Math.round(R),a:1};x<.5?E=x*(1+M):E=x+M-x*M;const k=2*x-E,h=[0,0,0];for(let S=0;S<3;S++)A=P+1/3*-(S-1),A<0&&A++,A>1&&A--,6*A<1?R=k+(E-k)*6*A:2*A<1?R=E:3*A<2?R=k+(E-k)*(2/3-A)*6:R=k,h[S]=R*255;return{r:Math.round(h[0]),g:Math.round(h[1]),b:Math.round(h[2]),a:1}}},haveIntersection(e,y){return!(y.x>e.x+e.width||y.x+y.width<e.x||y.y>e.y+e.height||y.y+y.height<e.y)},cloneObject(e){const y={};for(const w in e)this._isPlainObject(e[w])?y[w]=this.cloneObject(e[w]):this._isArray(e[w])?y[w]=this.cloneArray(e[w]):y[w]=e[w];return y},cloneArray(e){return e.slice(0)},degToRad(e){return e*i},radToDeg(e){return e*c},_degToRad(e){return s.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),s.Util.degToRad(e)},_radToDeg(e){return s.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),s.Util.radToDeg(e)},_getRotation(e){return t.Konva.angleDeg?s.Util.radToDeg(e):e},_capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)},throw(e){throw new Error(d+e)},error(e){console.error(d+e)},warn(e){t.Konva.showWarnings&&console.warn(C+e)},each(e,y){for(const w in e)y(w,e[w])},_inRange(e,y,w){return y<=e&&e<w},_getProjectionToSegment(e,y,w,P,M,x){let E,A,R;const k=(e-w)*(e-w)+(y-P)*(y-P);if(k==0)E=e,A=y,R=(M-w)*(M-w)+(x-P)*(x-P);else{const h=((M-e)*(w-e)+(x-y)*(P-y))/k;h<0?(E=e,A=y,R=(e-M)*(e-M)+(y-x)*(y-x)):h>1?(E=w,A=P,R=(w-M)*(w-M)+(P-x)*(P-x)):(E=e+h*(w-e),A=y+h*(P-y),R=(E-M)*(E-M)+(A-x)*(A-x))}return[E,A,R]},_getProjectionToLine(e,y,w){const P=s.Util.cloneObject(e);let M=Number.MAX_VALUE;return y.forEach(function(x,E){if(!w&&E===y.length-1)return;const A=y[(E+1)%y.length],R=s.Util._getProjectionToSegment(x.x,x.y,A.x,A.y,e.x,e.y),k=R[0],h=R[1],S=R[2];S<M&&(P.x=k,P.y=h,M=S)}),P},_prepareArrayForTween(e,y,w){const P=[],M=[];if(e.length>y.length){const E=y;y=e,e=E}for(let E=0;E<e.length;E+=2)P.push({x:e[E],y:e[E+1]});for(let E=0;E<y.length;E+=2)M.push({x:y[E],y:y[E+1]});const x=[];return M.forEach(function(E){const A=s.Util._getProjectionToLine(E,P,w);x.push(A.x),x.push(A.y)}),x},_prepareToStringify(e){let y;e.visitedByCircularReferenceRemoval=!0;for(const w in e)if(e.hasOwnProperty(w)&&e[w]&&typeof e[w]=="object"){if(y=Object.getOwnPropertyDescriptor(e,w),e[w].visitedByCircularReferenceRemoval||s.Util._isElement(e[w]))if(y.configurable)delete e[w];else return null;else if(s.Util._prepareToStringify(e[w])===null)if(y.configurable)delete e[w];else return null}return delete e.visitedByCircularReferenceRemoval,e},_assign(e,y){for(const w in y)e[w]=y[w];return e},_getFirstPointerId(e){return e.touches?e.changedTouches[0].identifier:e.pointerId||999},releaseCanvas(...e){t.Konva.releaseCanvasOnDestroy&&e.forEach(y=>{y.width=0,y.height=0})},drawRoundedRectPath(e,y,w,P){let M=0,x=0,E=0,A=0;typeof P=="number"?M=x=E=A=Math.min(P,y/2,w/2):(M=Math.min(P[0]||0,y/2,w/2),x=Math.min(P[1]||0,y/2,w/2),A=Math.min(P[2]||0,y/2,w/2),E=Math.min(P[3]||0,y/2,w/2)),e.moveTo(M,0),e.lineTo(y-x,0),e.arc(y-x,x,x,Math.PI*3/2,0,!1),e.lineTo(y,w-A),e.arc(y-A,w-A,A,0,Math.PI/2,!1),e.lineTo(E,w),e.arc(E,w-E,E,Math.PI/2,Math.PI,!1),e.lineTo(0,M),e.arc(M,M,M,Math.PI,Math.PI*3/2,!1)}}}(_i)),_i}var de={},vi={},yt={},Yi;function it(){if(Yi)return yt;Yi=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.RGBComponent=f,yt.alphaComponent=m,yt.getNumberValidator=o,yt.getNumberOrArrayOfNumbersValidator=n,yt.getNumberOrAutoValidator=i,yt.getStringValidator=c,yt.getStringOrGradientValidator=l,yt.getFunctionValidator=g,yt.getNumberArrayValidator=v,yt.getBooleanValidator=C,yt.getComponentValidator=d;const s=Q(),t=ot();function u(a){return t.Util._isString(a)?'"'+a+'"':Object.prototype.toString.call(a)==="[object Number]"||t.Util._isBoolean(a)?a:Object.prototype.toString.call(a)}function f(a){return a>255?255:a<0?0:Math.round(a)}function m(a){return a>1?1:a<1e-4?1e-4:a}function o(){if(s.Konva.isUnminified)return function(a,p){return t.Util._isNumber(a)||t.Util.warn(u(a)+' is a not valid value for "'+p+'" attribute. The value should be a number.'),a}}function n(a){if(s.Konva.isUnminified)return function(p,b){let I=t.Util._isNumber(p),r=t.Util._isArray(p)&&p.length==a;return!I&&!r&&t.Util.warn(u(p)+' is a not valid value for "'+b+'" attribute. The value should be a number or Array<number>('+a+")"),p}}function i(){if(s.Konva.isUnminified)return function(a,p){var b=t.Util._isNumber(a),I=a==="auto";return b||I||t.Util.warn(u(a)+' is a not valid value for "'+p+'" attribute. The value should be a number or "auto".'),a}}function c(){if(s.Konva.isUnminified)return function(a,p){return t.Util._isString(a)||t.Util.warn(u(a)+' is a not valid value for "'+p+'" attribute. The value should be a string.'),a}}function l(){if(s.Konva.isUnminified)return function(a,p){const b=t.Util._isString(a),I=Object.prototype.toString.call(a)==="[object CanvasGradient]"||a&&a.addColorStop;return b||I||t.Util.warn(u(a)+' is a not valid value for "'+p+'" attribute. The value should be a string or a native gradient.'),a}}function g(){if(s.Konva.isUnminified)return function(a,p){return t.Util._isFunction(a)||t.Util.warn(u(a)+' is a not valid value for "'+p+'" attribute. The value should be a function.'),a}}function v(){if(s.Konva.isUnminified)return function(a,p){const b=Int8Array?Object.getPrototypeOf(Int8Array):null;return b&&a instanceof b||(t.Util._isArray(a)?a.forEach(function(I){t.Util._isNumber(I)||t.Util.warn('"'+p+'" attribute has non numeric element '+I+". Make sure that all elements are numbers.")}):t.Util.warn(u(a)+' is a not valid value for "'+p+'" attribute. The value should be a array of numbers.')),a}}function C(){if(s.Konva.isUnminified)return function(a,p){var b=a===!0||a===!1;return b||t.Util.warn(u(a)+' is a not valid value for "'+p+'" attribute. The value should be a boolean.'),a}}function d(a){if(s.Konva.isUnminified)return function(p,b){return p==null||t.Util.isObject(p)||t.Util.warn(u(p)+' is a not valid value for "'+b+'" attribute. The value should be an object with properties '+a),p}}return yt}var Ki;function et(){return Ki||(Ki=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Factory=void 0;const t=ot(),u=it(),f="get",m="set";s.Factory={addGetterSetter(o,n,i,c,l){s.Factory.addGetter(o,n,i),s.Factory.addSetter(o,n,c,l),s.Factory.addOverloadedGetterSetter(o,n)},addGetter(o,n,i){var c=f+t.Util._capitalize(n);o.prototype[c]=o.prototype[c]||function(){const l=this.attrs[n];return l===void 0?i:l}},addSetter(o,n,i,c){var l=m+t.Util._capitalize(n);o.prototype[l]||s.Factory.overWriteSetter(o,n,i,c)},overWriteSetter(o,n,i,c){var l=m+t.Util._capitalize(n);o.prototype[l]=function(g){return i&&g!==void 0&&g!==null&&(g=i.call(this,g,n)),this._setAttr(n,g),c&&c.call(this),this}},addComponentsGetterSetter(o,n,i,c,l){const g=i.length,v=t.Util._capitalize,C=f+v(n),d=m+v(n);o.prototype[C]=function(){const p={};for(let b=0;b<g;b++){const I=i[b];p[I]=this.getAttr(n+v(I))}return p};const a=(0,u.getComponentValidator)(i);o.prototype[d]=function(p){const b=this.attrs[n];c&&(p=c.call(this,p,n)),a&&a.call(this,p,n);for(const I in p)p.hasOwnProperty(I)&&this._setAttr(n+v(I),p[I]);return p||i.forEach(I=>{this._setAttr(n+v(I),void 0)}),this._fireChangeEvent(n,b,p),l&&l.call(this),this},s.Factory.addOverloadedGetterSetter(o,n)},addOverloadedGetterSetter(o,n){var i=t.Util._capitalize(n),c=m+i,l=f+i;o.prototype[n]=function(){return arguments.length?(this[c](arguments[0]),this):this[l]()}},addDeprecatedGetterSetter(o,n,i,c){t.Util.error("Adding deprecated "+n);const l=f+t.Util._capitalize(n),g=n+" property is deprecated and will be removed soon. Look at Konva change log for more information.";o.prototype[l]=function(){t.Util.error(g);const v=this.attrs[n];return v===void 0?i:v},s.Factory.addSetter(o,n,c,function(){t.Util.error(g)}),s.Factory.addOverloadedGetterSetter(o,n)},backCompat(o,n){t.Util.each(n,function(i,c){const l=o.prototype[c],g=f+t.Util._capitalize(i),v=m+t.Util._capitalize(i);function C(){l.apply(this,arguments),t.Util.error('"'+i+'" method is deprecated and will be removed soon. Use ""'+c+'" instead.')}o.prototype[i]=C,o.prototype[g]=C,o.prototype[v]=C})},afterSetFilter(){this._filterUpToDate=!1}}}(vi)),vi}var Ot={},Dt={},qi;function Ss(){if(qi)return Dt;qi=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.HitContext=Dt.SceneContext=Dt.Context=void 0;const s=ot(),t=Q();function u(I){const r=[],e=I.length,y=s.Util;for(let w=0;w<e;w++){let P=I[w];y._isNumber(P)?P=Math.round(P*1e3)/1e3:y._isString(P)||(P=P+""),r.push(P)}return r}const f=",",m="(",o=")",n="([",i="])",c=";",l="()",g="=",v=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],C=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],d=100;let a=class{constructor(r){this.canvas=r,t.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(r){r.fillEnabled()&&this._fill(r)}_fill(r){}strokeShape(r){r.hasStroke()&&this._stroke(r)}_stroke(r){}fillStrokeShape(r){r.attrs.fillAfterStrokeEnabled?(this.strokeShape(r),this.fillShape(r)):(this.fillShape(r),this.strokeShape(r))}getTrace(r,e){let y=this.traceArr,w=y.length,P="",M,x,E,A;for(M=0;M<w;M++)x=y[M],E=x.method,E?(A=x.args,P+=E,r?P+=l:s.Util._isArray(A[0])?P+=n+A.join(f)+i:(e&&(A=A.map(R=>typeof R=="number"?Math.floor(R):R)),P+=m+A.join(f)+o)):(P+=x.property,r||(P+=g+x.val)),P+=c;return P}clearTrace(){this.traceArr=[]}_trace(r){let e=this.traceArr,y;e.push(r),y=e.length,y>=d&&e.shift()}reset(){const r=this.getCanvas().getPixelRatio();this.setTransform(1*r,0,0,1*r,0,0)}getCanvas(){return this.canvas}clear(r){const e=this.getCanvas();r?this.clearRect(r.x||0,r.y||0,r.width||0,r.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(r){const e=r.attrs.lineCap;e&&this.setAttr("lineCap",e)}_applyOpacity(r){const e=r.getAbsoluteOpacity();e!==1&&this.setAttr("globalAlpha",e)}_applyLineJoin(r){const e=r.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}setAttr(r,e){this._context[r]=e}arc(r,e,y,w,P,M){this._context.arc(r,e,y,w,P,M)}arcTo(r,e,y,w,P){this._context.arcTo(r,e,y,w,P)}beginPath(){this._context.beginPath()}bezierCurveTo(r,e,y,w,P,M){this._context.bezierCurveTo(r,e,y,w,P,M)}clearRect(r,e,y,w){this._context.clearRect(r,e,y,w)}clip(...r){this._context.clip.apply(this._context,r)}closePath(){this._context.closePath()}createImageData(r,e){const y=arguments;if(y.length===2)return this._context.createImageData(r,e);if(y.length===1)return this._context.createImageData(r)}createLinearGradient(r,e,y,w){return this._context.createLinearGradient(r,e,y,w)}createPattern(r,e){return this._context.createPattern(r,e)}createRadialGradient(r,e,y,w,P,M){return this._context.createRadialGradient(r,e,y,w,P,M)}drawImage(r,e,y,w,P,M,x,E,A){const R=arguments,k=this._context;R.length===3?k.drawImage(r,e,y):R.length===5?k.drawImage(r,e,y,w,P):R.length===9&&k.drawImage(r,e,y,w,P,M,x,E,A)}ellipse(r,e,y,w,P,M,x,E){this._context.ellipse(r,e,y,w,P,M,x,E)}isPointInPath(r,e,y,w){return y?this._context.isPointInPath(y,r,e,w):this._context.isPointInPath(r,e,w)}fill(...r){this._context.fill.apply(this._context,r)}fillRect(r,e,y,w){this._context.fillRect(r,e,y,w)}strokeRect(r,e,y,w){this._context.strokeRect(r,e,y,w)}fillText(r,e,y,w){w?this._context.fillText(r,e,y,w):this._context.fillText(r,e,y)}measureText(r){return this._context.measureText(r)}getImageData(r,e,y,w){return this._context.getImageData(r,e,y,w)}lineTo(r,e){this._context.lineTo(r,e)}moveTo(r,e){this._context.moveTo(r,e)}rect(r,e,y,w){this._context.rect(r,e,y,w)}roundRect(r,e,y,w,P){this._context.roundRect(r,e,y,w,P)}putImageData(r,e,y){this._context.putImageData(r,e,y)}quadraticCurveTo(r,e,y,w){this._context.quadraticCurveTo(r,e,y,w)}restore(){this._context.restore()}rotate(r){this._context.rotate(r)}save(){this._context.save()}scale(r,e){this._context.scale(r,e)}setLineDash(r){this._context.setLineDash?this._context.setLineDash(r):"mozDash"in this._context?this._context.mozDash=r:"webkitLineDash"in this._context&&(this._context.webkitLineDash=r)}getLineDash(){return this._context.getLineDash()}setTransform(r,e,y,w,P,M){this._context.setTransform(r,e,y,w,P,M)}stroke(r){r?this._context.stroke(r):this._context.stroke()}strokeText(r,e,y,w){this._context.strokeText(r,e,y,w)}transform(r,e,y,w,P,M){this._context.transform(r,e,y,w,P,M)}translate(r,e){this._context.translate(r,e)}_enableTrace(){let r=this,e=v.length,y=this.setAttr,w,P;const M=function(x){let E=r[x],A;r[x]=function(){return P=u(Array.prototype.slice.call(arguments,0)),A=E.apply(r,arguments),r._trace({method:x,args:P}),A}};for(w=0;w<e;w++)M(v[w]);r.setAttr=function(){y.apply(r,arguments);const x=arguments[0];let E=arguments[1];(x==="shadowOffsetX"||x==="shadowOffsetY"||x==="shadowBlur")&&(E=E/this.canvas.getPixelRatio()),r._trace({property:x,val:E})}}_applyGlobalCompositeOperation(r){const e=r.attrs.globalCompositeOperation;!e||e==="source-over"||this.setAttr("globalCompositeOperation",e)}};Dt.Context=a,C.forEach(function(I){Object.defineProperty(a.prototype,I,{get(){return this._context[I]},set(r){this._context[I]=r}})});class p extends a{constructor(r,{willReadFrequently:e=!1}={}){super(r),this._context=r._canvas.getContext("2d",{willReadFrequently:e})}_fillColor(r){const e=r.fill();this.setAttr("fillStyle",e),r._fillFunc(this)}_fillPattern(r){this.setAttr("fillStyle",r._getFillPattern()),r._fillFunc(this)}_fillLinearGradient(r){const e=r._getLinearGradient();e&&(this.setAttr("fillStyle",e),r._fillFunc(this))}_fillRadialGradient(r){const e=r._getRadialGradient();e&&(this.setAttr("fillStyle",e),r._fillFunc(this))}_fill(r){const e=r.fill(),y=r.getFillPriority();if(e&&y==="color"){this._fillColor(r);return}const w=r.getFillPatternImage();if(w&&y==="pattern"){this._fillPattern(r);return}const P=r.getFillLinearGradientColorStops();if(P&&y==="linear-gradient"){this._fillLinearGradient(r);return}const M=r.getFillRadialGradientColorStops();if(M&&y==="radial-gradient"){this._fillRadialGradient(r);return}e?this._fillColor(r):w?this._fillPattern(r):P?this._fillLinearGradient(r):M&&this._fillRadialGradient(r)}_strokeLinearGradient(r){const e=r.getStrokeLinearGradientStartPoint(),y=r.getStrokeLinearGradientEndPoint(),w=r.getStrokeLinearGradientColorStops(),P=this.createLinearGradient(e.x,e.y,y.x,y.y);if(w){for(let M=0;M<w.length;M+=2)P.addColorStop(w[M],w[M+1]);this.setAttr("strokeStyle",P)}}_stroke(r){const e=r.dash(),y=r.getStrokeScaleEnabled();if(r.hasStroke()){if(!y){this.save();const P=this.getCanvas().getPixelRatio();this.setTransform(P,0,0,P,0,0)}this._applyLineCap(r),e&&r.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",r.dashOffset())),this.setAttr("lineWidth",r.strokeWidth()),r.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),r.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(r):this.setAttr("strokeStyle",r.stroke()),r._strokeFunc(this),y||this.restore()}}_applyShadow(r){var e,y,w;const P=(e=r.getShadowRGBA())!==null&&e!==void 0?e:"black",M=(y=r.getShadowBlur())!==null&&y!==void 0?y:5,x=(w=r.getShadowOffset())!==null&&w!==void 0?w:{x:0,y:0},E=r.getAbsoluteScale(),A=this.canvas.getPixelRatio(),R=E.x*A,k=E.y*A;this.setAttr("shadowColor",P),this.setAttr("shadowBlur",M*Math.min(Math.abs(R),Math.abs(k))),this.setAttr("shadowOffsetX",x.x*R),this.setAttr("shadowOffsetY",x.y*k)}}Dt.SceneContext=p;class b extends a{constructor(r){super(r),this._context=r._canvas.getContext("2d",{willReadFrequently:!0})}_fill(r){this.save(),this.setAttr("fillStyle",r.colorKey),r._fillFuncHit(this),this.restore()}strokeShape(r){r.hasHitStroke()&&this._stroke(r)}_stroke(r){if(r.hasHitStroke()){const e=r.getStrokeScaleEnabled();if(!e){this.save();const P=this.getCanvas().getPixelRatio();this.setTransform(P,0,0,P,0,0)}this._applyLineCap(r);const y=r.hitStrokeWidth(),w=y==="auto"?r.strokeWidth():y;this.setAttr("lineWidth",w),this.setAttr("strokeStyle",r.colorKey),r._strokeFuncHit(this),e||this.restore()}}}return Dt.HitContext=b,Dt}var Zi;function ui(){if(Zi)return Ot;Zi=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.HitCanvas=Ot.SceneCanvas=Ot.Canvas=void 0;const s=ot(),t=Ss(),u=Q();let f;function m(){if(f)return f;const c=s.Util.createCanvasElement(),l=c.getContext("2d");return f=function(){const g=u.Konva._global.devicePixelRatio||1,v=l.webkitBackingStorePixelRatio||l.mozBackingStorePixelRatio||l.msBackingStorePixelRatio||l.oBackingStorePixelRatio||l.backingStorePixelRatio||1;return g/v}(),s.Util.releaseCanvas(c),f}let o=class{constructor(l){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const v=(l||{}).pixelRatio||u.Konva.pixelRatio||m();this.pixelRatio=v,this._canvas=s.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(l){const g=this.pixelRatio;this.pixelRatio=l,this.setSize(this.getWidth()/g,this.getHeight()/g)}setWidth(l){this.width=this._canvas.width=l*this.pixelRatio,this._canvas.style.width=l+"px";const g=this.pixelRatio;this.getContext()._context.scale(g,g)}setHeight(l){this.height=this._canvas.height=l*this.pixelRatio,this._canvas.style.height=l+"px";const g=this.pixelRatio;this.getContext()._context.scale(g,g)}getWidth(){return this.width}getHeight(){return this.height}setSize(l,g){this.setWidth(l||0),this.setHeight(g||0)}toDataURL(l,g){try{return this._canvas.toDataURL(l,g)}catch{try{return this._canvas.toDataURL()}catch(C){return s.Util.error("Unable to get data URL. "+C.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};Ot.Canvas=o;class n extends o{constructor(l={width:0,height:0,willReadFrequently:!1}){super(l),this.context=new t.SceneContext(this,{willReadFrequently:l.willReadFrequently}),this.setSize(l.width,l.height)}}Ot.SceneCanvas=n;class i extends o{constructor(l={width:0,height:0}){super(l),this.hitCanvas=!0,this.context=new t.HitContext(this),this.setSize(l.width,l.height)}}return Ot.HitCanvas=i,Ot}var Ci={},$i;function Ni(){return $i||($i=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.DD=void 0;const t=Q(),u=ot();s.DD={get isDragging(){let f=!1;return s.DD._dragElements.forEach(m=>{m.dragStatus==="dragging"&&(f=!0)}),f},justDragged:!1,get node(){let f;return s.DD._dragElements.forEach(m=>{f=m.node}),f},_dragElements:new Map,_drag(f){const m=[];s.DD._dragElements.forEach((o,n)=>{const{node:i}=o,c=i.getStage();c.setPointersPositions(f),o.pointerId===void 0&&(o.pointerId=u.Util._getFirstPointerId(f));const l=c._changedPointerPositions.find(g=>g.id===o.pointerId);if(l){if(o.dragStatus!=="dragging"){const g=i.dragDistance();if(Math.max(Math.abs(l.x-o.startPointerPos.x),Math.abs(l.y-o.startPointerPos.y))<g||(i.startDrag({evt:f}),!i.isDragging()))return}i._setDragPosition(f,o),m.push(i)}}),m.forEach(o=>{o.fire("dragmove",{type:"dragmove",target:o,evt:f},!0)})},_endDragBefore(f){const m=[];s.DD._dragElements.forEach(o=>{const{node:n}=o,i=n.getStage();if(f&&i.setPointersPositions(f),!i._changedPointerPositions.find(g=>g.id===o.pointerId))return;(o.dragStatus==="dragging"||o.dragStatus==="stopped")&&(s.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,o.dragStatus="stopped");const l=o.node.getLayer()||o.node instanceof t.Konva.Stage&&o.node;l&&m.indexOf(l)===-1&&m.push(l)}),m.forEach(o=>{o.draw()})},_endDragAfter(f){s.DD._dragElements.forEach((m,o)=>{m.dragStatus==="stopped"&&m.node.fire("dragend",{type:"dragend",target:m.node,evt:f},!0),m.dragStatus!=="dragging"&&s.DD._dragElements.delete(o)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",s.DD._endDragBefore,!0),window.addEventListener("touchend",s.DD._endDragBefore,!0),window.addEventListener("touchcancel",s.DD._endDragBefore,!0),window.addEventListener("mousemove",s.DD._drag),window.addEventListener("touchmove",s.DD._drag),window.addEventListener("mouseup",s.DD._endDragAfter,!1),window.addEventListener("touchend",s.DD._endDragAfter,!1),window.addEventListener("touchcancel",s.DD._endDragAfter,!1))}(Ci)),Ci}var Ji;function lt(){if(Ji)return de;Ji=1,Object.defineProperty(de,"__esModule",{value:!0}),de.Node=void 0;const s=ot(),t=et(),u=ui(),f=Q(),m=Ni(),o=it(),n="absoluteOpacity",i="allEventListeners",c="absoluteTransform",l="absoluteScale",g="canvas",v="Change",C="children",d="konva",a="listening",p="mouseenter",b="mouseleave",I="set",r="Shape",e=" ",y="stage",w="transform",P="Stage",M="visible",x=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(e);let E=1,A=class Gi{constructor(h){this._id=E++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(h),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(h){(h===w||h===c)&&this._cache.get(h)?this._cache.get(h).dirty=!0:h?this._cache.delete(h):this._cache.clear()}_getCache(h,S){let _=this._cache.get(h);return(_===void 0||(h===w||h===c)&&_.dirty===!0)&&(_=S.call(this),this._cache.set(h,_)),_}_calculate(h,S,_){if(!this._attachedDepsListeners.get(h)){const T=S.map(G=>G+"Change.konva").join(e);this.on(T,()=>{this._clearCache(h)}),this._attachedDepsListeners.set(h,!0)}return this._getCache(h,_)}_getCanvasCache(){return this._cache.get(g)}_clearSelfAndDescendantCache(h){this._clearCache(h),h===c&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(g)){const{scene:h,filter:S,hit:_}=this._cache.get(g);s.Util.releaseCanvas(h,S,_),this._cache.delete(g)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(h){const S=h||{};let _={};(S.x===void 0||S.y===void 0||S.width===void 0||S.height===void 0)&&(_=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let T=Math.ceil(S.width||_.width),G=Math.ceil(S.height||_.height),N=S.pixelRatio,O=S.x===void 0?Math.floor(_.x):S.x,L=S.y===void 0?Math.floor(_.y):S.y,V=S.offset||0,z=S.drawBorder||!1,D=S.hitCanvasPixelRatio||1;if(!T||!G){s.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const H=Math.abs(Math.round(_.x)-O)>.5?1:0,X=Math.abs(Math.round(_.y)-L)>.5?1:0;T+=V*2+H,G+=V*2+X,O-=V,L-=V;const Y=new u.SceneCanvas({pixelRatio:N,width:T,height:G}),F=new u.SceneCanvas({pixelRatio:N,width:0,height:0,willReadFrequently:!0}),B=new u.HitCanvas({pixelRatio:D,width:T,height:G}),U=Y.getContext(),W=B.getContext();return B.isCache=!0,Y.isCache=!0,this._cache.delete(g),this._filterUpToDate=!1,S.imageSmoothingEnabled===!1&&(Y.getContext()._context.imageSmoothingEnabled=!1,F.getContext()._context.imageSmoothingEnabled=!1),U.save(),W.save(),U.translate(-O,-L),W.translate(-O,-L),this._isUnderCache=!0,this._clearSelfAndDescendantCache(n),this._clearSelfAndDescendantCache(l),this.drawScene(Y,this),this.drawHit(B,this),this._isUnderCache=!1,U.restore(),W.restore(),z&&(U.save(),U.beginPath(),U.rect(0,0,T,G),U.closePath(),U.setAttr("strokeStyle","red"),U.setAttr("lineWidth",5),U.stroke(),U.restore()),this._cache.set(g,{scene:Y,filter:F,hit:B,x:O,y:L}),this._requestDraw(),this}isCached(){return this._cache.has(g)}getClientRect(h){throw new Error('abstract "getClientRect" method call')}_transformedRect(h,S){const _=[{x:h.x,y:h.y},{x:h.x+h.width,y:h.y},{x:h.x+h.width,y:h.y+h.height},{x:h.x,y:h.y+h.height}];let T=1/0,G=1/0,N=-1/0,O=-1/0;const L=this.getAbsoluteTransform(S);return _.forEach(function(V){const z=L.point(V);T===void 0&&(T=N=z.x,G=O=z.y),T=Math.min(T,z.x),G=Math.min(G,z.y),N=Math.max(N,z.x),O=Math.max(O,z.y)}),{x:T,y:G,width:N-T,height:O-G}}_drawCachedSceneCanvas(h){h.save(),h._applyOpacity(this),h._applyGlobalCompositeOperation(this);const S=this._getCanvasCache();h.translate(S.x,S.y);const _=this._getCachedSceneCanvas(),T=_.pixelRatio;h.drawImage(_._canvas,0,0,_.width/T,_.height/T),h.restore()}_drawCachedHitCanvas(h){const S=this._getCanvasCache(),_=S.hit;h.save(),h.translate(S.x,S.y),h.drawImage(_._canvas,0,0,_.width/_.pixelRatio,_.height/_.pixelRatio),h.restore()}_getCachedSceneCanvas(){let h=this.filters(),S=this._getCanvasCache(),_=S.scene,T=S.filter,G=T.getContext(),N,O,L,V;if(h){if(!this._filterUpToDate){const z=_.pixelRatio;T.setSize(_.width/_.pixelRatio,_.height/_.pixelRatio);try{for(N=h.length,G.clear(),G.drawImage(_._canvas,0,0,_.getWidth()/z,_.getHeight()/z),O=G.getImageData(0,0,T.getWidth(),T.getHeight()),L=0;L<N;L++){if(V=h[L],typeof V!="function"){s.Util.error("Filter should be type of function, but got "+typeof V+" instead. Please check correct filters");continue}V.call(this,O),G.putImageData(O,0,0)}}catch(D){s.Util.error("Unable to apply filter. "+D.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return T}return _}on(h,S){if(this._cache&&this._cache.delete(i),arguments.length===3)return this._delegate.apply(this,arguments);let _=h.split(e),T=_.length,G,N,O,L,V;for(G=0;G<T;G++)N=_[G],O=N.split("."),L=O[0],V=O[1]||"",this.eventListeners[L]||(this.eventListeners[L]=[]),this.eventListeners[L].push({name:V,handler:S});return this}off(h,S){let _=(h||"").split(e),T=_.length,G,N,O,L,V,z;if(this._cache&&this._cache.delete(i),!h)for(N in this.eventListeners)this._off(N);for(G=0;G<T;G++)if(O=_[G],L=O.split("."),V=L[0],z=L[1],V)this.eventListeners[V]&&this._off(V,z,S);else for(N in this.eventListeners)this._off(N,z,S);return this}dispatchEvent(h){const S={target:this,type:h.type,evt:h};return this.fire(h.type,S),this}addEventListener(h,S){return this.on(h,function(_){S.call(this,_.evt)}),this}removeEventListener(h){return this.off(h),this}_delegate(h,S,_){const T=this;this.on(h,function(G){const N=G.target.findAncestors(S,!0,T);for(let O=0;O<N.length;O++)G=s.Util.cloneObject(G),G.currentTarget=N[O],_.call(N[O],G)})}remove(){return this.isDragging()&&this.stopDrag(),m.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(n),this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(y),this._clearSelfAndDescendantCache(M),this._clearSelfAndDescendantCache(a)}_remove(){this._clearCaches();const h=this.getParent();h&&h.children&&(h.children.splice(this.index,1),h._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(h){const S="get"+s.Util._capitalize(h);return s.Util._isFunction(this[S])?this[S]():this.attrs[h]}getAncestors(){let h=this.getParent(),S=[];for(;h;)S.push(h),h=h.getParent();return S}getAttrs(){return this.attrs||{}}setAttrs(h){return this._batchTransformChanges(()=>{let S,_;if(!h)return this;for(S in h)S!==C&&(_=I+s.Util._capitalize(S),s.Util._isFunction(this[_])?this[_](h[S]):this._setAttr(S,h[S]))}),this}isListening(){return this._getCache(a,this._isListening)}_isListening(h){if(!this.listening())return!1;const _=this.getParent();return _&&_!==h&&this!==h?_._isListening(h):!0}isVisible(){return this._getCache(M,this._isVisible)}_isVisible(h){if(!this.visible())return!1;const _=this.getParent();return _&&_!==h&&this!==h?_._isVisible(h):!0}shouldDrawHit(h,S=!1){if(h)return this._isVisible(h)&&this._isListening(h);const _=this.getLayer();let T=!1;m.DD._dragElements.forEach(N=>{N.dragStatus==="dragging"&&(N.node.nodeType==="Stage"||N.node.getLayer()===_)&&(T=!0)});const G=!S&&!f.Konva.hitOnDragEnabled&&(T||f.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!G}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let h=this.getDepth(),S=this,_=0,T,G,N,O;function L(z){for(T=[],G=z.length,N=0;N<G;N++)O=z[N],_++,O.nodeType!==r&&(T=T.concat(O.getChildren().slice())),O._id===S._id&&(N=G);T.length>0&&T[0].getDepth()<=h&&L(T)}const V=this.getStage();return S.nodeType!==P&&V&&L(V.getChildren()),_}getDepth(){let h=0,S=this.parent;for(;S;)h++,S=S.parent;return h}_batchTransformChanges(h){this._batchingTransformChange=!0,h(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(w),this._clearSelfAndDescendantCache(c)),this._needClearTransformCache=!1}setPosition(h){return this._batchTransformChanges(()=>{this.x(h.x),this.y(h.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const h=this.getStage();if(!h)return null;const S=h.getPointerPosition();if(!S)return null;const _=this.getAbsoluteTransform().copy();return _.invert(),_.point(S)}getAbsolutePosition(h){let S=!1,_=this.parent;for(;_;){if(_.isCached()){S=!0;break}_=_.parent}S&&!h&&(h=!0);const T=this.getAbsoluteTransform(h).getMatrix(),G=new s.Transform,N=this.offset();return G.m=T.slice(),G.translate(N.x,N.y),G.getTranslation()}setAbsolutePosition(h){const{x:S,y:_,...T}=this._clearTransform();this.attrs.x=S,this.attrs.y=_,this._clearCache(w);const G=this._getAbsoluteTransform().copy();return G.invert(),G.translate(h.x,h.y),h={x:this.attrs.x+G.getTranslation().x,y:this.attrs.y+G.getTranslation().y},this._setTransform(T),this.setPosition({x:h.x,y:h.y}),this._clearCache(w),this._clearSelfAndDescendantCache(c),this}_setTransform(h){let S;for(S in h)this.attrs[S]=h[S]}_clearTransform(){const h={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,h}move(h){let S=h.x,_=h.y,T=this.x(),G=this.y();return S!==void 0&&(T+=S),_!==void 0&&(G+=_),this.setPosition({x:T,y:G}),this}_eachAncestorReverse(h,S){let _=[],T=this.getParent(),G,N;if(!(S&&S._id===this._id)){for(_.unshift(this);T&&(!S||T._id!==S._id);)_.unshift(T),T=T.parent;for(G=_.length,N=0;N<G;N++)h(_[N])}}rotate(h){return this.rotation(this.rotation()+h),this}moveToTop(){if(!this.parent)return s.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const h=this.index,S=this.parent.getChildren().length;return h<S-1?(this.parent.children.splice(h,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return s.Util.warn("Node has no parent. moveUp function is ignored."),!1;const h=this.index,S=this.parent.getChildren().length;return h<S-1?(this.parent.children.splice(h,1),this.parent.children.splice(h+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return s.Util.warn("Node has no parent. moveDown function is ignored."),!1;const h=this.index;return h>0?(this.parent.children.splice(h,1),this.parent.children.splice(h-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return s.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const h=this.index;return h>0?(this.parent.children.splice(h,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(h){if(!this.parent)return s.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(h<0||h>=this.parent.children.length)&&s.Util.warn("Unexpected value "+h+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const S=this.index;return this.parent.children.splice(S,1),this.parent.children.splice(h,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(n,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let h=this.opacity();const S=this.getParent();return S&&!S._isUnderCache&&(h*=S.getAbsoluteOpacity()),h}moveTo(h){return this.getParent()!==h&&(this._remove(),h.add(this)),this}toObject(){let h=this.getAttrs(),S,_,T,G,N;const O={attrs:{},className:this.getClassName()};for(S in h)_=h[S],N=s.Util.isObject(_)&&!s.Util._isPlainObject(_)&&!s.Util._isArray(_),!N&&(T=typeof this[S]=="function"&&this[S],delete h[S],G=T?T.call(this):null,h[S]=_,G!==_&&(O.attrs[S]=_));return s.Util._prepareToStringify(O)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(h,S,_){const T=[];S&&this._isMatch(h)&&T.push(this);let G=this.parent;for(;G;){if(G===_)return T;G._isMatch(h)&&T.push(G),G=G.parent}return T}isAncestorOf(h){return!1}findAncestor(h,S,_){return this.findAncestors(h,S,_)[0]}_isMatch(h){if(!h)return!1;if(typeof h=="function")return h(this);let S=h.replace(/ /g,"").split(","),_=S.length,T,G;for(T=0;T<_;T++)if(G=S[T],s.Util.isValidSelector(G)||(s.Util.warn('Selector "'+G+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),s.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),s.Util.warn("Konva is awesome, right?")),G.charAt(0)==="#"){if(this.id()===G.slice(1))return!0}else if(G.charAt(0)==="."){if(this.hasName(G.slice(1)))return!0}else if(this.className===G||this.nodeType===G)return!0;return!1}getLayer(){const h=this.getParent();return h?h.getLayer():null}getStage(){return this._getCache(y,this._getStage)}_getStage(){const h=this.getParent();return h?h.getStage():null}fire(h,S={},_){return S.target=S.target||this,_?this._fireAndBubble(h,S):this._fire(h,S),this}getAbsoluteTransform(h){return h?this._getAbsoluteTransform(h):this._getCache(c,this._getAbsoluteTransform)}_getAbsoluteTransform(h){let S;if(h)return S=new s.Transform,this._eachAncestorReverse(function(_){const T=_.transformsEnabled();T==="all"?S.multiply(_.getTransform()):T==="position"&&S.translate(_.x()-_.offsetX(),_.y()-_.offsetY())},h),S;{S=this._cache.get(c)||new s.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(S):S.reset();const _=this.transformsEnabled();if(_==="all")S.multiply(this.getTransform());else if(_==="position"){const T=this.attrs.x||0,G=this.attrs.y||0,N=this.attrs.offsetX||0,O=this.attrs.offsetY||0;S.translate(T-N,G-O)}return S.dirty=!1,S}}getAbsoluteScale(h){let S=this;for(;S;)S._isUnderCache&&(h=S),S=S.getParent();const T=this.getAbsoluteTransform(h).decompose();return{x:T.scaleX,y:T.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(w,this._getTransform)}_getTransform(){var h,S;const _=this._cache.get(w)||new s.Transform;_.reset();const T=this.x(),G=this.y(),N=f.Konva.getAngle(this.rotation()),O=(h=this.attrs.scaleX)!==null&&h!==void 0?h:1,L=(S=this.attrs.scaleY)!==null&&S!==void 0?S:1,V=this.attrs.skewX||0,z=this.attrs.skewY||0,D=this.attrs.offsetX||0,H=this.attrs.offsetY||0;return(T!==0||G!==0)&&_.translate(T,G),N!==0&&_.rotate(N),(V!==0||z!==0)&&_.skew(V,z),(O!==1||L!==1)&&_.scale(O,L),(D!==0||H!==0)&&_.translate(-1*D,-1*H),_.dirty=!1,_}clone(h){let S=s.Util.cloneObject(this.attrs),_,T,G,N,O;for(_ in h)S[_]=h[_];const L=new this.constructor(S);for(_ in this.eventListeners)for(T=this.eventListeners[_],G=T.length,N=0;N<G;N++)O=T[N],O.name.indexOf(d)<0&&(L.eventListeners[_]||(L.eventListeners[_]=[]),L.eventListeners[_].push(O));return L}_toKonvaCanvas(h){h=h||{};const S=this.getClientRect(),_=this.getStage(),T=h.x!==void 0?h.x:Math.floor(S.x),G=h.y!==void 0?h.y:Math.floor(S.y),N=h.pixelRatio||1,O=new u.SceneCanvas({width:h.width||Math.ceil(S.width)||(_?_.width():0),height:h.height||Math.ceil(S.height)||(_?_.height():0),pixelRatio:N}),L=O.getContext(),V=new u.SceneCanvas({width:O.width/O.pixelRatio+Math.abs(T),height:O.height/O.pixelRatio+Math.abs(G),pixelRatio:O.pixelRatio});return h.imageSmoothingEnabled===!1&&(L._context.imageSmoothingEnabled=!1),L.save(),(T||G)&&L.translate(-1*T,-1*G),this.drawScene(O,void 0,V),L.restore(),O}toCanvas(h){return this._toKonvaCanvas(h)._canvas}toDataURL(h){h=h||{};const S=h.mimeType||null,_=h.quality||null,T=this._toKonvaCanvas(h).toDataURL(S,_);return h.callback&&h.callback(T),T}toImage(h){return new Promise((S,_)=>{try{const T=h==null?void 0:h.callback;T&&delete h.callback,s.Util._urlToImage(this.toDataURL(h),function(G){S(G),T==null||T(G)})}catch(T){_(T)}})}toBlob(h){return new Promise((S,_)=>{try{const T=h==null?void 0:h.callback;T&&delete h.callback,this.toCanvas(h).toBlob(G=>{S(G),T==null||T(G)},h==null?void 0:h.mimeType,h==null?void 0:h.quality)}catch(T){_(T)}})}setSize(h){return this.width(h.width),this.height(h.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():f.Konva.dragDistance}_off(h,S,_){let T=this.eventListeners[h],G,N,O;for(G=0;G<T.length;G++)if(N=T[G].name,O=T[G].handler,(N!=="konva"||S==="konva")&&(!S||N===S)&&(!_||_===O)){if(T.splice(G,1),T.length===0){delete this.eventListeners[h];break}G--}}_fireChangeEvent(h,S,_){this._fire(h+v,{oldVal:S,newVal:_})}addName(h){if(!this.hasName(h)){const S=this.name(),_=S?S+" "+h:h;this.name(_)}return this}hasName(h){if(!h)return!1;const S=this.name();return S?(S||"").split(/\s/g).indexOf(h)!==-1:!1}removeName(h){const S=(this.name()||"").split(/\s/g),_=S.indexOf(h);return _!==-1&&(S.splice(_,1),this.name(S.join(" "))),this}setAttr(h,S){const _=this[I+s.Util._capitalize(h)];return s.Util._isFunction(_)?_.call(this,S):this._setAttr(h,S),this}_requestDraw(){if(f.Konva.autoDrawEnabled){const h=this.getLayer()||this.getStage();h==null||h.batchDraw()}}_setAttr(h,S){const _=this.attrs[h];_===S&&!s.Util.isObject(S)||(S==null?delete this.attrs[h]:this.attrs[h]=S,this._shouldFireChangeEvents&&this._fireChangeEvent(h,_,S),this._requestDraw())}_setComponentAttr(h,S,_){let T;_!==void 0&&(T=this.attrs[h],T||(this.attrs[h]=this.getAttr(h)),this.attrs[h][S]=_,this._fireChangeEvent(h,T,_))}_fireAndBubble(h,S,_){if(S&&this.nodeType===r&&(S.target=this),!((h===p||h===b)&&(_&&(this===_||this.isAncestorOf&&this.isAncestorOf(_))||this.nodeType==="Stage"&&!_))){this._fire(h,S);const G=(h===p||h===b)&&_&&_.isAncestorOf&&_.isAncestorOf(this)&&!_.isAncestorOf(this.parent);(S&&!S.cancelBubble||!S)&&this.parent&&this.parent.isListening()&&!G&&(_&&_.parent?this._fireAndBubble.call(this.parent,h,S,_):this._fireAndBubble.call(this.parent,h,S))}}_getProtoListeners(h){var S,_,T;const G=(S=this._cache.get(i))!==null&&S!==void 0?S:{};let N=G==null?void 0:G[h];if(N===void 0){N=[];let O=Object.getPrototypeOf(this);for(;O;){const L=(T=(_=O.eventListeners)===null||_===void 0?void 0:_[h])!==null&&T!==void 0?T:[];N.push(...L),O=Object.getPrototypeOf(O)}G[h]=N,this._cache.set(i,G)}return N}_fire(h,S){S=S||{},S.currentTarget=this,S.type=h;const _=this._getProtoListeners(h);if(_)for(var T=0;T<_.length;T++)_[T].handler.call(this,S);const G=this.eventListeners[h];if(G)for(var T=0;T<G.length;T++)G[T].handler.call(this,S)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(h){const S=h?h.pointerId:void 0,_=this.getStage(),T=this.getAbsolutePosition();if(!_)return;const G=_._getPointerById(S)||_._changedPointerPositions[0]||T;m.DD._dragElements.set(this._id,{node:this,startPointerPos:G,offset:{x:G.x-T.x,y:G.y-T.y},dragStatus:"ready",pointerId:S})}startDrag(h,S=!0){m.DD._dragElements.has(this._id)||this._createDragElement(h);const _=m.DD._dragElements.get(this._id);_.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:h&&h.evt},S)}_setDragPosition(h,S){const _=this.getStage()._getPointerById(S.pointerId);if(!_)return;let T={x:_.x-S.offset.x,y:_.y-S.offset.y};const G=this.dragBoundFunc();if(G!==void 0){const N=G.call(this,T,h);N?T=N:s.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==T.x||this._lastPos.y!==T.y)&&(this.setAbsolutePosition(T),this._requestDraw()),this._lastPos=T}stopDrag(h){const S=m.DD._dragElements.get(this._id);S&&(S.dragStatus="stopped"),m.DD._endDragBefore(h),m.DD._endDragAfter(h)}setDraggable(h){this._setAttr("draggable",h),this._dragChange()}isDragging(){const h=m.DD._dragElements.get(this._id);return h?h.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(h){if(!(!(h.evt.button!==void 0)||f.Konva.dragButtons.indexOf(h.evt.button)>=0)||this.isDragging())return;let T=!1;m.DD._dragElements.forEach(G=>{this.isAncestorOf(G.node)&&(T=!0)}),T||this._createDragElement(h)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const S=m.DD._dragElements.get(this._id),_=S&&S.dragStatus==="dragging",T=S&&S.dragStatus==="ready";_?this.stopDrag():T&&m.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(h={x:0,y:0}){const S=this.getStage();if(!S)return!1;const _={x:-h.x,y:-h.y,width:S.width()+2*h.x,height:S.height()+2*h.y};return s.Util.haveIntersection(_,this.getClientRect())}static create(h,S){return s.Util._isString(h)&&(h=JSON.parse(h)),this._createNode(h,S)}static _createNode(h,S){let _=Gi.prototype.getClassName.call(h),T=h.children,G,N,O;S&&(h.attrs.container=S),f.Konva[_]||(s.Util.warn('Can not find a node with class name "'+_+'". Fallback to "Shape".'),_="Shape");const L=f.Konva[_];if(G=new L(h.attrs),T)for(N=T.length,O=0;O<N;O++)G.add(Gi._createNode(T[O]));return G}};de.Node=A,A.prototype.nodeType="Node",A.prototype._attrsAffectingSize=[],A.prototype.eventListeners={},A.prototype.on.call(A.prototype,x,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(w),this._clearSelfAndDescendantCache(c)}),A.prototype.on.call(A.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(M)}),A.prototype.on.call(A.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(a)}),A.prototype.on.call(A.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(n)});const R=t.Factory.addGetterSetter;return R(A,"zIndex"),R(A,"absolutePosition"),R(A,"position"),R(A,"x",0,(0,o.getNumberValidator)()),R(A,"y",0,(0,o.getNumberValidator)()),R(A,"globalCompositeOperation","source-over",(0,o.getStringValidator)()),R(A,"opacity",1,(0,o.getNumberValidator)()),R(A,"name","",(0,o.getStringValidator)()),R(A,"id","",(0,o.getStringValidator)()),R(A,"rotation",0,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(A,"scale",["x","y"]),R(A,"scaleX",1,(0,o.getNumberValidator)()),R(A,"scaleY",1,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(A,"skew",["x","y"]),R(A,"skewX",0,(0,o.getNumberValidator)()),R(A,"skewY",0,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(A,"offset",["x","y"]),R(A,"offsetX",0,(0,o.getNumberValidator)()),R(A,"offsetY",0,(0,o.getNumberValidator)()),R(A,"dragDistance",void 0,(0,o.getNumberValidator)()),R(A,"width",0,(0,o.getNumberValidator)()),R(A,"height",0,(0,o.getNumberValidator)()),R(A,"listening",!0,(0,o.getBooleanValidator)()),R(A,"preventDefault",!0,(0,o.getBooleanValidator)()),R(A,"filters",void 0,function(k){return this._filterUpToDate=!1,k}),R(A,"visible",!0,(0,o.getBooleanValidator)()),R(A,"transformsEnabled","all",(0,o.getStringValidator)()),R(A,"size"),R(A,"dragBoundFunc"),R(A,"draggable",!1,(0,o.getBooleanValidator)()),t.Factory.backCompat(A,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),de}var ce={},Qi;function gi(){if(Qi)return ce;Qi=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.Container=void 0;const s=et(),t=lt(),u=it();let f=class extends t.Node{constructor(){super(...arguments),this.children=[]}getChildren(o){if(!o)return this.children||[];const n=this.children||[],i=[];return n.forEach(function(c){o(c)&&i.push(c)}),i}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(o=>{o.parent=null,o.index=0,o.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(o=>{o.parent=null,o.index=0,o.destroy()}),this.children=[],this._requestDraw(),this}add(...o){if(o.length===0)return this;if(o.length>1){for(let i=0;i<o.length;i++)this.add(o[i]);return this}const n=o[0];return n.getParent()?(n.moveTo(this),this):(this._validateAdd(n),n.index=this.getChildren().length,n.parent=this,n._clearCaches(),this.getChildren().push(n),this._fire("add",{child:n}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(o){return this._generalFind(o,!1)}findOne(o){const n=this._generalFind(o,!0);return n.length>0?n[0]:void 0}_generalFind(o,n){const i=[];return this._descendants(c=>{const l=c._isMatch(o);return l&&i.push(c),!!(l&&n)}),i}_descendants(o){let n=!1;const i=this.getChildren();for(const c of i){if(n=o(c),n)return!0;if(c.hasChildren()&&(n=c._descendants(o),n))return!0}return!1}toObject(){const o=t.Node.prototype.toObject.call(this);return o.children=[],this.getChildren().forEach(n=>{o.children.push(n.toObject())}),o}isAncestorOf(o){let n=o.getParent();for(;n;){if(n._id===this._id)return!0;n=n.getParent()}return!1}clone(o){const n=t.Node.prototype.clone.call(this,o);return this.getChildren().forEach(function(i){n.add(i.clone())}),n}getAllIntersections(o){const n=[];return this.find("Shape").forEach(i=>{i.isVisible()&&i.intersects(o)&&n.push(i)}),n}_clearSelfAndDescendantCache(o){var n;super._clearSelfAndDescendantCache(o),!this.isCached()&&((n=this.children)===null||n===void 0||n.forEach(function(i){i._clearSelfAndDescendantCache(o)}))}_setChildrenIndices(){var o;(o=this.children)===null||o===void 0||o.forEach(function(n,i){n.index=i}),this._requestDraw()}drawScene(o,n,i){const c=this.getLayer(),l=o||c&&c.getCanvas(),g=l&&l.getContext(),v=this._getCanvasCache(),C=v&&v.scene,d=l&&l.isCache;if(!this.isVisible()&&!d)return this;if(C){g.save();const a=this.getAbsoluteTransform(n).getMatrix();g.transform(a[0],a[1],a[2],a[3],a[4],a[5]),this._drawCachedSceneCanvas(g),g.restore()}else this._drawChildren("drawScene",l,n,i);return this}drawHit(o,n){if(!this.shouldDrawHit(n))return this;const i=this.getLayer(),c=o||i&&i.hitCanvas,l=c&&c.getContext(),g=this._getCanvasCache();if(g&&g.hit){l.save();const C=this.getAbsoluteTransform(n).getMatrix();l.transform(C[0],C[1],C[2],C[3],C[4],C[5]),this._drawCachedHitCanvas(l),l.restore()}else this._drawChildren("drawHit",c,n);return this}_drawChildren(o,n,i,c){var l;const g=n&&n.getContext(),v=this.clipWidth(),C=this.clipHeight(),d=this.clipFunc(),a=typeof v=="number"&&typeof C=="number"||d,p=i===this;if(a){g.save();const I=this.getAbsoluteTransform(i);let r=I.getMatrix();g.transform(r[0],r[1],r[2],r[3],r[4],r[5]),g.beginPath();let e;if(d)e=d.call(this,g,this);else{const y=this.clipX(),w=this.clipY();g.rect(y||0,w||0,v,C)}g.clip.apply(g,e),r=I.copy().invert().getMatrix(),g.transform(r[0],r[1],r[2],r[3],r[4],r[5])}const b=!p&&this.globalCompositeOperation()!=="source-over"&&o==="drawScene";b&&(g.save(),g._applyGlobalCompositeOperation(this)),(l=this.children)===null||l===void 0||l.forEach(function(I){I[o](n,i,c)}),b&&g.restore(),a&&g.restore()}getClientRect(o={}){var n;const i=o.skipTransform,c=o.relativeTo;let l,g,v,C,d={x:1/0,y:1/0,width:0,height:0};const a=this;(n=this.children)===null||n===void 0||n.forEach(function(I){if(!I.visible())return;const r=I.getClientRect({relativeTo:a,skipShadow:o.skipShadow,skipStroke:o.skipStroke});r.width===0&&r.height===0||(l===void 0?(l=r.x,g=r.y,v=r.x+r.width,C=r.y+r.height):(l=Math.min(l,r.x),g=Math.min(g,r.y),v=Math.max(v,r.x+r.width),C=Math.max(C,r.y+r.height)))});const p=this.find("Shape");let b=!1;for(let I=0;I<p.length;I++)if(p[I]._isVisible(this)){b=!0;break}return b&&l!==void 0?d={x:l,y:g,width:v-l,height:C-g}:d={x:0,y:0,width:0,height:0},i?d:this._transformedRect(d,c)}};return ce.Container=f,s.Factory.addComponentsGetterSetter(f,"clip",["x","y","width","height"]),s.Factory.addGetterSetter(f,"clipX",void 0,(0,u.getNumberValidator)()),s.Factory.addGetterSetter(f,"clipY",void 0,(0,u.getNumberValidator)()),s.Factory.addGetterSetter(f,"clipWidth",void 0,(0,u.getNumberValidator)()),s.Factory.addGetterSetter(f,"clipHeight",void 0,(0,u.getNumberValidator)()),s.Factory.addGetterSetter(f,"clipFunc"),ce}var bi={},jt={},tn;function ws(){if(tn)return jt;tn=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.getCapturedShape=f,jt.createEvent=m,jt.hasPointerCapture=o,jt.setPointerCapture=n,jt.releaseCapture=i;const s=Q(),t=new Map,u=s.Konva._global.PointerEvent!==void 0;function f(c){return t.get(c)}function m(c){return{evt:c,pointerId:c.pointerId}}function o(c,l){return t.get(c)===l}function n(c,l){i(c),l.getStage()&&(t.set(c,l),u&&l._fire("gotpointercapture",m(new PointerEvent("gotpointercapture"))))}function i(c,l){const g=t.get(c);if(!g)return;const v=g.getStage();v&&v.content,t.delete(c),u&&g._fire("lostpointercapture",m(new PointerEvent("lostpointercapture")))}return jt}var en;function Sr(){return en||(en=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Stage=s.stages=void 0;const t=ot(),u=et(),f=gi(),m=Q(),o=ui(),n=Ni(),i=Q(),c=ws(),l="Stage",g="string",v="px",C="mouseout",d="mouseleave",a="mouseover",p="mouseenter",b="mousemove",I="mousedown",r="mouseup",e="pointermove",y="pointerdown",w="pointerup",P="pointercancel",M="lostpointercapture",x="pointerout",E="pointerleave",A="pointerover",R="pointerenter",k="contextmenu",h="touchstart",S="touchend",_="touchmove",T="touchcancel",G="wheel",N=5,O=[[p,"_pointerenter"],[I,"_pointerdown"],[b,"_pointermove"],[r,"_pointerup"],[d,"_pointerleave"],[h,"_pointerdown"],[_,"_pointermove"],[S,"_pointerup"],[T,"_pointercancel"],[a,"_pointerover"],[G,"_wheel"],[k,"_contextmenu"],[y,"_pointerdown"],[e,"_pointermove"],[w,"_pointerup"],[P,"_pointercancel"],[M,"_lostpointercapture"]],L={mouse:{[x]:C,[E]:d,[A]:a,[R]:p,[e]:b,[y]:I,[w]:r,[P]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[x]:"touchout",[E]:"touchleave",[A]:"touchover",[R]:"touchenter",[e]:_,[y]:h,[w]:S,[P]:T,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[x]:x,[E]:E,[A]:A,[R]:R,[e]:e,[y]:y,[w]:w,[P]:P,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},V=Y=>Y.indexOf("pointer")>=0?"pointer":Y.indexOf("touch")>=0?"touch":"mouse",z=Y=>{const F=V(Y);if(F==="pointer")return m.Konva.pointerEventsEnabled&&L.pointer;if(F==="touch")return L.touch;if(F==="mouse")return L.mouse};function D(Y={}){return(Y.clipFunc||Y.clipWidth||Y.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),Y}const H="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";s.stages=[];class X extends f.Container{constructor(F){super(D(F)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),s.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{D(this.attrs)}),this._checkVisibility()}_validateAdd(F){const B=F.getType()==="Layer",U=F.getType()==="FastLayer";B||U||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const F=this.visible()?"":"none";this.content.style.display=F}setContainer(F){if(typeof F===g){if(F.charAt(0)==="."){const U=F.slice(1);F=document.getElementsByClassName(U)[0]}else{var B;F.charAt(0)!=="#"?B=F:B=F.slice(1),F=document.getElementById(B)}if(!F)throw"Can not find container in document with id "+B}return this._setAttr("container",F),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),F.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const F=this.children,B=F.length;for(let U=0;U<B;U++)F[U].clear();return this}clone(F){return F||(F={}),F.container=typeof document<"u"&&document.createElement("div"),f.Container.prototype.clone.call(this,F)}destroy(){super.destroy();const F=this.content;F&&t.Util._isInDocument(F)&&this.container().removeChild(F);const B=s.stages.indexOf(this);return B>-1&&s.stages.splice(B,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const F=this._pointerPositions[0]||this._changedPointerPositions[0];return F?{x:F.x,y:F.y}:(t.Util.warn(H),null)}_getPointerById(F){return this._pointerPositions.find(B=>B.id===F)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(F){F=F||{},F.x=F.x||0,F.y=F.y||0,F.width=F.width||this.width(),F.height=F.height||this.height();const B=new o.SceneCanvas({width:F.width,height:F.height,pixelRatio:F.pixelRatio||1}),U=B.getContext()._context,W=this.children;return(F.x||F.y)&&U.translate(-1*F.x,-1*F.y),W.forEach(function(j){if(!j.isVisible())return;const K=j._toKonvaCanvas(F);U.drawImage(K._canvas,F.x,F.y,K.getWidth()/K.getPixelRatio(),K.getHeight()/K.getPixelRatio())}),B}getIntersection(F){if(!F)return null;const B=this.children,U=B.length,W=U-1;for(let j=W;j>=0;j--){const K=B[j].getIntersection(F);if(K)return K}return null}_resizeDOM(){const F=this.width(),B=this.height();this.content&&(this.content.style.width=F+v,this.content.style.height=B+v),this.bufferCanvas.setSize(F,B),this.bufferHitCanvas.setSize(F,B),this.children.forEach(U=>{U.setSize({width:F,height:B}),U.draw()})}add(F,...B){if(arguments.length>1){for(let W=0;W<arguments.length;W++)this.add(arguments[W]);return this}super.add(F);const U=this.children.length;return U>N&&t.Util.warn("The stage has "+U+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),F.setSize({width:this.width(),height:this.height()}),F.draw(),m.Konva.isBrowser&&this.content.appendChild(F.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(F){return c.hasPointerCapture(F,this)}setPointerCapture(F){c.setPointerCapture(F,this)}releaseCapture(F){c.releaseCapture(F,this)}getLayers(){return this.children}_bindContentEvents(){m.Konva.isBrowser&&O.forEach(([F,B])=>{this.content.addEventListener(F,U=>{this[B](U)},{passive:!1})})}_pointerenter(F){this.setPointersPositions(F);const B=z(F.type);B&&this._fire(B.pointerenter,{evt:F,target:this,currentTarget:this})}_pointerover(F){this.setPointersPositions(F);const B=z(F.type);B&&this._fire(B.pointerover,{evt:F,target:this,currentTarget:this})}_getTargetShape(F){let B=this[F+"targetShape"];return B&&!B.getStage()&&(B=null),B}_pointerleave(F){const B=z(F.type),U=V(F.type);if(!B)return;this.setPointersPositions(F);const W=this._getTargetShape(U),j=!(m.Konva.isDragging()||m.Konva.isTransforming())||m.Konva.hitOnDragEnabled;W&&j?(W._fireAndBubble(B.pointerout,{evt:F}),W._fireAndBubble(B.pointerleave,{evt:F}),this._fire(B.pointerleave,{evt:F,target:this,currentTarget:this}),this[U+"targetShape"]=null):j&&(this._fire(B.pointerleave,{evt:F,target:this,currentTarget:this}),this._fire(B.pointerout,{evt:F,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(F){const B=z(F.type),U=V(F.type);if(!B)return;this.setPointersPositions(F);let W=!1;this._changedPointerPositions.forEach(j=>{const K=this.getIntersection(j);if(n.DD.justDragged=!1,m.Konva["_"+U+"ListenClick"]=!0,!K||!K.isListening()){this[U+"ClickStartShape"]=void 0;return}m.Konva.capturePointerEventsEnabled&&K.setPointerCapture(j.id),this[U+"ClickStartShape"]=K,K._fireAndBubble(B.pointerdown,{evt:F,pointerId:j.id}),W=!0;const nt=F.type.indexOf("touch")>=0;K.preventDefault()&&F.cancelable&&nt&&F.preventDefault()}),W||this._fire(B.pointerdown,{evt:F,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(F){const B=z(F.type),U=V(F.type);if(!B||(m.Konva.isDragging()&&n.DD.node.preventDefault()&&F.cancelable&&F.preventDefault(),this.setPointersPositions(F),!(!(m.Konva.isDragging()||m.Konva.isTransforming())||m.Konva.hitOnDragEnabled)))return;const j={};let K=!1;const nt=this._getTargetShape(U);this._changedPointerPositions.forEach(st=>{const J=c.getCapturedShape(st.id)||this.getIntersection(st),gt=st.id,rt={evt:F,pointerId:gt},ht=nt!==J;if(ht&&nt&&(nt._fireAndBubble(B.pointerout,{...rt},J),nt._fireAndBubble(B.pointerleave,{...rt},J)),J){if(j[J._id])return;j[J._id]=!0}J&&J.isListening()?(K=!0,ht&&(J._fireAndBubble(B.pointerover,{...rt},nt),J._fireAndBubble(B.pointerenter,{...rt},nt),this[U+"targetShape"]=J),J._fireAndBubble(B.pointermove,{...rt})):nt&&(this._fire(B.pointerover,{evt:F,target:this,currentTarget:this,pointerId:gt}),this[U+"targetShape"]=null)}),K||this._fire(B.pointermove,{evt:F,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(F){const B=z(F.type),U=V(F.type);if(!B)return;this.setPointersPositions(F);const W=this[U+"ClickStartShape"],j=this[U+"ClickEndShape"],K={};let nt=!1;this._changedPointerPositions.forEach(st=>{const J=c.getCapturedShape(st.id)||this.getIntersection(st);if(J){if(J.releaseCapture(st.id),K[J._id])return;K[J._id]=!0}const gt=st.id,rt={evt:F,pointerId:gt};let ht=!1;m.Konva["_"+U+"InDblClickWindow"]?(ht=!0,clearTimeout(this[U+"DblTimeout"])):n.DD.justDragged||(m.Konva["_"+U+"InDblClickWindow"]=!0,clearTimeout(this[U+"DblTimeout"])),this[U+"DblTimeout"]=setTimeout(function(){m.Konva["_"+U+"InDblClickWindow"]=!1},m.Konva.dblClickWindow),J&&J.isListening()?(nt=!0,this[U+"ClickEndShape"]=J,J._fireAndBubble(B.pointerup,{...rt}),m.Konva["_"+U+"ListenClick"]&&W&&W===J&&(J._fireAndBubble(B.pointerclick,{...rt}),ht&&j&&j===J&&J._fireAndBubble(B.pointerdblclick,{...rt}))):(this[U+"ClickEndShape"]=null,m.Konva["_"+U+"ListenClick"]&&this._fire(B.pointerclick,{evt:F,target:this,currentTarget:this,pointerId:gt}),ht&&this._fire(B.pointerdblclick,{evt:F,target:this,currentTarget:this,pointerId:gt}))}),nt||this._fire(B.pointerup,{evt:F,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),m.Konva["_"+U+"ListenClick"]=!1,F.cancelable&&U!=="touch"&&U!=="pointer"&&F.preventDefault()}_contextmenu(F){this.setPointersPositions(F);const B=this.getIntersection(this.getPointerPosition());B&&B.isListening()?B._fireAndBubble(k,{evt:F}):this._fire(k,{evt:F,target:this,currentTarget:this})}_wheel(F){this.setPointersPositions(F);const B=this.getIntersection(this.getPointerPosition());B&&B.isListening()?B._fireAndBubble(G,{evt:F}):this._fire(G,{evt:F,target:this,currentTarget:this})}_pointercancel(F){this.setPointersPositions(F);const B=c.getCapturedShape(F.pointerId)||this.getIntersection(this.getPointerPosition());B&&B._fireAndBubble(w,c.createEvent(F)),c.releaseCapture(F.pointerId)}_lostpointercapture(F){c.releaseCapture(F.pointerId)}setPointersPositions(F){const B=this._getContentPosition();let U=null,W=null;F=F||window.event,F.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(F.touches,j=>{this._pointerPositions.push({id:j.identifier,x:(j.clientX-B.left)/B.scaleX,y:(j.clientY-B.top)/B.scaleY})}),Array.prototype.forEach.call(F.changedTouches||F.touches,j=>{this._changedPointerPositions.push({id:j.identifier,x:(j.clientX-B.left)/B.scaleX,y:(j.clientY-B.top)/B.scaleY})})):(U=(F.clientX-B.left)/B.scaleX,W=(F.clientY-B.top)/B.scaleY,this.pointerPos={x:U,y:W},this._pointerPositions=[{x:U,y:W,id:t.Util._getFirstPointerId(F)}],this._changedPointerPositions=[{x:U,y:W,id:t.Util._getFirstPointerId(F)}])}_setPointerPosition(F){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(F)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const F=this.content.getBoundingClientRect();return{top:F.top,left:F.left,scaleX:F.width/this.content.clientWidth||1,scaleY:F.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new o.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new o.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!m.Konva.isBrowser)return;const F=this.container();if(!F)throw"Stage has no container. A container is required.";F.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),F.appendChild(this.content),this._resizeDOM()}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(F){F.batchDraw()}),this}}s.Stage=X,X.prototype.nodeType=l,(0,i._registerNode)(X),u.Factory.addGetterSetter(X,"container"),m.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{s.stages.forEach(Y=>{Y.batchDraw()})})}(bi)),bi}var ue={},Si={},nn;function ut(){return nn||(nn=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Shape=s.shapes=void 0;const t=Q(),u=ot(),f=et(),m=lt(),o=it(),n=Q(),i=ws(),c="hasShadow",l="shadowRGBA",g="patternImage",v="linearGradient",C="radialGradient";let d;function a(){return d||(d=u.Util.createCanvasElement().getContext("2d"),d)}s.shapes={};function p(E){const A=this.attrs.fillRule;A?E.fill(A):E.fill()}function b(E){E.stroke()}function I(E){const A=this.attrs.fillRule;A?E.fill(A):E.fill()}function r(E){E.stroke()}function e(){this._clearCache(c)}function y(){this._clearCache(l)}function w(){this._clearCache(g)}function P(){this._clearCache(v)}function M(){this._clearCache(C)}class x extends m.Node{constructor(A){super(A);let R;for(;R=u.Util.getRandomColor(),!(R&&!(R in s.shapes)););this.colorKey=R,s.shapes[R]=this}getContext(){return u.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return u.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(c,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(g,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const R=a().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(R&&R.setTransform){const k=new u.Transform;k.translate(this.fillPatternX(),this.fillPatternY()),k.rotate(t.Konva.getAngle(this.fillPatternRotation())),k.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),k.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const h=k.getMatrix(),S=typeof DOMMatrix>"u"?{a:h[0],b:h[1],c:h[2],d:h[3],e:h[4],f:h[5]}:new DOMMatrix(h);R.setTransform(S)}return R}}_getLinearGradient(){return this._getCache(v,this.__getLinearGradient)}__getLinearGradient(){const A=this.fillLinearGradientColorStops();if(A){const R=a(),k=this.fillLinearGradientStartPoint(),h=this.fillLinearGradientEndPoint(),S=R.createLinearGradient(k.x,k.y,h.x,h.y);for(let _=0;_<A.length;_+=2)S.addColorStop(A[_],A[_+1]);return S}}_getRadialGradient(){return this._getCache(C,this.__getRadialGradient)}__getRadialGradient(){const A=this.fillRadialGradientColorStops();if(A){const R=a(),k=this.fillRadialGradientStartPoint(),h=this.fillRadialGradientEndPoint(),S=R.createRadialGradient(k.x,k.y,this.fillRadialGradientStartRadius(),h.x,h.y,this.fillRadialGradientEndRadius());for(let _=0;_<A.length;_+=2)S.addColorStop(A[_],A[_+1]);return S}}getShadowRGBA(){return this._getCache(l,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const A=u.Util.colorToRGBA(this.shadowColor());if(A)return"rgba("+A.r+","+A.g+","+A.b+","+A.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const A=this.hitStrokeWidth();return A==="auto"?this.hasStroke():this.strokeEnabled()&&!!A}intersects(A){const R=this.getStage();if(!R)return!1;const k=R.bufferHitCanvas;return k.getContext().clear(),this.drawHit(k,void 0,!0),k.context.getImageData(Math.round(A.x),Math.round(A.y),1,1).data[3]>0}destroy(){return m.Node.prototype.destroy.call(this),delete s.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(A){var R;if(!((R=this.attrs.perfectDrawEnabled)!==null&&R!==void 0?R:!0))return!1;const h=A||this.hasFill(),S=this.hasStroke(),_=this.getAbsoluteOpacity()!==1;if(h&&S&&_)return!0;const T=this.hasShadow(),G=this.shadowForStrokeEnabled();return!!(h&&S&&T&&G)}setStrokeHitEnabled(A){u.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),A?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const A=this.size();return{x:this._centroid?-A.width/2:0,y:this._centroid?-A.height/2:0,width:A.width,height:A.height}}getClientRect(A={}){let R=!1,k=this.getParent();for(;k;){if(k.isCached()){R=!0;break}k=k.getParent()}const h=A.skipTransform,S=A.relativeTo||R&&this.getStage()||void 0,_=this.getSelfRect(),G=!A.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,N=_.width+G,O=_.height+G,L=!A.skipShadow&&this.hasShadow(),V=L?this.shadowOffsetX():0,z=L?this.shadowOffsetY():0,D=N+Math.abs(V),H=O+Math.abs(z),X=L&&this.shadowBlur()||0,Y=D+X*2,F=H+X*2,B={width:Y,height:F,x:-(G/2+X)+Math.min(V,0)+_.x,y:-(G/2+X)+Math.min(z,0)+_.y};return h?B:this._transformedRect(B,S)}drawScene(A,R,k){const h=this.getLayer();let S=A||h.getCanvas(),_=S.getContext(),T=this._getCanvasCache(),G=this.getSceneFunc(),N=this.hasShadow(),O,L;const V=S.isCache,z=R===this;if(!this.isVisible()&&!z)return this;if(T){_.save();const H=this.getAbsoluteTransform(R).getMatrix();return _.transform(H[0],H[1],H[2],H[3],H[4],H[5]),this._drawCachedSceneCanvas(_),_.restore(),this}if(!G)return this;if(_.save(),this._useBufferCanvas()&&!V){O=this.getStage();const H=k||O.bufferCanvas;L=H.getContext(),L.clear(),L.save(),L._applyLineJoin(this);var D=this.getAbsoluteTransform(R).getMatrix();L.transform(D[0],D[1],D[2],D[3],D[4],D[5]),G.call(this,L,this),L.restore();const X=H.pixelRatio;N&&_._applyShadow(this),_._applyOpacity(this),_._applyGlobalCompositeOperation(this),_.drawImage(H._canvas,0,0,H.width/X,H.height/X)}else{if(_._applyLineJoin(this),!z){var D=this.getAbsoluteTransform(R).getMatrix();_.transform(D[0],D[1],D[2],D[3],D[4],D[5]),_._applyOpacity(this),_._applyGlobalCompositeOperation(this)}N&&_._applyShadow(this),G.call(this,_,this)}return _.restore(),this}drawHit(A,R,k=!1){if(!this.shouldDrawHit(R,k))return this;const h=this.getLayer(),S=A||h.hitCanvas,_=S&&S.getContext(),T=this.hitFunc()||this.sceneFunc(),G=this._getCanvasCache(),N=G&&G.hit;if(this.colorKey||u.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),N){_.save();const L=this.getAbsoluteTransform(R).getMatrix();return _.transform(L[0],L[1],L[2],L[3],L[4],L[5]),this._drawCachedHitCanvas(_),_.restore(),this}if(!T)return this;if(_.save(),_._applyLineJoin(this),!(this===R)){const L=this.getAbsoluteTransform(R).getMatrix();_.transform(L[0],L[1],L[2],L[3],L[4],L[5])}return T.call(this,_,this),_.restore(),this}drawHitFromCache(A=0){const R=this._getCanvasCache(),k=this._getCachedSceneCanvas(),h=R.hit,S=h.getContext(),_=h.getWidth(),T=h.getHeight();S.clear(),S.drawImage(k._canvas,0,0,_,T);try{const G=S.getImageData(0,0,_,T),N=G.data,O=N.length,L=u.Util._hexToRgb(this.colorKey);for(let V=0;V<O;V+=4)N[V+3]>A?(N[V]=L.r,N[V+1]=L.g,N[V+2]=L.b,N[V+3]=255):N[V+3]=0;S.putImageData(G,0,0)}catch(G){u.Util.error("Unable to draw hit graph from cached scene canvas. "+G.message)}return this}hasPointerCapture(A){return i.hasPointerCapture(A,this)}setPointerCapture(A){i.setPointerCapture(A,this)}releaseCapture(A){i.releaseCapture(A,this)}}s.Shape=x,x.prototype._fillFunc=p,x.prototype._strokeFunc=b,x.prototype._fillFuncHit=I,x.prototype._strokeFuncHit=r,x.prototype._centroid=!1,x.prototype.nodeType="Shape",(0,n._registerNode)(x),x.prototype.eventListeners={},x.prototype.on.call(x.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",e),x.prototype.on.call(x.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",y),x.prototype.on.call(x.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",w),x.prototype.on.call(x.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",P),x.prototype.on.call(x.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",M),f.Factory.addGetterSetter(x,"stroke",void 0,(0,o.getStringOrGradientValidator)()),f.Factory.addGetterSetter(x,"strokeWidth",2,(0,o.getNumberValidator)()),f.Factory.addGetterSetter(x,"fillAfterStrokeEnabled",!1),f.Factory.addGetterSetter(x,"hitStrokeWidth","auto",(0,o.getNumberOrAutoValidator)()),f.Factory.addGetterSetter(x,"strokeHitEnabled",!0,(0,o.getBooleanValidator)()),f.Factory.addGetterSetter(x,"perfectDrawEnabled",!0,(0,o.getBooleanValidator)()),f.Factory.addGetterSetter(x,"shadowForStrokeEnabled",!0,(0,o.getBooleanValidator)()),f.Factory.addGetterSetter(x,"lineJoin"),f.Factory.addGetterSetter(x,"lineCap"),f.Factory.addGetterSetter(x,"sceneFunc"),f.Factory.addGetterSetter(x,"hitFunc"),f.Factory.addGetterSetter(x,"dash"),f.Factory.addGetterSetter(x,"dashOffset",0,(0,o.getNumberValidator)()),f.Factory.addGetterSetter(x,"shadowColor",void 0,(0,o.getStringValidator)()),f.Factory.addGetterSetter(x,"shadowBlur",0,(0,o.getNumberValidator)()),f.Factory.addGetterSetter(x,"shadowOpacity",1,(0,o.getNumberValidator)()),f.Factory.addComponentsGetterSetter(x,"shadowOffset",["x","y"]),f.Factory.addGetterSetter(x,"shadowOffsetX",0,(0,o.getNumberValidator)()),f.Factory.addGetterSetter(x,"shadowOffsetY",0,(0,o.getNumberValidator)()),f.Factory.addGetterSetter(x,"fillPatternImage"),f.Factory.addGetterSetter(x,"fill",void 0,(0,o.getStringOrGradientValidator)()),f.Factory.addGetterSetter(x,"fillPatternX",0,(0,o.getNumberValidator)()),f.Factory.addGetterSetter(x,"fillPatternY",0,(0,o.getNumberValidator)()),f.Factory.addGetterSetter(x,"fillLinearGradientColorStops"),f.Factory.addGetterSetter(x,"strokeLinearGradientColorStops"),f.Factory.addGetterSetter(x,"fillRadialGradientStartRadius",0),f.Factory.addGetterSetter(x,"fillRadialGradientEndRadius",0),f.Factory.addGetterSetter(x,"fillRadialGradientColorStops"),f.Factory.addGetterSetter(x,"fillPatternRepeat","repeat"),f.Factory.addGetterSetter(x,"fillEnabled",!0),f.Factory.addGetterSetter(x,"strokeEnabled",!0),f.Factory.addGetterSetter(x,"shadowEnabled",!0),f.Factory.addGetterSetter(x,"dashEnabled",!0),f.Factory.addGetterSetter(x,"strokeScaleEnabled",!0),f.Factory.addGetterSetter(x,"fillPriority","color"),f.Factory.addComponentsGetterSetter(x,"fillPatternOffset",["x","y"]),f.Factory.addGetterSetter(x,"fillPatternOffsetX",0,(0,o.getNumberValidator)()),f.Factory.addGetterSetter(x,"fillPatternOffsetY",0,(0,o.getNumberValidator)()),f.Factory.addComponentsGetterSetter(x,"fillPatternScale",["x","y"]),f.Factory.addGetterSetter(x,"fillPatternScaleX",1,(0,o.getNumberValidator)()),f.Factory.addGetterSetter(x,"fillPatternScaleY",1,(0,o.getNumberValidator)()),f.Factory.addComponentsGetterSetter(x,"fillLinearGradientStartPoint",["x","y"]),f.Factory.addComponentsGetterSetter(x,"strokeLinearGradientStartPoint",["x","y"]),f.Factory.addGetterSetter(x,"fillLinearGradientStartPointX",0),f.Factory.addGetterSetter(x,"strokeLinearGradientStartPointX",0),f.Factory.addGetterSetter(x,"fillLinearGradientStartPointY",0),f.Factory.addGetterSetter(x,"strokeLinearGradientStartPointY",0),f.Factory.addComponentsGetterSetter(x,"fillLinearGradientEndPoint",["x","y"]),f.Factory.addComponentsGetterSetter(x,"strokeLinearGradientEndPoint",["x","y"]),f.Factory.addGetterSetter(x,"fillLinearGradientEndPointX",0),f.Factory.addGetterSetter(x,"strokeLinearGradientEndPointX",0),f.Factory.addGetterSetter(x,"fillLinearGradientEndPointY",0),f.Factory.addGetterSetter(x,"strokeLinearGradientEndPointY",0),f.Factory.addComponentsGetterSetter(x,"fillRadialGradientStartPoint",["x","y"]),f.Factory.addGetterSetter(x,"fillRadialGradientStartPointX",0),f.Factory.addGetterSetter(x,"fillRadialGradientStartPointY",0),f.Factory.addComponentsGetterSetter(x,"fillRadialGradientEndPoint",["x","y"]),f.Factory.addGetterSetter(x,"fillRadialGradientEndPointX",0),f.Factory.addGetterSetter(x,"fillRadialGradientEndPointY",0),f.Factory.addGetterSetter(x,"fillPatternRotation",0),f.Factory.addGetterSetter(x,"fillRule",void 0,(0,o.getStringValidator)()),f.Factory.backCompat(x,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})}(Si)),Si}var sn;function As(){if(sn)return ue;sn=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.Layer=void 0;const s=ot(),t=gi(),u=lt(),f=et(),m=ui(),o=it(),n=ut(),i=Q(),c="#",l="beforeDraw",g="draw",v=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],C=v.length;let d=class extends t.Container{constructor(p){super(p),this.canvas=new m.SceneCanvas,this.hitCanvas=new m.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(p){return this.getContext().clear(p),this.getHitCanvas().getContext().clear(p),this}setZIndex(p){super.setZIndex(p);const b=this.getStage();return b&&b.content&&(b.content.removeChild(this.getNativeCanvasElement()),p<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[p+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){u.Node.prototype.moveToTop.call(this);const p=this.getStage();return p&&p.content&&(p.content.removeChild(this.getNativeCanvasElement()),p.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!u.Node.prototype.moveUp.call(this))return!1;const b=this.getStage();return!b||!b.content?!1:(b.content.removeChild(this.getNativeCanvasElement()),this.index<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[this.index+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(u.Node.prototype.moveDown.call(this)){const p=this.getStage();if(p){const b=p.children;p.content&&(p.content.removeChild(this.getNativeCanvasElement()),p.content.insertBefore(this.getNativeCanvasElement(),b[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(u.Node.prototype.moveToBottom.call(this)){const p=this.getStage();if(p){const b=p.children;p.content&&(p.content.removeChild(this.getNativeCanvasElement()),p.content.insertBefore(this.getNativeCanvasElement(),b[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const p=this.getNativeCanvasElement();return u.Node.prototype.remove.call(this),p&&p.parentNode&&s.Util._isInDocument(p)&&p.parentNode.removeChild(p),this}getStage(){return this.parent}setSize({width:p,height:b}){return this.canvas.setSize(p,b),this.hitCanvas.setSize(p,b),this._setSmoothEnabled(),this}_validateAdd(p){const b=p.getType();b!=="Group"&&b!=="Shape"&&s.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(p){return p=p||{},p.width=p.width||this.getWidth(),p.height=p.height||this.getHeight(),p.x=p.x!==void 0?p.x:this.x(),p.y=p.y!==void 0?p.y:this.y(),u.Node.prototype._toKonvaCanvas.call(this,p)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){s.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){s.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,s.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(p){if(!this.isListening()||!this.isVisible())return null;let b=1,I=!1;for(;;){for(let r=0;r<C;r++){const e=v[r],y=this._getIntersection({x:p.x+e.x*b,y:p.y+e.y*b}),w=y.shape;if(w)return w;if(I=!!y.antialiased,!y.antialiased)break}if(I)b+=1;else return null}}_getIntersection(p){const b=this.hitCanvas.pixelRatio,I=this.hitCanvas.context.getImageData(Math.round(p.x*b),Math.round(p.y*b),1,1).data,r=I[3];if(r===255){const e=s.Util._rgbToHex(I[0],I[1],I[2]),y=n.shapes[c+e];return y?{shape:y}:{antialiased:!0}}else if(r>0)return{antialiased:!0};return{}}drawScene(p,b){const I=this.getLayer(),r=p||I&&I.getCanvas();return this._fire(l,{node:this}),this.clearBeforeDraw()&&r.getContext().clear(),t.Container.prototype.drawScene.call(this,r,b),this._fire(g,{node:this}),this}drawHit(p,b){const I=this.getLayer(),r=p||I&&I.hitCanvas;return I&&I.clearBeforeDraw()&&I.getHitCanvas().getContext().clear(),t.Container.prototype.drawHit.call(this,r,b),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(p){s.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(p)}getHitGraphEnabled(p){return s.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const p=this.parent;!!this.hitCanvas._canvas.parentNode?p.content.removeChild(this.hitCanvas._canvas):p.content.appendChild(this.hitCanvas._canvas)}destroy(){return s.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};return ue.Layer=d,d.prototype.nodeType="Layer",(0,i._registerNode)(d),f.Factory.addGetterSetter(d,"imageSmoothingEnabled",!0),f.Factory.addGetterSetter(d,"clearBeforeDraw",!0),f.Factory.addGetterSetter(d,"hitGraphEnabled",!0,(0,o.getBooleanValidator)()),ue}var ge={},rn;function wr(){if(rn)return ge;rn=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.FastLayer=void 0;const s=ot(),t=As(),u=Q();let f=class extends t.Layer{constructor(o){super(o),this.listening(!1),s.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return ge.FastLayer=f,f.prototype.nodeType="FastLayer",(0,u._registerNode)(f),ge}var fe={},an;function Li(){if(an)return fe;an=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.Group=void 0;const s=ot(),t=gi(),u=Q();let f=class extends t.Container{_validateAdd(o){const n=o.getType();n!=="Group"&&n!=="Shape"&&s.Util.throw("You may only add groups and shapes to groups.")}};return fe.Group=f,f.prototype.nodeType="Group",(0,u._registerNode)(f),fe}var me={},on;function Bi(){if(on)return me;on=1,Object.defineProperty(me,"__esModule",{value:!0}),me.Animation=void 0;const s=Q(),t=ot(),u=function(){return s.glob.performance&&s.glob.performance.now?function(){return s.glob.performance.now()}:function(){return new Date().getTime()}}();let f=class ie{constructor(o,n){this.id=ie.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:u(),frameRate:0},this.func=o,this.setLayers(n)}setLayers(o){let n=[];return o&&(n=Array.isArray(o)?o:[o]),this.layers=n,this}getLayers(){return this.layers}addLayer(o){const n=this.layers,i=n.length;for(let c=0;c<i;c++)if(n[c]._id===o._id)return!1;return this.layers.push(o),!0}isRunning(){const n=ie.animations,i=n.length;for(let c=0;c<i;c++)if(n[c].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=u(),ie._addAnimation(this),this}stop(){return ie._removeAnimation(this),this}_updateFrameObject(o){this.frame.timeDiff=o-this.frame.lastTime,this.frame.lastTime=o,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(o){this.animations.push(o),this._handleAnimation()}static _removeAnimation(o){const n=o.id,i=this.animations,c=i.length;for(let l=0;l<c;l++)if(i[l].id===n){this.animations.splice(l,1);break}}static _runFrames(){const o={},n=this.animations;for(let i=0;i<n.length;i++){const c=n[i],l=c.layers,g=c.func;c._updateFrameObject(u());const v=l.length;let C;if(g?C=g.call(c,c.frame)!==!1:C=!0,!!C)for(let d=0;d<v;d++){const a=l[d];a._id!==void 0&&(o[a._id]=a)}}for(const i in o)o.hasOwnProperty(i)&&o[i].batchDraw()}static _animationLoop(){const o=ie;o.animations.length?(o._runFrames(),t.Util.requestAnimFrame(o._animationLoop)):o.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,t.Util.requestAnimFrame(this._animationLoop))}};return me.Animation=f,f.animations=[],f.animIdCounter=0,f.animRunning=!1,me}var wi={},hn;function Ar(){return hn||(hn=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Easings=s.Tween=void 0;const t=ot(),u=Bi(),f=lt(),m=Q(),o={node:1,duration:1,easing:1,onFinish:1,yoyo:1},n=1,i=2,c=3,l=["fill","stroke","shadowColor"];let g=0;class v{constructor(a,p,b,I,r,e,y){this.prop=a,this.propFunc=p,this.begin=I,this._pos=I,this.duration=e,this._change=0,this.prevPos=0,this.yoyo=y,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=b,this._change=r-this.begin,this.pause()}fire(a){const p=this[a];p&&p()}setTime(a){a>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():a<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())}getTime(){return this._time}setPosition(a){this.prevPos=this._pos,this.propFunc(a),this._pos=a}getPosition(a){return a===void 0&&(a=this._time),this.func(a,this.begin,this._change,this.duration)}play(){this.state=i,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=c,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(a){this.pause(),this._time=a,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const a=this.getTimer()-this._startTime;this.state===i?this.setTime(a):this.state===c&&this.setTime(this.duration-a)}pause(){this.state=n,this.fire("onPause")}getTimer(){return new Date().getTime()}}class C{constructor(a){const p=this,b=a.node,I=b._id,r=a.easing||s.Easings.Linear,e=!!a.yoyo;let y,w;typeof a.duration>"u"?y=.3:a.duration===0?y=.001:y=a.duration,this.node=b,this._id=g++;const P=b.getLayer()||(b instanceof m.Konva.Stage?b.getLayers():null);P||t.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new u.Animation(function(){p.tween.onEnterFrame()},P),this.tween=new v(w,function(M){p._tweenFunc(M)},r,0,1,y*1e3,e),this._addListeners(),C.attrs[I]||(C.attrs[I]={}),C.attrs[I][this._id]||(C.attrs[I][this._id]={}),C.tweens[I]||(C.tweens[I]={});for(w in a)o[w]===void 0&&this._addAttr(w,a[w]);this.reset(),this.onFinish=a.onFinish,this.onReset=a.onReset,this.onUpdate=a.onUpdate}_addAttr(a,p){const b=this.node,I=b._id;let r,e,y,w,P;const M=C.tweens[I][a];M&&delete C.attrs[I][M][a];let x=b.getAttr(a);if(t.Util._isArray(p))if(r=[],e=Math.max(p.length,x.length),a==="points"&&p.length!==x.length&&(p.length>x.length?(w=x,x=t.Util._prepareArrayForTween(x,p,b.closed())):(y=p,p=t.Util._prepareArrayForTween(p,x,b.closed()))),a.indexOf("fill")===0)for(let E=0;E<e;E++)if(E%2===0)r.push(p[E]-x[E]);else{const A=t.Util.colorToRGBA(x[E]);P=t.Util.colorToRGBA(p[E]),x[E]=A,r.push({r:P.r-A.r,g:P.g-A.g,b:P.b-A.b,a:P.a-A.a})}else for(let E=0;E<e;E++)r.push(p[E]-x[E]);else l.indexOf(a)!==-1?(x=t.Util.colorToRGBA(x),P=t.Util.colorToRGBA(p),r={r:P.r-x.r,g:P.g-x.g,b:P.b-x.b,a:P.a-x.a}):r=p-x;C.attrs[I][this._id][a]={start:x,diff:r,end:p,trueEnd:y,trueStart:w},C.tweens[I][a]=this._id}_tweenFunc(a){const p=this.node,b=C.attrs[p._id][this._id];let I,r,e,y,w,P,M,x;for(I in b){if(r=b[I],e=r.start,y=r.diff,x=r.end,t.Util._isArray(e))if(w=[],M=Math.max(e.length,x.length),I.indexOf("fill")===0)for(P=0;P<M;P++)P%2===0?w.push((e[P]||0)+y[P]*a):w.push("rgba("+Math.round(e[P].r+y[P].r*a)+","+Math.round(e[P].g+y[P].g*a)+","+Math.round(e[P].b+y[P].b*a)+","+(e[P].a+y[P].a*a)+")");else for(P=0;P<M;P++)w.push((e[P]||0)+y[P]*a);else l.indexOf(I)!==-1?w="rgba("+Math.round(e.r+y.r*a)+","+Math.round(e.g+y.g*a)+","+Math.round(e.b+y.b*a)+","+(e.a+y.a*a)+")":w=e+y*a;p.setAttr(I,w)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const a=this.node,p=C.attrs[a._id][this._id];p.points&&p.points.trueEnd&&a.setAttr("points",p.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const a=this.node,p=C.attrs[a._id][this._id];p.points&&p.points.trueStart&&a.points(p.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(a){return this.tween.seek(a*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const a=this.node._id,p=this._id,b=C.tweens[a];this.pause();for(const I in b)delete C.tweens[a][I];delete C.attrs[a][p]}}s.Tween=C,C.attrs={},C.tweens={},f.Node.prototype.to=function(d){const a=d.onFinish;d.node=this,d.onFinish=function(){this.destroy(),a&&a()},new C(d).play()},s.Easings={BackEaseIn(d,a,p,b){return p*(d/=b)*d*((1.70158+1)*d-1.70158)+a},BackEaseOut(d,a,p,b){return p*((d=d/b-1)*d*((1.70158+1)*d+1.70158)+1)+a},BackEaseInOut(d,a,p,b){let I=1.70158;return(d/=b/2)<1?p/2*(d*d*(((I*=1.525)+1)*d-I))+a:p/2*((d-=2)*d*(((I*=1.525)+1)*d+I)+2)+a},ElasticEaseIn(d,a,p,b,I,r){let e=0;return d===0?a:(d/=b)===1?a+p:(r||(r=b*.3),!I||I<Math.abs(p)?(I=p,e=r/4):e=r/(2*Math.PI)*Math.asin(p/I),-(I*Math.pow(2,10*(d-=1))*Math.sin((d*b-e)*(2*Math.PI)/r))+a)},ElasticEaseOut(d,a,p,b,I,r){let e=0;return d===0?a:(d/=b)===1?a+p:(r||(r=b*.3),!I||I<Math.abs(p)?(I=p,e=r/4):e=r/(2*Math.PI)*Math.asin(p/I),I*Math.pow(2,-10*d)*Math.sin((d*b-e)*(2*Math.PI)/r)+p+a)},ElasticEaseInOut(d,a,p,b,I,r){let e=0;return d===0?a:(d/=b/2)===2?a+p:(r||(r=b*(.3*1.5)),!I||I<Math.abs(p)?(I=p,e=r/4):e=r/(2*Math.PI)*Math.asin(p/I),d<1?-.5*(I*Math.pow(2,10*(d-=1))*Math.sin((d*b-e)*(2*Math.PI)/r))+a:I*Math.pow(2,-10*(d-=1))*Math.sin((d*b-e)*(2*Math.PI)/r)*.5+p+a)},BounceEaseOut(d,a,p,b){return(d/=b)<1/2.75?p*(7.5625*d*d)+a:d<2/2.75?p*(7.5625*(d-=1.5/2.75)*d+.75)+a:d<2.5/2.75?p*(7.5625*(d-=2.25/2.75)*d+.9375)+a:p*(7.5625*(d-=2.625/2.75)*d+.984375)+a},BounceEaseIn(d,a,p,b){return p-s.Easings.BounceEaseOut(b-d,0,p,b)+a},BounceEaseInOut(d,a,p,b){return d<b/2?s.Easings.BounceEaseIn(d*2,0,p,b)*.5+a:s.Easings.BounceEaseOut(d*2-b,0,p,b)*.5+p*.5+a},EaseIn(d,a,p,b){return p*(d/=b)*d+a},EaseOut(d,a,p,b){return-p*(d/=b)*(d-2)+a},EaseInOut(d,a,p,b){return(d/=b/2)<1?p/2*d*d+a:-p/2*(--d*(d-2)-1)+a},StrongEaseIn(d,a,p,b){return p*(d/=b)*d*d*d*d+a},StrongEaseOut(d,a,p,b){return p*((d=d/b-1)*d*d*d*d+1)+a},StrongEaseInOut(d,a,p,b){return(d/=b/2)<1?p/2*d*d*d*d*d+a:p/2*((d-=2)*d*d*d*d+2)+a},Linear(d,a,p,b){return p*d/b+a}}}(wi)),wi}var ln;function Er(){return ln||(ln=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Konva=void 0;const t=Q(),u=ot(),f=lt(),m=gi(),o=Sr(),n=As(),i=wr(),c=Li(),l=Ni(),g=ut(),v=Bi(),C=Ar(),d=Ss(),a=ui();s.Konva=u.Util._assign(t.Konva,{Util:u.Util,Transform:u.Transform,Node:f.Node,Container:m.Container,Stage:o.Stage,stages:o.stages,Layer:n.Layer,FastLayer:i.FastLayer,Group:c.Group,DD:l.DD,Shape:g.Shape,shapes:g.shapes,Animation:v.Animation,Tween:C.Tween,Easings:C.Easings,Context:d.Context,Canvas:a.Canvas}),s.default=s.Konva}(pi)),pi}var pe={},dn;function Ir(){if(dn)return pe;dn=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.Arc=void 0;const s=et(),t=ut(),u=Q(),f=it(),m=Q();let o=class extends t.Shape{_sceneFunc(i){const c=u.Konva.getAngle(this.angle()),l=this.clockwise();i.beginPath(),i.arc(0,0,this.outerRadius(),0,c,l),i.arc(0,0,this.innerRadius(),c,0,!l),i.closePath(),i.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(i){this.outerRadius(i/2)}setHeight(i){this.outerRadius(i/2)}getSelfRect(){const i=this.innerRadius(),c=this.outerRadius(),l=this.clockwise(),g=u.Konva.getAngle(l?360-this.angle():this.angle()),v=Math.cos(Math.min(g,Math.PI)),C=1,d=Math.sin(Math.min(Math.max(Math.PI,g),3*Math.PI/2)),a=Math.sin(Math.min(g,Math.PI/2)),p=v*(v>0?i:c),b=C*c,I=d*(d>0?i:c),r=a*(a>0?c:i);return{x:p,y:l?-1*r:I,width:b-p,height:r-I}}};return pe.Arc=o,o.prototype._centroid=!0,o.prototype.className="Arc",o.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"],(0,m._registerNode)(o),s.Factory.addGetterSetter(o,"innerRadius",0,(0,f.getNumberValidator)()),s.Factory.addGetterSetter(o,"outerRadius",0,(0,f.getNumberValidator)()),s.Factory.addGetterSetter(o,"angle",0,(0,f.getNumberValidator)()),s.Factory.addGetterSetter(o,"clockwise",!1,(0,f.getBooleanValidator)()),pe}var ye={},_e={},cn;function Es(){if(cn)return _e;cn=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.Line=void 0;const s=et(),t=Q(),u=ut(),f=it();function m(i,c,l,g,v,C,d){const a=Math.sqrt(Math.pow(l-i,2)+Math.pow(g-c,2)),p=Math.sqrt(Math.pow(v-l,2)+Math.pow(C-g,2)),b=d*a/(a+p),I=d*p/(a+p),r=l-b*(v-i),e=g-b*(C-c),y=l+I*(v-i),w=g+I*(C-c);return[r,e,y,w]}function o(i,c){const l=i.length,g=[];for(let v=2;v<l-2;v+=2){const C=m(i[v-2],i[v-1],i[v],i[v+1],i[v+2],i[v+3],c);isNaN(C[0])||(g.push(C[0]),g.push(C[1]),g.push(i[v]),g.push(i[v+1]),g.push(C[2]),g.push(C[3]))}return g}let n=class extends u.Shape{constructor(c){super(c),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(c){let l=this.points(),g=l.length,v=this.tension(),C=this.closed(),d=this.bezier(),a,p,b;if(g){if(c.beginPath(),c.moveTo(l[0],l[1]),v!==0&&g>4){for(a=this.getTensionPoints(),p=a.length,b=C?0:4,C||c.quadraticCurveTo(a[0],a[1],a[2],a[3]);b<p-2;)c.bezierCurveTo(a[b++],a[b++],a[b++],a[b++],a[b++],a[b++]);C||c.quadraticCurveTo(a[p-2],a[p-1],l[g-2],l[g-1])}else if(d)for(b=2;b<g;)c.bezierCurveTo(l[b++],l[b++],l[b++],l[b++],l[b++],l[b++]);else for(b=2;b<g;b+=2)c.lineTo(l[b],l[b+1]);C?(c.closePath(),c.fillStrokeShape(this)):c.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():o(this.points(),this.tension())}_getTensionPointsClosed(){const c=this.points(),l=c.length,g=this.tension(),v=m(c[l-2],c[l-1],c[0],c[1],c[2],c[3],g),C=m(c[l-4],c[l-3],c[l-2],c[l-1],c[0],c[1],g),d=o(c,g);return[v[2],v[3]].concat(d).concat([C[0],C[1],c[l-2],c[l-1],C[2],C[3],v[0],v[1],c[0],c[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let c=this.points();if(c.length<4)return{x:c[0]||0,y:c[1]||0,width:0,height:0};this.tension()!==0?c=[c[0],c[1],...this._getTensionPoints(),c[c.length-2],c[c.length-1]]:c=this.points();let l=c[0],g=c[0],v=c[1],C=c[1],d,a;for(let p=0;p<c.length/2;p++)d=c[p*2],a=c[p*2+1],l=Math.min(l,d),g=Math.max(g,d),v=Math.min(v,a),C=Math.max(C,a);return{x:l,y:v,width:g-l,height:C-v}}};return _e.Line=n,n.prototype.className="Line",n.prototype._attrsAffectingSize=["points","bezier","tension"],(0,t._registerNode)(n),s.Factory.addGetterSetter(n,"closed",!1),s.Factory.addGetterSetter(n,"bezier",!1),s.Factory.addGetterSetter(n,"tension",0,(0,f.getNumberValidator)()),s.Factory.addGetterSetter(n,"points",[],(0,f.getNumberArrayValidator)()),_e}var ve={},Ai={},un;function Pr(){return un||(un=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.t2length=s.getQuadraticArcLength=s.getCubicArcLength=s.binomialCoefficients=s.cValues=s.tValues=void 0,s.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],s.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],s.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const t=(n,i,c)=>{let l,g;const C=c/2;l=0;for(let d=0;d<20;d++)g=C*s.tValues[20][d]+C,l+=s.cValues[20][d]*f(n,i,g);return C*l};s.getCubicArcLength=t;const u=(n,i,c)=>{c===void 0&&(c=1);const l=n[0]-2*n[1]+n[2],g=i[0]-2*i[1]+i[2],v=2*n[1]-2*n[0],C=2*i[1]-2*i[0],d=4*(l*l+g*g),a=4*(l*v+g*C),p=v*v+C*C;if(d===0)return c*Math.sqrt(Math.pow(n[2]-n[0],2)+Math.pow(i[2]-i[0],2));const b=a/(2*d),I=p/d,r=c+b,e=I-b*b,y=r*r+e>0?Math.sqrt(r*r+e):0,w=b*b+e>0?Math.sqrt(b*b+e):0,P=b+Math.sqrt(b*b+e)!==0?e*Math.log(Math.abs((r+y)/(b+w))):0;return Math.sqrt(d)/2*(r*y-b*w+P)};s.getQuadraticArcLength=u;function f(n,i,c){const l=m(1,c,n),g=m(1,c,i),v=l*l+g*g;return Math.sqrt(v)}const m=(n,i,c)=>{const l=c.length-1;let g,v;if(l===0)return 0;if(n===0){v=0;for(let C=0;C<=l;C++)v+=s.binomialCoefficients[l][C]*Math.pow(1-i,l-C)*Math.pow(i,C)*c[C];return v}else{g=new Array(l);for(let C=0;C<l;C++)g[C]=l*(c[C+1]-c[C]);return m(n-1,i,g)}},o=(n,i,c)=>{let l=1,g=n/i,v=(n-c(g))/i,C=0;for(;l>.001;){const d=c(g+v),a=Math.abs(n-d)/i;if(a<l)l=a,g+=v;else{const p=c(g-v),b=Math.abs(n-p)/i;b<l?(l=b,g-=v):v/=2}if(C++,C>500)break}return g};s.t2length=o}(Ai)),Ai}var gn;function Oi(){if(gn)return ve;gn=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.Path=void 0;const s=et(),t=ut(),u=Q(),f=Pr();let m=class _t extends t.Shape{constructor(n){super(n),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=_t.parsePathData(this.data()),this.pathLength=_t.getPathLength(this.dataArray)}_sceneFunc(n){const i=this.dataArray;n.beginPath();let c=!1;for(let y=0;y<i.length;y++){const w=i[y].command,P=i[y].points;switch(w){case"L":n.lineTo(P[0],P[1]);break;case"M":n.moveTo(P[0],P[1]);break;case"C":n.bezierCurveTo(P[0],P[1],P[2],P[3],P[4],P[5]);break;case"Q":n.quadraticCurveTo(P[0],P[1],P[2],P[3]);break;case"A":var l=P[0],g=P[1],v=P[2],C=P[3],d=P[4],a=P[5],p=P[6],b=P[7],I=v>C?v:C,r=v>C?1:v/C,e=v>C?C/v:1;n.translate(l,g),n.rotate(p),n.scale(r,e),n.arc(0,0,I,d,d+a,1-b),n.scale(1/r,1/e),n.rotate(-p),n.translate(-l,-g);break;case"z":c=!0,n.closePath();break}}!c&&!this.hasFill()?n.strokeShape(this):n.fillStrokeShape(this)}getSelfRect(){let n=[];this.dataArray.forEach(function(d){if(d.command==="A"){const a=d.points[4],p=d.points[5],b=d.points[4]+p;let I=Math.PI/180;if(Math.abs(a-b)<I&&(I=Math.abs(a-b)),p<0)for(let r=a-I;r>b;r-=I){const e=_t.getPointOnEllipticalArc(d.points[0],d.points[1],d.points[2],d.points[3],r,0);n.push(e.x,e.y)}else for(let r=a+I;r<b;r+=I){const e=_t.getPointOnEllipticalArc(d.points[0],d.points[1],d.points[2],d.points[3],r,0);n.push(e.x,e.y)}}else if(d.command==="C")for(let a=0;a<=1;a+=.01){const p=_t.getPointOnCubicBezier(a,d.start.x,d.start.y,d.points[0],d.points[1],d.points[2],d.points[3],d.points[4],d.points[5]);n.push(p.x,p.y)}else n=n.concat(d.points)});let i=n[0],c=n[0],l=n[1],g=n[1],v,C;for(let d=0;d<n.length/2;d++)v=n[d*2],C=n[d*2+1],isNaN(v)||(i=Math.min(i,v),c=Math.max(c,v)),isNaN(C)||(l=Math.min(l,C),g=Math.max(g,C));return{x:i,y:l,width:c-i,height:g-l}}getLength(){return this.pathLength}getPointAtLength(n){return _t.getPointAtLengthOfDataArray(n,this.dataArray)}static getLineLength(n,i,c,l){return Math.sqrt((c-n)*(c-n)+(l-i)*(l-i))}static getPathLength(n){let i=0;for(let c=0;c<n.length;++c)i+=n[c].pathLength;return i}static getPointAtLengthOfDataArray(n,i){let c,l=0,g=i.length;if(!g)return null;for(;l<g&&n>i[l].pathLength;)n-=i[l].pathLength,++l;if(l===g)return c=i[l-1].points.slice(-2),{x:c[0],y:c[1]};if(n<.01)return c=i[l].points.slice(0,2),{x:c[0],y:c[1]};const v=i[l],C=v.points;switch(v.command){case"L":return _t.getPointOnLine(n,v.start.x,v.start.y,C[0],C[1]);case"C":return _t.getPointOnCubicBezier((0,f.t2length)(n,_t.getPathLength(i),y=>(0,f.getCubicArcLength)([v.start.x,C[0],C[2],C[4]],[v.start.y,C[1],C[3],C[5]],y)),v.start.x,v.start.y,C[0],C[1],C[2],C[3],C[4],C[5]);case"Q":return _t.getPointOnQuadraticBezier((0,f.t2length)(n,_t.getPathLength(i),y=>(0,f.getQuadraticArcLength)([v.start.x,C[0],C[2]],[v.start.y,C[1],C[3]],y)),v.start.x,v.start.y,C[0],C[1],C[2],C[3]);case"A":var d=C[0],a=C[1],p=C[2],b=C[3],I=C[4],r=C[5],e=C[6];return I+=r*n/v.pathLength,_t.getPointOnEllipticalArc(d,a,p,b,I,e)}return null}static getPointOnLine(n,i,c,l,g,v,C){v=v??i,C=C??c;const d=this.getLineLength(i,c,l,g);if(d<1e-10)return{x:i,y:c};if(l===i)return{x:v,y:C+(g>c?n:-n)};const a=(g-c)/(l-i),p=Math.sqrt(n*n/(1+a*a))*(l<i?-1:1),b=a*p;if(Math.abs(C-c-a*(v-i))<1e-10)return{x:v+p,y:C+b};const I=((v-i)*(l-i)+(C-c)*(g-c))/(d*d),r=i+I*(l-i),e=c+I*(g-c),y=this.getLineLength(v,C,r,e),w=Math.sqrt(n*n-y*y),P=Math.sqrt(w*w/(1+a*a))*(l<i?-1:1),M=a*P;return{x:r+P,y:e+M}}static getPointOnCubicBezier(n,i,c,l,g,v,C,d,a){function p(w){return w*w*w}function b(w){return 3*w*w*(1-w)}function I(w){return 3*w*(1-w)*(1-w)}function r(w){return(1-w)*(1-w)*(1-w)}const e=d*p(n)+v*b(n)+l*I(n)+i*r(n),y=a*p(n)+C*b(n)+g*I(n)+c*r(n);return{x:e,y}}static getPointOnQuadraticBezier(n,i,c,l,g,v,C){function d(r){return r*r}function a(r){return 2*r*(1-r)}function p(r){return(1-r)*(1-r)}const b=v*d(n)+l*a(n)+i*p(n),I=C*d(n)+g*a(n)+c*p(n);return{x:b,y:I}}static getPointOnEllipticalArc(n,i,c,l,g,v){const C=Math.cos(v),d=Math.sin(v),a={x:c*Math.cos(g),y:l*Math.sin(g)};return{x:n+(a.x*C-a.y*d),y:i+(a.x*d+a.y*C)}}static parsePathData(n){if(!n)return[];let i=n;const c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];i=i.replace(new RegExp(" ","g"),",");for(var l=0;l<c.length;l++)i=i.replace(new RegExp(c[l],"g"),"|"+c[l]);const g=i.split("|"),v=[],C=[];let d=0,a=0;const p=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let b;for(l=1;l<g.length;l++){let h=g[l],S=h.charAt(0);for(h=h.slice(1),C.length=0;b=p.exec(h);)C.push(b[0]);const _=[];for(let T=0,G=C.length;T<G;T++){if(C[T]==="00"){_.push(0,0);continue}const N=parseFloat(C[T]);isNaN(N)?_.push(0):_.push(N)}for(;_.length>0&&!isNaN(_[0]);){let T="",G=[];const N=d,O=a;var I,r,e,y,w,P,M,x,E,A;switch(S){case"l":d+=_.shift(),a+=_.shift(),T="L",G.push(d,a);break;case"L":d=_.shift(),a=_.shift(),G.push(d,a);break;case"m":var R=_.shift(),k=_.shift();if(d+=R,a+=k,T="M",v.length>2&&v[v.length-1].command==="z"){for(let L=v.length-2;L>=0;L--)if(v[L].command==="M"){d=v[L].points[0]+R,a=v[L].points[1]+k;break}}G.push(d,a),S="l";break;case"M":d=_.shift(),a=_.shift(),T="M",G.push(d,a),S="L";break;case"h":d+=_.shift(),T="L",G.push(d,a);break;case"H":d=_.shift(),T="L",G.push(d,a);break;case"v":a+=_.shift(),T="L",G.push(d,a);break;case"V":a=_.shift(),T="L",G.push(d,a);break;case"C":G.push(_.shift(),_.shift(),_.shift(),_.shift()),d=_.shift(),a=_.shift(),G.push(d,a);break;case"c":G.push(d+_.shift(),a+_.shift(),d+_.shift(),a+_.shift()),d+=_.shift(),a+=_.shift(),T="C",G.push(d,a);break;case"S":r=d,e=a,I=v[v.length-1],I.command==="C"&&(r=d+(d-I.points[2]),e=a+(a-I.points[3])),G.push(r,e,_.shift(),_.shift()),d=_.shift(),a=_.shift(),T="C",G.push(d,a);break;case"s":r=d,e=a,I=v[v.length-1],I.command==="C"&&(r=d+(d-I.points[2]),e=a+(a-I.points[3])),G.push(r,e,d+_.shift(),a+_.shift()),d+=_.shift(),a+=_.shift(),T="C",G.push(d,a);break;case"Q":G.push(_.shift(),_.shift()),d=_.shift(),a=_.shift(),G.push(d,a);break;case"q":G.push(d+_.shift(),a+_.shift()),d+=_.shift(),a+=_.shift(),T="Q",G.push(d,a);break;case"T":r=d,e=a,I=v[v.length-1],I.command==="Q"&&(r=d+(d-I.points[0]),e=a+(a-I.points[1])),d=_.shift(),a=_.shift(),T="Q",G.push(r,e,d,a);break;case"t":r=d,e=a,I=v[v.length-1],I.command==="Q"&&(r=d+(d-I.points[0]),e=a+(a-I.points[1])),d+=_.shift(),a+=_.shift(),T="Q",G.push(r,e,d,a);break;case"A":y=_.shift(),w=_.shift(),P=_.shift(),M=_.shift(),x=_.shift(),E=d,A=a,d=_.shift(),a=_.shift(),T="A",G=this.convertEndpointToCenterParameterization(E,A,d,a,M,x,y,w,P);break;case"a":y=_.shift(),w=_.shift(),P=_.shift(),M=_.shift(),x=_.shift(),E=d,A=a,d+=_.shift(),a+=_.shift(),T="A",G=this.convertEndpointToCenterParameterization(E,A,d,a,M,x,y,w,P);break}v.push({command:T||S,points:G,start:{x:N,y:O},pathLength:this.calcLength(N,O,T||S,G)})}(S==="z"||S==="Z")&&v.push({command:"z",points:[],start:void 0,pathLength:0})}return v}static calcLength(n,i,c,l){let g,v,C,d;const a=_t;switch(c){case"L":return a.getLineLength(n,i,l[0],l[1]);case"C":return(0,f.getCubicArcLength)([n,l[0],l[2],l[4]],[i,l[1],l[3],l[5]],1);case"Q":return(0,f.getQuadraticArcLength)([n,l[0],l[2]],[i,l[1],l[3]],1);case"A":g=0;var p=l[4],b=l[5],I=l[4]+b,r=Math.PI/180;if(Math.abs(p-I)<r&&(r=Math.abs(p-I)),v=a.getPointOnEllipticalArc(l[0],l[1],l[2],l[3],p,0),b<0)for(d=p-r;d>I;d-=r)C=a.getPointOnEllipticalArc(l[0],l[1],l[2],l[3],d,0),g+=a.getLineLength(v.x,v.y,C.x,C.y),v=C;else for(d=p+r;d<I;d+=r)C=a.getPointOnEllipticalArc(l[0],l[1],l[2],l[3],d,0),g+=a.getLineLength(v.x,v.y,C.x,C.y),v=C;return C=a.getPointOnEllipticalArc(l[0],l[1],l[2],l[3],I,0),g+=a.getLineLength(v.x,v.y,C.x,C.y),g}return 0}static convertEndpointToCenterParameterization(n,i,c,l,g,v,C,d,a){const p=a*(Math.PI/180),b=Math.cos(p)*(n-c)/2+Math.sin(p)*(i-l)/2,I=-1*Math.sin(p)*(n-c)/2+Math.cos(p)*(i-l)/2,r=b*b/(C*C)+I*I/(d*d);r>1&&(C*=Math.sqrt(r),d*=Math.sqrt(r));let e=Math.sqrt((C*C*(d*d)-C*C*(I*I)-d*d*(b*b))/(C*C*(I*I)+d*d*(b*b)));g===v&&(e*=-1),isNaN(e)&&(e=0);const y=e*C*I/d,w=e*-d*b/C,P=(n+c)/2+Math.cos(p)*y-Math.sin(p)*w,M=(i+l)/2+Math.sin(p)*y+Math.cos(p)*w,x=function(_){return Math.sqrt(_[0]*_[0]+_[1]*_[1])},E=function(_,T){return(_[0]*T[0]+_[1]*T[1])/(x(_)*x(T))},A=function(_,T){return(_[0]*T[1]<_[1]*T[0]?-1:1)*Math.acos(E(_,T))},R=A([1,0],[(b-y)/C,(I-w)/d]),k=[(b-y)/C,(I-w)/d],h=[(-1*b-y)/C,(-1*I-w)/d];let S=A(k,h);return E(k,h)<=-1&&(S=Math.PI),E(k,h)>=1&&(S=0),v===0&&S>0&&(S=S-2*Math.PI),v===1&&S<0&&(S=S+2*Math.PI),[P,M,C,d,R,S,p,v]}};return ve.Path=m,m.prototype.className="Path",m.prototype._attrsAffectingSize=["data"],(0,u._registerNode)(m),s.Factory.addGetterSetter(m,"data"),ve}var fn;function xr(){if(fn)return ye;fn=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.Arrow=void 0;const s=et(),t=Es(),u=it(),f=Q(),m=Oi();let o=class extends t.Line{_sceneFunc(i){super._sceneFunc(i);const c=Math.PI*2,l=this.points();let g=l;const v=this.tension()!==0&&l.length>4;v&&(g=this.getTensionPoints());const C=this.pointerLength(),d=l.length;let a,p;if(v){const r=[g[g.length-4],g[g.length-3],g[g.length-2],g[g.length-1],l[d-2],l[d-1]],e=m.Path.calcLength(g[g.length-4],g[g.length-3],"C",r),y=m.Path.getPointOnQuadraticBezier(Math.min(1,1-C/e),r[0],r[1],r[2],r[3],r[4],r[5]);a=l[d-2]-y.x,p=l[d-1]-y.y}else a=l[d-2]-l[d-4],p=l[d-1]-l[d-3];const b=(Math.atan2(p,a)+c)%c,I=this.pointerWidth();this.pointerAtEnding()&&(i.save(),i.beginPath(),i.translate(l[d-2],l[d-1]),i.rotate(b),i.moveTo(0,0),i.lineTo(-C,I/2),i.lineTo(-C,-I/2),i.closePath(),i.restore(),this.__fillStroke(i)),this.pointerAtBeginning()&&(i.save(),i.beginPath(),i.translate(l[0],l[1]),v?(a=(g[0]+g[2])/2-l[0],p=(g[1]+g[3])/2-l[1]):(a=l[2]-l[0],p=l[3]-l[1]),i.rotate((Math.atan2(-p,-a)+c)%c),i.moveTo(0,0),i.lineTo(-C,I/2),i.lineTo(-C,-I/2),i.closePath(),i.restore(),this.__fillStroke(i))}__fillStroke(i){const c=this.dashEnabled();c&&(this.attrs.dashEnabled=!1,i.setLineDash([])),i.fillStrokeShape(this),c&&(this.attrs.dashEnabled=!0)}getSelfRect(){const i=super.getSelfRect(),c=this.pointerWidth()/2;return{x:i.x,y:i.y-c,width:i.width,height:i.height+c*2}}};return ye.Arrow=o,o.prototype.className="Arrow",(0,f._registerNode)(o),s.Factory.addGetterSetter(o,"pointerLength",10,(0,u.getNumberValidator)()),s.Factory.addGetterSetter(o,"pointerWidth",10,(0,u.getNumberValidator)()),s.Factory.addGetterSetter(o,"pointerAtBeginning",!1),s.Factory.addGetterSetter(o,"pointerAtEnding",!0),ye}var Ce={},mn;function Rr(){if(mn)return Ce;mn=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.Circle=void 0;const s=et(),t=ut(),u=it(),f=Q();let m=class extends t.Shape{_sceneFunc(n){n.beginPath(),n.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),n.closePath(),n.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(n){this.radius()!==n/2&&this.radius(n/2)}setHeight(n){this.radius()!==n/2&&this.radius(n/2)}};return Ce.Circle=m,m.prototype._centroid=!0,m.prototype.className="Circle",m.prototype._attrsAffectingSize=["radius"],(0,f._registerNode)(m),s.Factory.addGetterSetter(m,"radius",0,(0,u.getNumberValidator)()),Ce}var be={},pn;function Tr(){if(pn)return be;pn=1,Object.defineProperty(be,"__esModule",{value:!0}),be.Ellipse=void 0;const s=et(),t=ut(),u=it(),f=Q();let m=class extends t.Shape{_sceneFunc(n){const i=this.radiusX(),c=this.radiusY();n.beginPath(),n.save(),i!==c&&n.scale(1,c/i),n.arc(0,0,i,0,Math.PI*2,!1),n.restore(),n.closePath(),n.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(n){this.radiusX(n/2)}setHeight(n){this.radiusY(n/2)}};return be.Ellipse=m,m.prototype.className="Ellipse",m.prototype._centroid=!0,m.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,f._registerNode)(m),s.Factory.addComponentsGetterSetter(m,"radius",["x","y"]),s.Factory.addGetterSetter(m,"radiusX",0,(0,u.getNumberValidator)()),s.Factory.addGetterSetter(m,"radiusY",0,(0,u.getNumberValidator)()),be}var Se={},yn;function Gr(){if(yn)return Se;yn=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.Image=void 0;const s=ot(),t=et(),u=ut(),f=Q(),m=it();let o=class Is extends u.Shape{constructor(i){super(i),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",c=>{this._removeImageLoad(c.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const i=this.image();i&&i.complete||i&&i.readyState===4||i&&i.addEventListener&&i.addEventListener("load",this._loadListener)}_removeImageLoad(i){i&&i.removeEventListener&&i.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const i=!!this.cornerRadius(),c=this.hasShadow();return i&&c?!0:super._useBufferCanvas(!0)}_sceneFunc(i){const c=this.getWidth(),l=this.getHeight(),g=this.cornerRadius(),v=this.attrs.image;let C;if(v){const d=this.attrs.cropWidth,a=this.attrs.cropHeight;d&&a?C=[v,this.cropX(),this.cropY(),d,a,0,0,c,l]:C=[v,0,0,c,l]}(this.hasFill()||this.hasStroke()||g)&&(i.beginPath(),g?s.Util.drawRoundedRectPath(i,c,l,g):i.rect(0,0,c,l),i.closePath(),i.fillStrokeShape(this)),v&&(g&&i.clip(),i.drawImage.apply(i,C))}_hitFunc(i){const c=this.width(),l=this.height(),g=this.cornerRadius();i.beginPath(),g?s.Util.drawRoundedRectPath(i,c,l,g):i.rect(0,0,c,l),i.closePath(),i.fillStrokeShape(this)}getWidth(){var i,c;return(i=this.attrs.width)!==null&&i!==void 0?i:(c=this.image())===null||c===void 0?void 0:c.width}getHeight(){var i,c;return(i=this.attrs.height)!==null&&i!==void 0?i:(c=this.image())===null||c===void 0?void 0:c.height}static fromURL(i,c,l=null){const g=s.Util.createImageElement();g.onload=function(){const v=new Is({image:g});c(v)},g.onerror=l,g.crossOrigin="Anonymous",g.src=i}};return Se.Image=o,o.prototype.className="Image",(0,f._registerNode)(o),t.Factory.addGetterSetter(o,"cornerRadius",0,(0,m.getNumberOrArrayOfNumbersValidator)(4)),t.Factory.addGetterSetter(o,"image"),t.Factory.addComponentsGetterSetter(o,"crop",["x","y","width","height"]),t.Factory.addGetterSetter(o,"cropX",0,(0,m.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropY",0,(0,m.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropWidth",0,(0,m.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropHeight",0,(0,m.getNumberValidator)()),Se}var qt={},_n;function Fr(){if(_n)return qt;_n=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.Tag=qt.Label=void 0;const s=et(),t=ut(),u=Li(),f=it(),m=Q(),o=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],n="Change.konva",i="none",c="up",l="right",g="down",v="left",C=o.length;let d=class extends u.Group{constructor(b){super(b),this.on("add.konva",function(I){this._addListeners(I.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(b){let I=this,r;const e=function(){I._sync()};for(r=0;r<C;r++)b.on(o[r]+n,e)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let b=this.getText(),I=this.getTag(),r,e,y,w,P,M,x;if(b&&I){switch(r=b.width(),e=b.height(),y=I.pointerDirection(),w=I.pointerWidth(),x=I.pointerHeight(),P=0,M=0,y){case c:P=r/2,M=-1*x;break;case l:P=r+w,M=e/2;break;case g:P=r/2,M=e+x;break;case v:P=-1*w,M=e/2;break}I.setAttrs({x:-1*P,y:-1*M,width:r,height:e}),b.setAttrs({x:-1*P,y:-1*M})}}};qt.Label=d,d.prototype.className="Label",(0,m._registerNode)(d);class a extends t.Shape{_sceneFunc(b){const I=this.width(),r=this.height(),e=this.pointerDirection(),y=this.pointerWidth(),w=this.pointerHeight(),P=this.cornerRadius();let M=0,x=0,E=0,A=0;typeof P=="number"?M=x=E=A=Math.min(P,I/2,r/2):(M=Math.min(P[0]||0,I/2,r/2),x=Math.min(P[1]||0,I/2,r/2),A=Math.min(P[2]||0,I/2,r/2),E=Math.min(P[3]||0,I/2,r/2)),b.beginPath(),b.moveTo(M,0),e===c&&(b.lineTo((I-y)/2,0),b.lineTo(I/2,-1*w),b.lineTo((I+y)/2,0)),b.lineTo(I-x,0),b.arc(I-x,x,x,Math.PI*3/2,0,!1),e===l&&(b.lineTo(I,(r-w)/2),b.lineTo(I+y,r/2),b.lineTo(I,(r+w)/2)),b.lineTo(I,r-A),b.arc(I-A,r-A,A,0,Math.PI/2,!1),e===g&&(b.lineTo((I+y)/2,r),b.lineTo(I/2,r+w),b.lineTo((I-y)/2,r)),b.lineTo(E,r),b.arc(E,r-E,E,Math.PI/2,Math.PI,!1),e===v&&(b.lineTo(0,(r+w)/2),b.lineTo(-1*y,r/2),b.lineTo(0,(r-w)/2)),b.lineTo(0,M),b.arc(M,M,M,Math.PI,Math.PI*3/2,!1),b.closePath(),b.fillStrokeShape(this)}getSelfRect(){let b=0,I=0,r=this.pointerWidth(),e=this.pointerHeight(),y=this.pointerDirection(),w=this.width(),P=this.height();return y===c?(I-=e,P+=e):y===g?P+=e:y===v?(b-=r*1.5,w+=r):y===l&&(w+=r*1.5),{x:b,y:I,width:w,height:P}}}return qt.Tag=a,a.prototype.className="Tag",(0,m._registerNode)(a),s.Factory.addGetterSetter(a,"pointerDirection",i),s.Factory.addGetterSetter(a,"pointerWidth",0,(0,f.getNumberValidator)()),s.Factory.addGetterSetter(a,"pointerHeight",0,(0,f.getNumberValidator)()),s.Factory.addGetterSetter(a,"cornerRadius",0,(0,f.getNumberOrArrayOfNumbersValidator)(4)),qt}var we={},vn;function Ps(){if(vn)return we;vn=1,Object.defineProperty(we,"__esModule",{value:!0}),we.Rect=void 0;const s=et(),t=ut(),u=Q(),f=ot(),m=it();let o=class extends t.Shape{_sceneFunc(i){const c=this.cornerRadius(),l=this.width(),g=this.height();i.beginPath(),c?f.Util.drawRoundedRectPath(i,l,g,c):i.rect(0,0,l,g),i.closePath(),i.fillStrokeShape(this)}};return we.Rect=o,o.prototype.className="Rect",(0,u._registerNode)(o),s.Factory.addGetterSetter(o,"cornerRadius",0,(0,m.getNumberOrArrayOfNumbersValidator)(4)),we}var Ae={},Cn;function Mr(){if(Cn)return Ae;Cn=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.RegularPolygon=void 0;const s=et(),t=ut(),u=it(),f=Q();let m=class extends t.Shape{_sceneFunc(n){const i=this._getPoints();n.beginPath(),n.moveTo(i[0].x,i[0].y);for(let c=1;c<i.length;c++)n.lineTo(i[c].x,i[c].y);n.closePath(),n.fillStrokeShape(this)}_getPoints(){const n=this.attrs.sides,i=this.attrs.radius||0,c=[];for(let l=0;l<n;l++)c.push({x:i*Math.sin(l*2*Math.PI/n),y:-1*i*Math.cos(l*2*Math.PI/n)});return c}getSelfRect(){const n=this._getPoints();let i=n[0].x,c=n[0].y,l=n[0].x,g=n[0].y;return n.forEach(v=>{i=Math.min(i,v.x),c=Math.max(c,v.x),l=Math.min(l,v.y),g=Math.max(g,v.y)}),{x:i,y:l,width:c-i,height:g-l}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(n){this.radius(n/2)}setHeight(n){this.radius(n/2)}};return Ae.RegularPolygon=m,m.prototype.className="RegularPolygon",m.prototype._centroid=!0,m.prototype._attrsAffectingSize=["radius"],(0,f._registerNode)(m),s.Factory.addGetterSetter(m,"radius",0,(0,u.getNumberValidator)()),s.Factory.addGetterSetter(m,"sides",0,(0,u.getNumberValidator)()),Ae}var Ee={},bn;function kr(){if(bn)return Ee;bn=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.Ring=void 0;const s=et(),t=ut(),u=it(),f=Q(),m=Math.PI*2;let o=class extends t.Shape{_sceneFunc(i){i.beginPath(),i.arc(0,0,this.innerRadius(),0,m,!1),i.moveTo(this.outerRadius(),0),i.arc(0,0,this.outerRadius(),m,0,!0),i.closePath(),i.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(i){this.outerRadius(i/2)}setHeight(i){this.outerRadius(i/2)}};return Ee.Ring=o,o.prototype.className="Ring",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,f._registerNode)(o),s.Factory.addGetterSetter(o,"innerRadius",0,(0,u.getNumberValidator)()),s.Factory.addGetterSetter(o,"outerRadius",0,(0,u.getNumberValidator)()),Ee}var Ie={},Sn;function Nr(){if(Sn)return Ie;Sn=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.Sprite=void 0;const s=et(),t=ut(),u=Bi(),f=it(),m=Q();let o=class extends t.Shape{constructor(i){super(i),this._updated=!0,this.anim=new u.Animation(()=>{const c=this._updated;return this._updated=!1,c}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(i){const c=this.animation(),l=this.frameIndex(),g=l*4,v=this.animations()[c],C=this.frameOffsets(),d=v[g+0],a=v[g+1],p=v[g+2],b=v[g+3],I=this.image();if((this.hasFill()||this.hasStroke())&&(i.beginPath(),i.rect(0,0,p,b),i.closePath(),i.fillStrokeShape(this)),I)if(C){const r=C[c],e=l*2;i.drawImage(I,d,a,p,b,r[e+0],r[e+1],p,b)}else i.drawImage(I,d,a,p,b,0,0,p,b)}_hitFunc(i){const c=this.animation(),l=this.frameIndex(),g=l*4,v=this.animations()[c],C=this.frameOffsets(),d=v[g+2],a=v[g+3];if(i.beginPath(),C){const p=C[c],b=l*2;i.rect(p[b+0],p[b+1],d,a)}else i.rect(0,0,d,a);i.closePath(),i.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const i=this;this.interval=setInterval(function(){i._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const i=this.getLayer();this.anim.setLayers(i),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const i=this.frameIndex(),c=this.animation(),l=this.animations(),g=l[c],v=g.length/4;i<v-1?this.frameIndex(i+1):this.frameIndex(0)}};return Ie.Sprite=o,o.prototype.className="Sprite",(0,m._registerNode)(o),s.Factory.addGetterSetter(o,"animation"),s.Factory.addGetterSetter(o,"animations"),s.Factory.addGetterSetter(o,"frameOffsets"),s.Factory.addGetterSetter(o,"image"),s.Factory.addGetterSetter(o,"frameIndex",0,(0,f.getNumberValidator)()),s.Factory.addGetterSetter(o,"frameRate",17,(0,f.getNumberValidator)()),s.Factory.backCompat(o,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),Ie}var Pe={},wn;function Lr(){if(wn)return Pe;wn=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Star=void 0;const s=et(),t=ut(),u=it(),f=Q();let m=class extends t.Shape{_sceneFunc(n){const i=this.innerRadius(),c=this.outerRadius(),l=this.numPoints();n.beginPath(),n.moveTo(0,0-c);for(let g=1;g<l*2;g++){const v=g%2===0?c:i,C=v*Math.sin(g*Math.PI/l),d=-1*v*Math.cos(g*Math.PI/l);n.lineTo(C,d)}n.closePath(),n.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(n){this.outerRadius(n/2)}setHeight(n){this.outerRadius(n/2)}};return Pe.Star=m,m.prototype.className="Star",m.prototype._centroid=!0,m.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,f._registerNode)(m),s.Factory.addGetterSetter(m,"numPoints",5,(0,u.getNumberValidator)()),s.Factory.addGetterSetter(m,"innerRadius",0,(0,u.getNumberValidator)()),s.Factory.addGetterSetter(m,"outerRadius",0,(0,u.getNumberValidator)()),Pe}var ee={},An;function xs(){if(An)return ee;An=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.Text=void 0,ee.stringToArray=n;const s=ot(),t=et(),u=ut(),f=Q(),m=it(),o=Q();function n(z){return[...z].reduce((D,H,X,Y)=>{if(new RegExp("\\p{Emoji}","u").test(H)){const F=Y[X+1];F&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test(F)?(D.push(H+F),Y[X+1]=""):D.push(H)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(H+(Y[X+1]||""))?D.push(H+Y[X+1]):X>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(H)?D[D.length-1]+=H:H&&D.push(H);return D},[])}const i="auto",c="center",l="inherit",g="justify",v="Change.konva",C="2d",d="-",a="left",p="text",b="Text",I="top",r="bottom",e="middle",y="normal",w="px ",P=" ",M="right",x="rtl",E="word",A="char",R="none",k="",h=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],S=h.length;function _(z){return z.split(",").map(D=>{D=D.trim();const H=D.indexOf(" ")>=0,X=D.indexOf('"')>=0||D.indexOf("'")>=0;return H&&!X&&(D=`"${D}"`),D}).join(", ")}let T;function G(){return T||(T=s.Util.createCanvasElement().getContext(C),T)}function N(z){z.fillText(this._partialText,this._partialTextX,this._partialTextY)}function O(z){z.setAttr("miterLimit",2),z.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function L(z){return z=z||{},!z.fillLinearGradientColorStops&&!z.fillRadialGradientColorStops&&!z.fillPatternImage&&(z.fill=z.fill||"black"),z}let V=class extends u.Shape{constructor(D){super(L(D)),this._partialTextX=0,this._partialTextY=0;for(let H=0;H<S;H++)this.on(h[H]+v,this._setTextData);this._setTextData()}_sceneFunc(D){const H=this.textArr,X=H.length;if(!this.text())return;let Y=this.padding(),F=this.fontSize(),B=this.lineHeight()*F,U=this.verticalAlign(),W=this.direction(),j=0,K=this.align(),nt=this.getWidth(),st=this.letterSpacing(),J=this.fill(),gt=this.textDecoration(),rt=gt.indexOf("underline")!==-1,ht=gt.indexOf("line-through")!==-1,te;W=W===l?D.direction:W;let St=B/2,he=e;if(f.Konva._fixTextRendering){const zt=this.measureSize("M");he="alphabetic",St=(zt.fontBoundingBoxAscent-zt.fontBoundingBoxDescent)/2+B/2}var at=0,wt=0;for(W===x&&D.setAttr("direction",W),D.setAttr("font",this._getContextFont()),D.setAttr("textBaseline",he),D.setAttr("textAlign",a),U===e?j=(this.getHeight()-X*B-Y*2)/2:U===r&&(j=this.getHeight()-X*B-Y*2),D.translate(Y,j+Y),te=0;te<X;te++){var at=0,wt=0,kt=H[te],Lt=kt.text,pt=kt.width,Wt=kt.lastInParagraph,Bt,Kt;if(D.save(),K===M?at+=nt-pt-Y*2:K===c&&(at+=(nt-pt-Y*2)/2),rt){D.save(),D.beginPath();const xt=f.Konva._fixTextRendering?Math.round(F/4):Math.round(F/2),Rt=at,Tt=St+wt+xt;D.moveTo(Rt,Tt),Bt=Lt.split(" ").length-1,Kt=K===g&&!Wt?nt-Y*2:pt,D.lineTo(Rt+Math.round(Kt),Tt),D.lineWidth=F/15;const fi=this._getLinearGradient();D.strokeStyle=fi||J,D.stroke(),D.restore()}if(ht){D.save(),D.beginPath();const xt=f.Konva._fixTextRendering?-Math.round(F/4):0;D.moveTo(at,St+wt+xt),Bt=Lt.split(" ").length-1,Kt=K===g&&!Wt?nt-Y*2:pt,D.lineTo(at+Math.round(Kt),St+wt+xt),D.lineWidth=F/15;const Rt=this._getLinearGradient();D.strokeStyle=Rt||J,D.stroke(),D.restore()}if(W!==x&&(st!==0||K===g)){Bt=Lt.split(" ").length-1;const xt=n(Lt);for(let Rt=0;Rt<xt.length;Rt++){const Tt=xt[Rt];Tt===" "&&!Wt&&K===g&&(at+=(nt-Y*2-pt)/Bt),this._partialTextX=at,this._partialTextY=St+wt,this._partialText=Tt,D.fillStrokeShape(this),at+=this.measureSize(Tt).width+st}}else st!==0&&D.setAttr("letterSpacing",`${st}px`),this._partialTextX=at,this._partialTextY=St+wt,this._partialText=Lt,D.fillStrokeShape(this);D.restore(),X>1&&(St+=B)}}_hitFunc(D){const H=this.getWidth(),X=this.getHeight();D.beginPath(),D.rect(0,0,H,X),D.closePath(),D.fillStrokeShape(this)}setText(D){const H=s.Util._isString(D)?D:D==null?"":D+"";return this._setAttr(p,H),this}getWidth(){return this.attrs.width===i||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===i||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return s.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(D){var H,X,Y,F,B,U,W,j,K,nt,st;let J=G(),gt=this.fontSize(),rt;J.save(),J.font=this._getContextFont(),rt=J.measureText(D),J.restore();const ht=gt/100;return{actualBoundingBoxAscent:(H=rt.actualBoundingBoxAscent)!==null&&H!==void 0?H:71.58203125*ht,actualBoundingBoxDescent:(X=rt.actualBoundingBoxDescent)!==null&&X!==void 0?X:0,actualBoundingBoxLeft:(Y=rt.actualBoundingBoxLeft)!==null&&Y!==void 0?Y:-7.421875*ht,actualBoundingBoxRight:(F=rt.actualBoundingBoxRight)!==null&&F!==void 0?F:75.732421875*ht,alphabeticBaseline:(B=rt.alphabeticBaseline)!==null&&B!==void 0?B:0,emHeightAscent:(U=rt.emHeightAscent)!==null&&U!==void 0?U:100*ht,emHeightDescent:(W=rt.emHeightDescent)!==null&&W!==void 0?W:-20*ht,fontBoundingBoxAscent:(j=rt.fontBoundingBoxAscent)!==null&&j!==void 0?j:91*ht,fontBoundingBoxDescent:(K=rt.fontBoundingBoxDescent)!==null&&K!==void 0?K:21*ht,hangingBaseline:(nt=rt.hangingBaseline)!==null&&nt!==void 0?nt:72.80000305175781*ht,ideographicBaseline:(st=rt.ideographicBaseline)!==null&&st!==void 0?st:-21*ht,width:rt.width,height:gt}}_getContextFont(){return this.fontStyle()+P+this.fontVariant()+P+(this.fontSize()+w)+_(this.fontFamily())}_addTextLine(D){this.align()===g&&(D=D.trim());const X=this._getTextWidth(D);return this.textArr.push({text:D,width:X,lastInParagraph:!1})}_getTextWidth(D){const H=this.letterSpacing(),X=D.length;return G().measureText(D).width+H*X}_setTextData(){let D=this.text().split(`
`),H=+this.fontSize(),X=0,Y=this.lineHeight()*H,F=this.attrs.width,B=this.attrs.height,U=F!==i&&F!==void 0,W=B!==i&&B!==void 0,j=this.padding(),K=F-j*2,nt=B-j*2,st=0,J=this.wrap(),gt=J!==R,rt=J!==A&&gt,ht=this.ellipsis();this.textArr=[],G().font=this._getContextFont();const te=ht?this._getTextWidth(k):0;for(let St=0,he=D.length;St<he;++St){let at=D[St],wt=this._getTextWidth(at);if(U&&wt>K)for(;at.length>0;){let kt=0,Lt=n(at).length,pt="",Wt=0;for(;kt<Lt;){const Bt=kt+Lt>>>1,Kt=n(at),zt=Kt.slice(0,Bt+1).join(""),Xt=this._getTextWidth(zt);(ht&&W&&st+Y>nt?Xt+te:Xt)<=K?(kt=Bt+1,pt=zt,Wt=Xt):Lt=Bt}if(pt){if(rt){const zt=n(at),Xt=n(pt),xt=zt[Xt.length],Rt=xt===P||xt===d;let Tt;if(Rt&&Wt<=K)Tt=Xt.length;else{const fi=Xt.lastIndexOf(P),Ws=Xt.lastIndexOf(d);Tt=Math.max(fi,Ws)+1}Tt>0&&(kt=Tt,pt=zt.slice(0,kt).join(""),Wt=this._getTextWidth(pt))}if(pt=pt.trimRight(),this._addTextLine(pt),X=Math.max(X,Wt),st+=Y,this._shouldHandleEllipsis(st)){this._tryToAddEllipsisToLastLine();break}if(at=n(at).slice(kt).join("").trimLeft(),at.length>0&&(wt=this._getTextWidth(at),wt<=K)){this._addTextLine(at),st+=Y,X=Math.max(X,wt);break}}else break}else this._addTextLine(at),st+=Y,X=Math.max(X,wt),this._shouldHandleEllipsis(st)&&St<he-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),W&&st+Y>nt)break}this.textHeight=H,this.textWidth=X}_shouldHandleEllipsis(D){const H=+this.fontSize(),X=this.lineHeight()*H,Y=this.attrs.height,F=Y!==i&&Y!==void 0,B=this.padding(),U=Y-B*2;return!(this.wrap()!==R)||F&&D+X>U}_tryToAddEllipsisToLastLine(){const D=this.attrs.width,H=D!==i&&D!==void 0,X=this.padding(),Y=D-X*2,F=this.ellipsis(),B=this.textArr[this.textArr.length-1];!B||!F||(H&&(this._getTextWidth(B.text+k)<Y||(B.text=B.text.slice(0,B.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(B.text+k))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const D=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,H=this.hasShadow();return D&&H?!0:super._useBufferCanvas()}};return ee.Text=V,V.prototype._fillFunc=N,V.prototype._strokeFunc=O,V.prototype.className=b,V.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,o._registerNode)(V),t.Factory.overWriteSetter(V,"width",(0,m.getNumberOrAutoValidator)()),t.Factory.overWriteSetter(V,"height",(0,m.getNumberOrAutoValidator)()),t.Factory.addGetterSetter(V,"direction",l),t.Factory.addGetterSetter(V,"fontFamily","Arial"),t.Factory.addGetterSetter(V,"fontSize",12,(0,m.getNumberValidator)()),t.Factory.addGetterSetter(V,"fontStyle",y),t.Factory.addGetterSetter(V,"fontVariant",y),t.Factory.addGetterSetter(V,"padding",0,(0,m.getNumberValidator)()),t.Factory.addGetterSetter(V,"align",a),t.Factory.addGetterSetter(V,"verticalAlign",I),t.Factory.addGetterSetter(V,"lineHeight",1,(0,m.getNumberValidator)()),t.Factory.addGetterSetter(V,"wrap",E),t.Factory.addGetterSetter(V,"ellipsis",!1,(0,m.getBooleanValidator)()),t.Factory.addGetterSetter(V,"letterSpacing",0,(0,m.getNumberValidator)()),t.Factory.addGetterSetter(V,"text","",(0,m.getStringValidator)()),t.Factory.addGetterSetter(V,"textDecoration",""),ee}var xe={},En;function Br(){if(En)return xe;En=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.TextPath=void 0;const s=ot(),t=et(),u=ut(),f=Oi(),m=xs(),o=it(),n=Q(),i="",c="normal";function l(C){C.fillText(this.partialText,0,0)}function g(C){C.strokeText(this.partialText,0,0)}let v=class extends u.Shape{constructor(d){super(d),this.dummyCanvas=s.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return f.Path.getPathLength(this.dataArray)}_getPointAtLength(d){if(!this.attrs.data)return null;const a=this.pathLength;return d-1>a?null:f.Path.getPointAtLengthOfDataArray(d,this.dataArray)}_readDataAttribute(){this.dataArray=f.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(d){d.setAttr("font",this._getContextFont()),d.setAttr("textBaseline",this.textBaseline()),d.setAttr("textAlign","left"),d.save();const a=this.textDecoration(),p=this.fill(),b=this.fontSize(),I=this.glyphInfo;a==="underline"&&d.beginPath();for(let r=0;r<I.length;r++){d.save();const e=I[r].p0;d.translate(e.x,e.y),d.rotate(I[r].rotation),this.partialText=I[r].text,d.fillStrokeShape(this),a==="underline"&&(r===0&&d.moveTo(0,b/2+1),d.lineTo(b,b/2+1)),d.restore()}a==="underline"&&(d.strokeStyle=p,d.lineWidth=b/20,d.stroke()),d.restore()}_hitFunc(d){d.beginPath();const a=this.glyphInfo;if(a.length>=1){const p=a[0].p0;d.moveTo(p.x,p.y)}for(let p=0;p<a.length;p++){const b=a[p].p1;d.lineTo(b.x,b.y)}d.setAttr("lineWidth",this.fontSize()),d.setAttr("strokeStyle",this.colorKey),d.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return s.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(d){return m.Text.prototype.setText.call(this,d)}_getContextFont(){return m.Text.prototype._getContextFont.call(this)}_getTextSize(d){const p=this.dummyCanvas.getContext("2d");p.save(),p.font=this._getContextFont();const b=p.measureText(d);return p.restore(),{width:b.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:d,height:a}=this._getTextSize(this.attrs.text);if(this.textWidth=d,this.textHeight=a,this.glyphInfo=[],!this.attrs.data)return null;const p=this.letterSpacing(),b=this.align(),I=this.kerningFunc(),r=Math.max(this.textWidth+((this.attrs.text||"").length-1)*p,0);let e=0;b==="center"&&(e=Math.max(0,this.pathLength/2-r/2)),b==="right"&&(e=Math.max(0,this.pathLength-r));const y=(0,m.stringToArray)(this.text());let w=e;for(let P=0;P<y.length;P++){const M=this._getPointAtLength(w);if(!M)return;let x=this._getTextSize(y[P]).width+p;if(y[P]===" "&&b==="justify"){const S=this.text().split(" ").length-1;x+=(this.pathLength-r)/S}const E=this._getPointAtLength(w+x);if(!E)return;const A=f.Path.getLineLength(M.x,M.y,E.x,E.y);let R=0;if(I)try{R=I(y[P-1],y[P])*this.fontSize()}catch{R=0}M.x+=R,E.x+=R,this.textWidth+=R;const k=f.Path.getPointOnLine(R+A/2,M.x,M.y,E.x,E.y),h=Math.atan2(E.y-M.y,E.x-M.x);this.glyphInfo.push({transposeX:k.x,transposeY:k.y,text:y[P],rotation:h,p0:M,p1:E}),w+=x}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const d=[];this.glyphInfo.forEach(function(w){d.push(w.p0.x),d.push(w.p0.y),d.push(w.p1.x),d.push(w.p1.y)});let a=d[0]||0,p=d[0]||0,b=d[1]||0,I=d[1]||0,r,e;for(let w=0;w<d.length/2;w++)r=d[w*2],e=d[w*2+1],a=Math.min(a,r),p=Math.max(p,r),b=Math.min(b,e),I=Math.max(I,e);const y=this.fontSize();return{x:a-y/2,y:b-y/2,width:p-a+y,height:I-b+y}}destroy(){return s.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return xe.TextPath=v,v.prototype._fillFunc=l,v.prototype._strokeFunc=g,v.prototype._fillFuncHit=l,v.prototype._strokeFuncHit=g,v.prototype.className="TextPath",v.prototype._attrsAffectingSize=["text","fontSize","data"],(0,n._registerNode)(v),t.Factory.addGetterSetter(v,"data"),t.Factory.addGetterSetter(v,"fontFamily","Arial"),t.Factory.addGetterSetter(v,"fontSize",12,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(v,"fontStyle",c),t.Factory.addGetterSetter(v,"align","left"),t.Factory.addGetterSetter(v,"letterSpacing",0,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(v,"textBaseline","middle"),t.Factory.addGetterSetter(v,"fontVariant",c),t.Factory.addGetterSetter(v,"text",i),t.Factory.addGetterSetter(v,"textDecoration",""),t.Factory.addGetterSetter(v,"kerningFunc",void 0),xe}var Re={},In;function Rs(){if(In)return Re;In=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.Transformer=void 0;const s=ot(),t=et(),u=lt(),f=ut(),m=Ps(),o=Li(),n=Q(),i=it(),c=Q(),l="tr-konva",g=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(x=>x+`.${l}`).join(" "),v="nodesRect",C=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],d={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},a="ontouchstart"in n.Konva._global;function p(x,E,A){if(x==="rotater")return A;E+=s.Util.degToRad(d[x]||0);const R=(s.Util.radToDeg(E)%360+360)%360;return s.Util._inRange(R,315+22.5,360)||s.Util._inRange(R,0,22.5)?"ns-resize":s.Util._inRange(R,45-22.5,45+22.5)?"nesw-resize":s.Util._inRange(R,90-22.5,90+22.5)?"ew-resize":s.Util._inRange(R,135-22.5,135+22.5)?"nwse-resize":s.Util._inRange(R,180-22.5,180+22.5)?"ns-resize":s.Util._inRange(R,225-22.5,225+22.5)?"nesw-resize":s.Util._inRange(R,270-22.5,270+22.5)?"ew-resize":s.Util._inRange(R,315-22.5,315+22.5)?"nwse-resize":(s.Util.error("Transformer has unknown angle for cursor detection: "+R),"pointer")}const b=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function I(x){return{x:x.x+x.width/2*Math.cos(x.rotation)+x.height/2*Math.sin(-x.rotation),y:x.y+x.height/2*Math.cos(x.rotation)+x.width/2*Math.sin(x.rotation)}}function r(x,E,A){const R=A.x+(x.x-A.x)*Math.cos(E)-(x.y-A.y)*Math.sin(E),k=A.y+(x.x-A.x)*Math.sin(E)+(x.y-A.y)*Math.cos(E);return{...x,rotation:x.rotation+E,x:R,y:k}}function e(x,E){const A=I(x);return r(x,E,A)}function y(x,E,A){let R=E;for(let k=0;k<x.length;k++){const h=n.Konva.getAngle(x[k]),S=Math.abs(h-E)%(Math.PI*2);Math.min(S,Math.PI*2-S)<A&&(R=h)}return R}let w=0,P=class extends o.Group{constructor(E){super(E),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(g,this.update),this.getNode()&&this.update()}attachTo(E){return this.setNode(E),this}setNode(E){return s.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([E])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return l+this._id}setNodes(E=[]){this._nodes&&this._nodes.length&&this.detach();const A=E.filter(k=>k.isAncestorOf(this)?(s.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=E=A,E.length===1&&this.useSingleNodeRotation()?this.rotation(E[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(k=>{const h=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(k._attrsAffectingSize.length){const S=k._attrsAffectingSize.map(_=>_+"Change."+this._getEventNamespace()).join(" ");k.on(S,h)}k.on(C.map(S=>S+`.${this._getEventNamespace()}`).join(" "),h),k.on(`absoluteTransformChange.${this._getEventNamespace()}`,h),this._proxyDrag(k)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(E){let A;E.on(`dragstart.${this._getEventNamespace()}`,R=>{A=E.getAbsolutePosition(),!this.isDragging()&&E!==this.findOne(".back")&&this.startDrag(R,!1)}),E.on(`dragmove.${this._getEventNamespace()}`,R=>{if(!A)return;const k=E.getAbsolutePosition(),h=k.x-A.x,S=k.y-A.y;this.nodes().forEach(_=>{if(_===E||_.isDragging())return;const T=_.getAbsolutePosition();_.setAbsolutePosition({x:T.x+h,y:T.y+S}),_.startDrag(R)}),A=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(E=>{E.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(v),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(v,this.__getNodeRect)}__getNodeShape(E,A=this.rotation(),R){const k=E.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),h=E.getAbsoluteScale(R),S=E.getAbsolutePosition(R),_=k.x*h.x-E.offsetX()*h.x,T=k.y*h.y-E.offsetY()*h.y,G=(n.Konva.getAngle(E.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),N={x:S.x+_*Math.cos(G)+T*Math.sin(-G),y:S.y+T*Math.cos(G)+_*Math.sin(G),width:k.width*h.x,height:k.height*h.y,rotation:G};return r(N,-n.Konva.getAngle(A),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const A=[];this.nodes().map(G=>{const N=G.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),O=[{x:N.x,y:N.y},{x:N.x+N.width,y:N.y},{x:N.x+N.width,y:N.y+N.height},{x:N.x,y:N.y+N.height}],L=G.getAbsoluteTransform();O.forEach(function(V){const z=L.point(V);A.push(z)})});const R=new s.Transform;R.rotate(-n.Konva.getAngle(this.rotation()));let k=1/0,h=1/0,S=-1/0,_=-1/0;A.forEach(function(G){const N=R.point(G);k===void 0&&(k=S=N.x,h=_=N.y),k=Math.min(k,N.x),h=Math.min(h,N.y),S=Math.max(S,N.x),_=Math.max(_,N.y)}),R.invert();const T=R.point({x:k,y:h});return{x:T.x,y:T.y,width:S-k,height:_-h,rotation:n.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),b.forEach(E=>{this._createAnchor(E)}),this._createAnchor("rotater")}_createAnchor(E){const A=new m.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:E+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:a?10:"auto"}),R=this;A.on("mousedown touchstart",function(k){R._handleMouseDown(k)}),A.on("dragstart",k=>{A.stopDrag(),k.cancelBubble=!0}),A.on("dragend",k=>{k.cancelBubble=!0}),A.on("mouseenter",()=>{const k=n.Konva.getAngle(this.rotation()),h=this.rotateAnchorCursor(),S=p(E,k,h);A.getStage().content&&(A.getStage().content.style.cursor=S),this._cursorChange=!0}),A.on("mouseout",()=>{A.getStage().content&&(A.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(A)}_createBack(){const E=new f.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(A,R){const k=R.getParent(),h=k.padding();A.beginPath(),A.rect(-h,-h,R.width()+h*2,R.height()+h*2),A.moveTo(R.width()/2,-h),k.rotateEnabled()&&k.rotateLineVisible()&&A.lineTo(R.width()/2,-k.rotateAnchorOffset()*s.Util._sign(R.height())-h),A.fillStrokeShape(R)},hitFunc:(A,R)=>{if(!this.shouldOverdrawWholeArea())return;const k=this.padding();A.beginPath(),A.rect(-k,-k,R.width()+k*2,R.height()+k*2),A.fillStrokeShape(R)}});this.add(E),this._proxyDrag(E),E.on("dragstart",A=>{A.cancelBubble=!0}),E.on("dragmove",A=>{A.cancelBubble=!0}),E.on("dragend",A=>{A.cancelBubble=!0}),this.on("dragmove",A=>{this.update()})}_handleMouseDown(E){if(this._transforming)return;this._movingAnchorName=E.target.name().split(" ")[0];const A=this._getNodeRect(),R=A.width,k=A.height,h=Math.sqrt(Math.pow(R,2)+Math.pow(k,2));this.sin=Math.abs(k/h),this.cos=Math.abs(R/h),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const S=E.target.getAbsolutePosition(),_=E.target.getStage().getPointerPosition();this._anchorDragOffset={x:_.x-S.x,y:_.y-S.y},w++,this._fire("transformstart",{evt:E.evt,target:this.getNode()}),this._nodes.forEach(T=>{T._fire("transformstart",{evt:E.evt,target:T})})}_handleMouseMove(E){let A,R,k;const h=this.findOne("."+this._movingAnchorName),S=h.getStage();S.setPointersPositions(E);const _=S.getPointerPosition();let T={x:_.x-this._anchorDragOffset.x,y:_.y-this._anchorDragOffset.y};const G=h.getAbsolutePosition();this.anchorDragBoundFunc()&&(T=this.anchorDragBoundFunc()(G,T,E)),h.setAbsolutePosition(T);const N=h.getAbsolutePosition();if(G.x===N.x&&G.y===N.y)return;if(this._movingAnchorName==="rotater"){const U=this._getNodeRect();A=h.x()-U.width/2,R=-h.y()+U.height/2;let W=Math.atan2(-R,A)+Math.PI/2;U.height<0&&(W-=Math.PI);const K=n.Konva.getAngle(this.rotation())+W,nt=n.Konva.getAngle(this.rotationSnapTolerance()),J=y(this.rotationSnaps(),K,nt)-U.rotation,gt=e(U,J);this._fitNodesInto(gt,E);return}const O=this.shiftBehavior();let L;O==="inverted"?L=this.keepRatio()&&!E.shiftKey:O==="none"?L=this.keepRatio():L=this.keepRatio()||E.shiftKey;var X=this.centeredScaling()||E.altKey;if(this._movingAnchorName==="top-left"){if(L){var V=X?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};k=Math.sqrt(Math.pow(V.x-h.x(),2)+Math.pow(V.y-h.y(),2));var z=this.findOne(".top-left").x()>V.x?-1:1,D=this.findOne(".top-left").y()>V.y?-1:1;A=k*this.cos*z,R=k*this.sin*D,this.findOne(".top-left").x(V.x-A),this.findOne(".top-left").y(V.y-R)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(h.y());else if(this._movingAnchorName==="top-right"){if(L){var V=X?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};k=Math.sqrt(Math.pow(h.x()-V.x,2)+Math.pow(V.y-h.y(),2));var z=this.findOne(".top-right").x()<V.x?-1:1,D=this.findOne(".top-right").y()>V.y?-1:1;A=k*this.cos*z,R=k*this.sin*D,this.findOne(".top-right").x(V.x+A),this.findOne(".top-right").y(V.y-R)}var H=h.position();this.findOne(".top-left").y(H.y),this.findOne(".bottom-right").x(H.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(h.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(h.x());else if(this._movingAnchorName==="bottom-left"){if(L){var V=X?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};k=Math.sqrt(Math.pow(V.x-h.x(),2)+Math.pow(h.y()-V.y,2));var z=V.x<h.x()?-1:1,D=h.y()<V.y?-1:1;A=k*this.cos*z,R=k*this.sin*D,h.x(V.x-A),h.y(V.y+R)}H=h.position(),this.findOne(".top-left").x(H.x),this.findOne(".bottom-right").y(H.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(h.y());else if(this._movingAnchorName==="bottom-right"){if(L){var V=X?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};k=Math.sqrt(Math.pow(h.x()-V.x,2)+Math.pow(h.y()-V.y,2));var z=this.findOne(".bottom-right").x()<V.x?-1:1,D=this.findOne(".bottom-right").y()<V.y?-1:1;A=k*this.cos*z,R=k*this.sin*D,this.findOne(".bottom-right").x(V.x+A),this.findOne(".bottom-right").y(V.y+R)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var X=this.centeredScaling()||E.altKey;if(X){const U=this.findOne(".top-left"),W=this.findOne(".bottom-right"),j=U.x(),K=U.y(),nt=this.getWidth()-W.x(),st=this.getHeight()-W.y();W.move({x:-j,y:-K}),U.move({x:nt,y:st})}const Y=this.findOne(".top-left").getAbsolutePosition();A=Y.x,R=Y.y;const F=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),B=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:A,y:R,width:F,height:B,rotation:n.Konva.getAngle(this.rotation())},E)}_handleMouseUp(E){this._removeEvents(E)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(E){var A;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const R=this.getNode();w--,this._fire("transformend",{evt:E,target:R}),(A=this.getLayer())===null||A===void 0||A.batchDraw(),R&&this._nodes.forEach(k=>{var h;k._fire("transformend",{evt:E,target:k}),(h=k.getLayer())===null||h===void 0||h.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(E,A){const R=this._getNodeRect(),k=1;if(s.Util._inRange(E.width,-this.padding()*2-k,k)){this.update();return}if(s.Util._inRange(E.height,-this.padding()*2-k,k)){this.update();return}const h=new s.Transform;if(h.rotate(n.Konva.getAngle(this.rotation())),this._movingAnchorName&&E.width<0&&this._movingAnchorName.indexOf("left")>=0){const L=h.point({x:-this.padding()*2,y:0});E.x+=L.x,E.y+=L.y,E.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=L.x,this._anchorDragOffset.y-=L.y}else if(this._movingAnchorName&&E.width<0&&this._movingAnchorName.indexOf("right")>=0){const L=h.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=L.x,this._anchorDragOffset.y-=L.y,E.width+=this.padding()*2}if(this._movingAnchorName&&E.height<0&&this._movingAnchorName.indexOf("top")>=0){const L=h.point({x:0,y:-this.padding()*2});E.x+=L.x,E.y+=L.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=L.x,this._anchorDragOffset.y-=L.y,E.height+=this.padding()*2}else if(this._movingAnchorName&&E.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const L=h.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=L.x,this._anchorDragOffset.y-=L.y,E.height+=this.padding()*2}if(this.boundBoxFunc()){const L=this.boundBoxFunc()(R,E);L?E=L:s.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const S=1e7,_=new s.Transform;_.translate(R.x,R.y),_.rotate(R.rotation),_.scale(R.width/S,R.height/S);const T=new s.Transform,G=E.width/S,N=E.height/S;this.flipEnabled()===!1?(T.translate(E.x,E.y),T.rotate(E.rotation),T.translate(E.width<0?E.width:0,E.height<0?E.height:0),T.scale(Math.abs(G),Math.abs(N))):(T.translate(E.x,E.y),T.rotate(E.rotation),T.scale(G,N));const O=T.multiply(_.invert());this._nodes.forEach(L=>{var V;const z=L.getParent().getAbsoluteTransform(),D=L.getTransform().copy();D.translate(L.offsetX(),L.offsetY());const H=new s.Transform;H.multiply(z.copy().invert()).multiply(O).multiply(z).multiply(D);const X=H.decompose();L.setAttrs(X),(V=L.getLayer())===null||V===void 0||V.batchDraw()}),this.rotation(s.Util._getRotation(E.rotation)),this._nodes.forEach(L=>{this._fire("transform",{evt:A,target:L}),L._fire("transform",{evt:A,target:L})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(E,A){this.findOne(E).setAttrs(A)}update(){var E;const A=this._getNodeRect();this.rotation(s.Util._getRotation(A.rotation));const R=A.width,k=A.height,h=this.enabledAnchors(),S=this.resizeEnabled(),_=this.padding(),T=this.anchorSize(),G=this.find("._anchor");G.forEach(O=>{O.setAttrs({width:T,height:T,offsetX:T/2,offsetY:T/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:T/2+_,offsetY:T/2+_,visible:S&&h.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:R/2,y:0,offsetY:T/2+_,visible:S&&h.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:R,y:0,offsetX:T/2-_,offsetY:T/2+_,visible:S&&h.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:k/2,offsetX:T/2+_,visible:S&&h.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:R,y:k/2,offsetX:T/2-_,visible:S&&h.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:k,offsetX:T/2+_,offsetY:T/2-_,visible:S&&h.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:R/2,y:k,offsetY:T/2-_,visible:S&&h.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:R,y:k,offsetX:T/2-_,offsetY:T/2-_,visible:S&&h.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:R/2,y:-this.rotateAnchorOffset()*s.Util._sign(k)-_,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:R,height:k,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const N=this.anchorStyleFunc();N&&G.forEach(O=>{N(O)}),(E=this.getLayer())===null||E===void 0||E.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const E=this.findOne("."+this._movingAnchorName);E&&E.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),o.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return u.Node.prototype.toObject.call(this)}clone(E){return u.Node.prototype.clone.call(this,E)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};Re.Transformer=P,P.isTransforming=()=>w>0;function M(x){return x instanceof Array||s.Util.warn("enabledAnchors value should be an array"),x instanceof Array&&x.forEach(function(E){b.indexOf(E)===-1&&s.Util.warn("Unknown anchor name: "+E+". Available names are: "+b.join(", "))}),x||[]}return P.prototype.className="Transformer",(0,c._registerNode)(P),t.Factory.addGetterSetter(P,"enabledAnchors",b,M),t.Factory.addGetterSetter(P,"flipEnabled",!0,(0,i.getBooleanValidator)()),t.Factory.addGetterSetter(P,"resizeEnabled",!0),t.Factory.addGetterSetter(P,"anchorSize",10,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(P,"rotateEnabled",!0),t.Factory.addGetterSetter(P,"rotateLineVisible",!0),t.Factory.addGetterSetter(P,"rotationSnaps",[]),t.Factory.addGetterSetter(P,"rotateAnchorOffset",50,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(P,"rotateAnchorCursor","crosshair"),t.Factory.addGetterSetter(P,"rotationSnapTolerance",5,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(P,"borderEnabled",!0),t.Factory.addGetterSetter(P,"anchorStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(P,"anchorStrokeWidth",1,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(P,"anchorFill","white"),t.Factory.addGetterSetter(P,"anchorCornerRadius",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(P,"borderStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(P,"borderStrokeWidth",1,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(P,"borderDash"),t.Factory.addGetterSetter(P,"keepRatio",!0),t.Factory.addGetterSetter(P,"shiftBehavior","default"),t.Factory.addGetterSetter(P,"centeredScaling",!1),t.Factory.addGetterSetter(P,"ignoreStroke",!1),t.Factory.addGetterSetter(P,"padding",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(P,"nodes"),t.Factory.addGetterSetter(P,"node"),t.Factory.addGetterSetter(P,"boundBoxFunc"),t.Factory.addGetterSetter(P,"anchorDragBoundFunc"),t.Factory.addGetterSetter(P,"anchorStyleFunc"),t.Factory.addGetterSetter(P,"shouldOverdrawWholeArea",!1),t.Factory.addGetterSetter(P,"useSingleNodeRotation",!0),t.Factory.backCompat(P,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),Re}var Te={},Pn;function Or(){if(Pn)return Te;Pn=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.Wedge=void 0;const s=et(),t=ut(),u=Q(),f=it(),m=Q();let o=class extends t.Shape{_sceneFunc(i){i.beginPath(),i.arc(0,0,this.radius(),0,u.Konva.getAngle(this.angle()),this.clockwise()),i.lineTo(0,0),i.closePath(),i.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(i){this.radius(i/2)}setHeight(i){this.radius(i/2)}};return Te.Wedge=o,o.prototype.className="Wedge",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["radius"],(0,m._registerNode)(o),s.Factory.addGetterSetter(o,"radius",0,(0,f.getNumberValidator)()),s.Factory.addGetterSetter(o,"angle",0,(0,f.getNumberValidator)()),s.Factory.addGetterSetter(o,"clockwise",!1),s.Factory.backCompat(o,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Te}var Ge={},xn;function Dr(){if(xn)return Ge;xn=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.Blur=void 0;const s=et(),t=lt(),u=it();function f(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const m=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],o=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function n(c,l){const g=c.data,v=c.width,C=c.height;let d,a,p,b,I,r,e,y,w,P,M,x,E,A,R,k,h,S,_,T,G,N,O,L;const V=l+l+1,z=v-1,D=C-1,H=l+1,X=H*(H+1)/2,Y=new f,F=m[l],B=o[l];let U=null,W=Y,j=null,K=null;for(p=1;p<V;p++)W=W.next=new f,p===H&&(U=W);for(W.next=Y,e=r=0,a=0;a<C;a++){for(k=h=S=_=y=w=P=M=0,x=H*(T=g[r]),E=H*(G=g[r+1]),A=H*(N=g[r+2]),R=H*(O=g[r+3]),y+=X*T,w+=X*G,P+=X*N,M+=X*O,W=Y,p=0;p<H;p++)W.r=T,W.g=G,W.b=N,W.a=O,W=W.next;for(p=1;p<H;p++)b=r+((z<p?z:p)<<2),y+=(W.r=T=g[b])*(L=H-p),w+=(W.g=G=g[b+1])*L,P+=(W.b=N=g[b+2])*L,M+=(W.a=O=g[b+3])*L,k+=T,h+=G,S+=N,_+=O,W=W.next;for(j=Y,K=U,d=0;d<v;d++)g[r+3]=O=M*F>>B,O!==0?(O=255/O,g[r]=(y*F>>B)*O,g[r+1]=(w*F>>B)*O,g[r+2]=(P*F>>B)*O):g[r]=g[r+1]=g[r+2]=0,y-=x,w-=E,P-=A,M-=R,x-=j.r,E-=j.g,A-=j.b,R-=j.a,b=e+((b=d+l+1)<z?b:z)<<2,k+=j.r=g[b],h+=j.g=g[b+1],S+=j.b=g[b+2],_+=j.a=g[b+3],y+=k,w+=h,P+=S,M+=_,j=j.next,x+=T=K.r,E+=G=K.g,A+=N=K.b,R+=O=K.a,k-=T,h-=G,S-=N,_-=O,K=K.next,r+=4;e+=v}for(d=0;d<v;d++){for(h=S=_=k=w=P=M=y=0,r=d<<2,x=H*(T=g[r]),E=H*(G=g[r+1]),A=H*(N=g[r+2]),R=H*(O=g[r+3]),y+=X*T,w+=X*G,P+=X*N,M+=X*O,W=Y,p=0;p<H;p++)W.r=T,W.g=G,W.b=N,W.a=O,W=W.next;for(I=v,p=1;p<=l;p++)r=I+d<<2,y+=(W.r=T=g[r])*(L=H-p),w+=(W.g=G=g[r+1])*L,P+=(W.b=N=g[r+2])*L,M+=(W.a=O=g[r+3])*L,k+=T,h+=G,S+=N,_+=O,W=W.next,p<D&&(I+=v);for(r=d,j=Y,K=U,a=0;a<C;a++)b=r<<2,g[b+3]=O=M*F>>B,O>0?(O=255/O,g[b]=(y*F>>B)*O,g[b+1]=(w*F>>B)*O,g[b+2]=(P*F>>B)*O):g[b]=g[b+1]=g[b+2]=0,y-=x,w-=E,P-=A,M-=R,x-=j.r,E-=j.g,A-=j.b,R-=j.a,b=d+((b=a+H)<D?b:D)*v<<2,y+=k+=j.r=g[b],w+=h+=j.g=g[b+1],P+=S+=j.b=g[b+2],M+=_+=j.a=g[b+3],j=j.next,x+=T=K.r,E+=G=K.g,A+=N=K.b,R+=O=K.a,k-=T,h-=G,S-=N,_-=O,K=K.next,r+=v}}const i=function(l){const g=Math.round(this.blurRadius());g>0&&n(l,g)};return Ge.Blur=i,s.Factory.addGetterSetter(t.Node,"blurRadius",0,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),Ge}var Fe={},Rn;function Vr(){if(Rn)return Fe;Rn=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.Brighten=void 0;const s=et(),t=lt(),u=it(),f=function(m){const o=this.brightness()*255,n=m.data,i=n.length;for(let c=0;c<i;c+=4)n[c]+=o,n[c+1]+=o,n[c+2]+=o};return Fe.Brighten=f,s.Factory.addGetterSetter(t.Node,"brightness",0,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),Fe}var Me={},Tn;function Ur(){if(Tn)return Me;Tn=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.Contrast=void 0;const s=et(),t=lt(),u=it(),f=function(m){const o=Math.pow((this.contrast()+100)/100,2),n=m.data,i=n.length;let c=150,l=150,g=150;for(let v=0;v<i;v+=4)c=n[v],l=n[v+1],g=n[v+2],c/=255,c-=.5,c*=o,c+=.5,c*=255,l/=255,l-=.5,l*=o,l+=.5,l*=255,g/=255,g-=.5,g*=o,g+=.5,g*=255,c=c<0?0:c>255?255:c,l=l<0?0:l>255?255:l,g=g<0?0:g>255?255:g,n[v]=c,n[v+1]=l,n[v+2]=g};return Me.Contrast=f,s.Factory.addGetterSetter(t.Node,"contrast",0,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),Me}var ke={},Gn;function Hr(){if(Gn)return ke;Gn=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.Emboss=void 0;const s=et(),t=lt(),u=ot(),f=it(),m=function(o){const n=this.embossStrength()*10,i=this.embossWhiteLevel()*255,c=this.embossDirection(),l=this.embossBlend(),g=o.data,v=o.width,C=o.height,d=v*4;let a=0,p=0,b=C;switch(c){case"top-left":a=-1,p=-1;break;case"top":a=-1,p=0;break;case"top-right":a=-1,p=1;break;case"right":a=0,p=1;break;case"bottom-right":a=1,p=1;break;case"bottom":a=1,p=0;break;case"bottom-left":a=1,p=-1;break;case"left":a=0,p=-1;break;default:u.Util.error("Unknown emboss direction: "+c)}do{const I=(b-1)*d;let r=a;b+r<1&&(r=0),b+r>C&&(r=0);const e=(b-1+r)*v*4;let y=v;do{const w=I+(y-1)*4;let P=p;y+P<1&&(P=0),y+P>v&&(P=0);const M=e+(y-1+P)*4,x=g[w]-g[M],E=g[w+1]-g[M+1],A=g[w+2]-g[M+2];let R=x;const k=R>0?R:-R,h=E>0?E:-E,S=A>0?A:-A;if(h>k&&(R=E),S>k&&(R=A),R*=n,l){const _=g[w]+R,T=g[w+1]+R,G=g[w+2]+R;g[w]=_>255?255:_<0?0:_,g[w+1]=T>255?255:T<0?0:T,g[w+2]=G>255?255:G<0?0:G}else{let _=i-R;_<0?_=0:_>255&&(_=255),g[w]=g[w+1]=g[w+2]=_}}while(--y)}while(--b)};return ke.Emboss=m,s.Factory.addGetterSetter(t.Node,"embossStrength",.5,(0,f.getNumberValidator)(),s.Factory.afterSetFilter),s.Factory.addGetterSetter(t.Node,"embossWhiteLevel",.5,(0,f.getNumberValidator)(),s.Factory.afterSetFilter),s.Factory.addGetterSetter(t.Node,"embossDirection","top-left",void 0,s.Factory.afterSetFilter),s.Factory.addGetterSetter(t.Node,"embossBlend",!1,void 0,s.Factory.afterSetFilter),ke}var Ne={},Fn;function Wr(){if(Fn)return Ne;Fn=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.Enhance=void 0;const s=et(),t=lt(),u=it();function f(o,n,i,c,l){const g=i-n,v=l-c;if(g===0)return c+v/2;if(v===0)return c;let C=(o-n)/g;return C=v*C+c,C}const m=function(o){const n=o.data,i=n.length;let c=n[0],l=c,g,v=n[1],C=v,d,a=n[2],p=a,b;const I=this.enhance();if(I===0)return;for(let R=0;R<i;R+=4)g=n[R+0],g<c?c=g:g>l&&(l=g),d=n[R+1],d<v?v=d:d>C&&(C=d),b=n[R+2],b<a?a=b:b>p&&(p=b);l===c&&(l=255,c=0),C===v&&(C=255,v=0),p===a&&(p=255,a=0);let r,e,y,w,P,M,x,E,A;I>0?(e=l+I*(255-l),y=c-I*(c-0),P=C+I*(255-C),M=v-I*(v-0),E=p+I*(255-p),A=a-I*(a-0)):(r=(l+c)*.5,e=l+I*(l-r),y=c+I*(c-r),w=(C+v)*.5,P=C+I*(C-w),M=v+I*(v-w),x=(p+a)*.5,E=p+I*(p-x),A=a+I*(a-x));for(let R=0;R<i;R+=4)n[R+0]=f(n[R+0],c,l,y,e),n[R+1]=f(n[R+1],v,C,M,P),n[R+2]=f(n[R+2],a,p,A,E)};return Ne.Enhance=m,s.Factory.addGetterSetter(t.Node,"enhance",0,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),Ne}var Le={},Mn;function zr(){if(Mn)return Le;Mn=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.Grayscale=void 0;const s=function(t){const u=t.data,f=u.length;for(let m=0;m<f;m+=4){const o=.34*u[m]+.5*u[m+1]+.16*u[m+2];u[m]=o,u[m+1]=o,u[m+2]=o}};return Le.Grayscale=s,Le}var Be={},kn;function Xr(){if(kn)return Be;kn=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.HSL=void 0;const s=et(),t=lt(),u=it();s.Factory.addGetterSetter(t.Node,"hue",0,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),s.Factory.addGetterSetter(t.Node,"saturation",0,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),s.Factory.addGetterSetter(t.Node,"luminance",0,(0,u.getNumberValidator)(),s.Factory.afterSetFilter);const f=function(m){const o=m.data,n=o.length,i=1,c=Math.pow(2,this.saturation()),l=Math.abs(this.hue()+360)%360,g=this.luminance()*127,v=i*c*Math.cos(l*Math.PI/180),C=i*c*Math.sin(l*Math.PI/180),d=.299*i+.701*v+.167*C,a=.587*i-.587*v+.33*C,p=.114*i-.114*v-.497*C,b=.299*i-.299*v-.328*C,I=.587*i+.413*v+.035*C,r=.114*i-.114*v+.293*C,e=.299*i-.3*v+1.25*C,y=.587*i-.586*v-1.05*C,w=.114*i+.886*v-.2*C;let P,M,x,E;for(let A=0;A<n;A+=4)P=o[A+0],M=o[A+1],x=o[A+2],E=o[A+3],o[A+0]=d*P+a*M+p*x+g,o[A+1]=b*P+I*M+r*x+g,o[A+2]=e*P+y*M+w*x+g,o[A+3]=E};return Be.HSL=f,Be}var Oe={},Nn;function jr(){if(Nn)return Oe;Nn=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.HSV=void 0;const s=et(),t=lt(),u=it(),f=function(m){const o=m.data,n=o.length,i=Math.pow(2,this.value()),c=Math.pow(2,this.saturation()),l=Math.abs(this.hue()+360)%360,g=i*c*Math.cos(l*Math.PI/180),v=i*c*Math.sin(l*Math.PI/180),C=.299*i+.701*g+.167*v,d=.587*i-.587*g+.33*v,a=.114*i-.114*g-.497*v,p=.299*i-.299*g-.328*v,b=.587*i+.413*g+.035*v,I=.114*i-.114*g+.293*v,r=.299*i-.3*g+1.25*v,e=.587*i-.586*g-1.05*v,y=.114*i+.886*g-.2*v;let w,P,M,x;for(let E=0;E<n;E+=4)w=o[E+0],P=o[E+1],M=o[E+2],x=o[E+3],o[E+0]=C*w+d*P+a*M,o[E+1]=p*w+b*P+I*M,o[E+2]=r*w+e*P+y*M,o[E+3]=x};return Oe.HSV=f,s.Factory.addGetterSetter(t.Node,"hue",0,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),s.Factory.addGetterSetter(t.Node,"saturation",0,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),s.Factory.addGetterSetter(t.Node,"value",0,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),Oe}var De={},Ln;function Yr(){if(Ln)return De;Ln=1,Object.defineProperty(De,"__esModule",{value:!0}),De.Invert=void 0;const s=function(t){const u=t.data,f=u.length;for(let m=0;m<f;m+=4)u[m]=255-u[m],u[m+1]=255-u[m+1],u[m+2]=255-u[m+2]};return De.Invert=s,De}var Ve={},Bn;function Kr(){if(Bn)return Ve;Bn=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.Kaleidoscope=void 0;const s=et(),t=lt(),u=ot(),f=it(),m=function(i,c,l){const g=i.data,v=c.data,C=i.width,d=i.height,a=l.polarCenterX||C/2,p=l.polarCenterY||d/2;let b=Math.sqrt(a*a+p*p),I=C-a,r=d-p;const e=Math.sqrt(I*I+r*r);b=e>b?e:b;const y=d,w=C,P=360/w*Math.PI/180;for(let M=0;M<w;M+=1){const x=Math.sin(M*P),E=Math.cos(M*P);for(let A=0;A<y;A+=1){I=Math.floor(a+b*A/y*E),r=Math.floor(p+b*A/y*x);let R=(r*C+I)*4;const k=g[R+0],h=g[R+1],S=g[R+2],_=g[R+3];R=(M+A*C)*4,v[R+0]=k,v[R+1]=h,v[R+2]=S,v[R+3]=_}}},o=function(i,c,l){const g=i.data,v=c.data,C=i.width,d=i.height,a=l.polarCenterX||C/2,p=l.polarCenterY||d/2;let b=Math.sqrt(a*a+p*p),I=C-a,r=d-p;const e=Math.sqrt(I*I+r*r);b=e>b?e:b;const y=d,w=C,P=0;let M,x;for(I=0;I<C;I+=1)for(r=0;r<d;r+=1){const E=I-a,A=r-p,R=Math.sqrt(E*E+A*A)*y/b;let k=(Math.atan2(A,E)*180/Math.PI+360+P)%360;k=k*w/360,M=Math.floor(k),x=Math.floor(R);let h=(x*C+M)*4;const S=g[h+0],_=g[h+1],T=g[h+2],G=g[h+3];h=(r*C+I)*4,v[h+0]=S,v[h+1]=_,v[h+2]=T,v[h+3]=G}},n=function(i){const c=i.width,l=i.height;let g,v,C,d,a,p,b,I,r,e,y=Math.round(this.kaleidoscopePower());const w=Math.round(this.kaleidoscopeAngle()),P=Math.floor(c*(w%360)/360);if(y<1)return;const M=u.Util.createCanvasElement();M.width=c,M.height=l;const x=M.getContext("2d").getImageData(0,0,c,l);u.Util.releaseCanvas(M),m(i,x,{polarCenterX:c/2,polarCenterY:l/2});let E=c/Math.pow(2,y);for(;E<=8;)E=E*2,y-=1;E=Math.ceil(E);let A=E,R=0,k=A,h=1;for(P+E>c&&(R=A,k=0,h=-1),v=0;v<l;v+=1)for(g=R;g!==k;g+=h)C=Math.round(g+P)%c,r=(c*v+C)*4,a=x.data[r+0],p=x.data[r+1],b=x.data[r+2],I=x.data[r+3],e=(c*v+g)*4,x.data[e+0]=a,x.data[e+1]=p,x.data[e+2]=b,x.data[e+3]=I;for(v=0;v<l;v+=1)for(A=Math.floor(E),d=0;d<y;d+=1){for(g=0;g<A+1;g+=1)r=(c*v+g)*4,a=x.data[r+0],p=x.data[r+1],b=x.data[r+2],I=x.data[r+3],e=(c*v+A*2-g-1)*4,x.data[e+0]=a,x.data[e+1]=p,x.data[e+2]=b,x.data[e+3]=I;A*=2}o(x,i,{})};return Ve.Kaleidoscope=n,s.Factory.addGetterSetter(t.Node,"kaleidoscopePower",2,(0,f.getNumberValidator)(),s.Factory.afterSetFilter),s.Factory.addGetterSetter(t.Node,"kaleidoscopeAngle",0,(0,f.getNumberValidator)(),s.Factory.afterSetFilter),Ve}var Ue={},On;function qr(){if(On)return Ue;On=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.Mask=void 0;const s=et(),t=lt(),u=it();function f(C,d,a){let p=(a*C.width+d)*4;const b=[];return b.push(C.data[p++],C.data[p++],C.data[p++],C.data[p++]),b}function m(C,d){return Math.sqrt(Math.pow(C[0]-d[0],2)+Math.pow(C[1]-d[1],2)+Math.pow(C[2]-d[2],2))}function o(C){const d=[0,0,0];for(let a=0;a<C.length;a++)d[0]+=C[a][0],d[1]+=C[a][1],d[2]+=C[a][2];return d[0]/=C.length,d[1]/=C.length,d[2]/=C.length,d}function n(C,d){const a=f(C,0,0),p=f(C,C.width-1,0),b=f(C,0,C.height-1),I=f(C,C.width-1,C.height-1),r=d||10;if(m(a,p)<r&&m(p,I)<r&&m(I,b)<r&&m(b,a)<r){const e=o([p,a,I,b]),y=[];for(let w=0;w<C.width*C.height;w++){const P=m(e,[C.data[w*4],C.data[w*4+1],C.data[w*4+2]]);y[w]=P<r?0:255}return y}}function i(C,d){for(let a=0;a<C.width*C.height;a++)C.data[4*a+3]=d[a]}function c(C,d,a){const p=[1,1,1,1,0,1,1,1,1],b=Math.round(Math.sqrt(p.length)),I=Math.floor(b/2),r=[];for(let e=0;e<a;e++)for(let y=0;y<d;y++){const w=e*d+y;let P=0;for(let M=0;M<b;M++)for(let x=0;x<b;x++){const E=e+M-I,A=y+x-I;if(E>=0&&E<a&&A>=0&&A<d){const R=E*d+A,k=p[M*b+x];P+=C[R]*k}}r[w]=P===255*8?255:0}return r}function l(C,d,a){const p=[1,1,1,1,1,1,1,1,1],b=Math.round(Math.sqrt(p.length)),I=Math.floor(b/2),r=[];for(let e=0;e<a;e++)for(let y=0;y<d;y++){const w=e*d+y;let P=0;for(let M=0;M<b;M++)for(let x=0;x<b;x++){const E=e+M-I,A=y+x-I;if(E>=0&&E<a&&A>=0&&A<d){const R=E*d+A,k=p[M*b+x];P+=C[R]*k}}r[w]=P>=255*4?255:0}return r}function g(C,d,a){const p=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],b=Math.round(Math.sqrt(p.length)),I=Math.floor(b/2),r=[];for(let e=0;e<a;e++)for(let y=0;y<d;y++){const w=e*d+y;let P=0;for(let M=0;M<b;M++)for(let x=0;x<b;x++){const E=e+M-I,A=y+x-I;if(E>=0&&E<a&&A>=0&&A<d){const R=E*d+A,k=p[M*b+x];P+=C[R]*k}}r[w]=P}return r}const v=function(C){const d=this.threshold();let a=n(C,d);return a&&(a=c(a,C.width,C.height),a=l(a,C.width,C.height),a=g(a,C.width,C.height),i(C,a)),C};return Ue.Mask=v,s.Factory.addGetterSetter(t.Node,"threshold",0,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),Ue}var He={},Dn;function Zr(){if(Dn)return He;Dn=1,Object.defineProperty(He,"__esModule",{value:!0}),He.Noise=void 0;const s=et(),t=lt(),u=it(),f=function(m){const o=this.noise()*255,n=m.data,i=n.length,c=o/2;for(let l=0;l<i;l+=4)n[l+0]+=c-2*c*Math.random(),n[l+1]+=c-2*c*Math.random(),n[l+2]+=c-2*c*Math.random()};return He.Noise=f,s.Factory.addGetterSetter(t.Node,"noise",.2,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),He}var We={},Vn;function $r(){if(Vn)return We;Vn=1,Object.defineProperty(We,"__esModule",{value:!0}),We.Pixelate=void 0;const s=et(),t=ot(),u=lt(),f=it(),m=function(o){let n=Math.ceil(this.pixelSize()),i=o.width,c=o.height,l,g,v,C,d,a,p,b=Math.ceil(i/n),I=Math.ceil(c/n),r,e,y,w,P,M,x,E=o.data;if(n<=0){t.Util.error("pixelSize value can not be <= 0");return}for(P=0;P<b;P+=1)for(M=0;M<I;M+=1){for(C=0,d=0,a=0,p=0,r=P*n,e=r+n,y=M*n,w=y+n,x=0,l=r;l<e;l+=1)if(!(l>=i))for(g=y;g<w;g+=1)g>=c||(v=(i*g+l)*4,C+=E[v+0],d+=E[v+1],a+=E[v+2],p+=E[v+3],x+=1);for(C=C/x,d=d/x,a=a/x,p=p/x,l=r;l<e;l+=1)if(!(l>=i))for(g=y;g<w;g+=1)g>=c||(v=(i*g+l)*4,E[v+0]=C,E[v+1]=d,E[v+2]=a,E[v+3]=p)}};return We.Pixelate=m,s.Factory.addGetterSetter(u.Node,"pixelSize",8,(0,f.getNumberValidator)(),s.Factory.afterSetFilter),We}var ze={},Un;function Jr(){if(Un)return ze;Un=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.Posterize=void 0;const s=et(),t=lt(),u=it(),f=function(m){const o=Math.round(this.levels()*254)+1,n=m.data,i=n.length,c=255/o;for(let l=0;l<i;l+=1)n[l]=Math.floor(n[l]/c)*c};return ze.Posterize=f,s.Factory.addGetterSetter(t.Node,"levels",.5,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),ze}var Xe={},Hn;function Qr(){if(Hn)return Xe;Hn=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.RGB=void 0;const s=et(),t=lt(),u=it(),f=function(m){const o=m.data,n=o.length,i=this.red(),c=this.green(),l=this.blue();for(let g=0;g<n;g+=4){const v=(.34*o[g]+.5*o[g+1]+.16*o[g+2])/255;o[g]=v*i,o[g+1]=v*c,o[g+2]=v*l,o[g+3]=o[g+3]}};return Xe.RGB=f,s.Factory.addGetterSetter(t.Node,"red",0,function(m){return this._filterUpToDate=!1,m>255?255:m<0?0:Math.round(m)}),s.Factory.addGetterSetter(t.Node,"green",0,function(m){return this._filterUpToDate=!1,m>255?255:m<0?0:Math.round(m)}),s.Factory.addGetterSetter(t.Node,"blue",0,u.RGBComponent,s.Factory.afterSetFilter),Xe}var je={},Wn;function ta(){if(Wn)return je;Wn=1,Object.defineProperty(je,"__esModule",{value:!0}),je.RGBA=void 0;const s=et(),t=lt(),u=it(),f=function(m){const o=m.data,n=o.length,i=this.red(),c=this.green(),l=this.blue(),g=this.alpha();for(let v=0;v<n;v+=4){const C=1-g;o[v]=i*g+o[v]*C,o[v+1]=c*g+o[v+1]*C,o[v+2]=l*g+o[v+2]*C}};return je.RGBA=f,s.Factory.addGetterSetter(t.Node,"red",0,function(m){return this._filterUpToDate=!1,m>255?255:m<0?0:Math.round(m)}),s.Factory.addGetterSetter(t.Node,"green",0,function(m){return this._filterUpToDate=!1,m>255?255:m<0?0:Math.round(m)}),s.Factory.addGetterSetter(t.Node,"blue",0,u.RGBComponent,s.Factory.afterSetFilter),s.Factory.addGetterSetter(t.Node,"alpha",1,function(m){return this._filterUpToDate=!1,m>1?1:m<0?0:m}),je}var Ye={},zn;function ea(){if(zn)return Ye;zn=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.Sepia=void 0;const s=function(t){const u=t.data,f=u.length;for(let m=0;m<f;m+=4){const o=u[m+0],n=u[m+1],i=u[m+2];u[m+0]=Math.min(255,o*.393+n*.769+i*.189),u[m+1]=Math.min(255,o*.349+n*.686+i*.168),u[m+2]=Math.min(255,o*.272+n*.534+i*.131)}};return Ye.Sepia=s,Ye}var Ke={},Xn;function ia(){if(Xn)return Ke;Xn=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.Solarize=void 0;const s=function(t){const u=t.data,f=t.width,m=t.height,o=f*4;let n=m;do{const i=(n-1)*o;let c=f;do{const l=i+(c-1)*4;let g=u[l],v=u[l+1],C=u[l+2];g>127&&(g=255-g),v>127&&(v=255-v),C>127&&(C=255-C),u[l]=g,u[l+1]=v,u[l+2]=C}while(--c)}while(--n)};return Ke.Solarize=s,Ke}var qe={},jn;function na(){if(jn)return qe;jn=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.Threshold=void 0;const s=et(),t=lt(),u=it(),f=function(m){const o=this.threshold()*255,n=m.data,i=n.length;for(let c=0;c<i;c+=1)n[c]=n[c]<o?0:255};return qe.Threshold=f,s.Factory.addGetterSetter(t.Node,"threshold",.5,(0,u.getNumberValidator)(),s.Factory.afterSetFilter),qe}var Yn;function sa(){if(Yn)return le;Yn=1,Object.defineProperty(le,"__esModule",{value:!0}),le.Konva=void 0;const s=Er(),t=Ir(),u=xr(),f=Rr(),m=Tr(),o=Gr(),n=Fr(),i=Es(),c=Oi(),l=Ps(),g=Mr(),v=kr(),C=Nr(),d=Lr(),a=xs(),p=Br(),b=Rs(),I=Or(),r=Dr(),e=Vr(),y=Ur(),w=Hr(),P=Wr(),M=zr(),x=Xr(),E=jr(),A=Yr(),R=Kr(),k=qr(),h=Zr(),S=$r(),_=Jr(),T=Qr(),G=ta(),N=ea(),O=ia(),L=na();return le.Konva=s.Konva.Util._assign(s.Konva,{Arc:t.Arc,Arrow:u.Arrow,Circle:f.Circle,Ellipse:m.Ellipse,Image:o.Image,Label:n.Label,Tag:n.Tag,Line:i.Line,Path:c.Path,Rect:l.Rect,RegularPolygon:g.RegularPolygon,Ring:v.Ring,Sprite:C.Sprite,Star:d.Star,Text:a.Text,TextPath:p.TextPath,Transformer:b.Transformer,Wedge:I.Wedge,Filters:{Blur:r.Blur,Brighten:e.Brighten,Contrast:y.Contrast,Emboss:w.Emboss,Enhance:P.Enhance,Grayscale:M.Grayscale,HSL:x.HSL,HSV:E.HSV,Invert:A.Invert,Kaleidoscope:R.Kaleidoscope,Mask:k.Mask,Noise:h.Noise,Pixelate:S.Pixelate,Posterize:_.Posterize,RGB:T.RGB,RGBA:G.RGBA,Sepia:N.Sepia,Solarize:O.Solarize,Threshold:L.Threshold}}),le}var ra=ii.exports,Kn;function aa(){if(Kn)return ii.exports;Kn=1,Object.defineProperty(ra,"__esModule",{value:!0});const s=sa();return ii.exports=s.Konva,ii.exports}var oa=aa();const Mt=br(oa);var Ts=Rs();const qn=5,ha={stroke:"rgb(0, 161, 255)",strokeWidth:1,name:"guid-line",dash:[4,6]},Qt=new Mt.Layer({id:"drag-layer"}),la=s=>{const t=window.editor.myProject.stage;if(!t)return;const u=[[0,t.width()/2,t.width()]],f=[[0,t.height()/2,t.height()]];return t.find(m=>m.name()==="node"&&m.isVisible()===!0).forEach(m=>{if(s._id===m._id)return;const o=m.getClientRect();u.push([o.x,o.x+o.width,o.x+o.width/2]),f.push([o.y,o.y+o.height,o.y+o.height/2])}),{vertical:u.flat(),horizontal:f.flat(),length:u.length+f.length}},da=s=>{if(!s)return;const t=s.getClientRect(),u=s.absolutePosition();return{vertical:[{guide:Math.round(t.x),offset:Math.round(u.x-t.x),snap:"start"},{guide:Math.round(t.x+t.width/2),offset:Math.round(u.x-t.x-t.width/2),snap:"center"},{guide:Math.round(t.x+t.width),offset:Math.round(u.x-t.x-t.width),snap:"end"}],horizontal:[{guide:Math.round(t.y),offset:Math.round(u.y-t.y),snap:"start"},{guide:Math.round(t.y+t.height/2),offset:Math.round(u.y-t.y-t.height/2),snap:"center"},{guide:Math.round(t.y+t.height),offset:Math.round(u.y-t.y-t.height),snap:"end"}]}},ca=s=>{s.forEach(t=>{const u=new Mt.Line(ha);t.orientation==="H"?(u.points([-6e3,0,6e3,0]),u.absolutePosition({x:0,y:t.lineGuide})):t.orientation==="V"&&(u.points([0,-6e3,0,6e3]),u.absolutePosition({x:t.lineGuide,y:0})),Qt.add(u)})},ua=(s,t)=>{const u=[],f=[];s.vertical.forEach(i=>{t.vertical.forEach(({snap:c,offset:l,guide:g})=>{const v=Math.abs(i-g);v<qn&&u.push({lineGuide:i,diff:v,snap:c,offset:l})})}),s.horizontal.forEach(i=>{t.horizontal.forEach(({snap:c,offset:l,guide:g})=>{const v=Math.abs(i-g);v<qn&&f.push({lineGuide:i,diff:v,snap:c,offset:l})})});const m=[],o=u.sort((i,c)=>i.diff-c.diff)[0];o&&m.push({lineGuide:o.lineGuide,offset:o.offset,orientation:"V",snap:o.snap});const n=f.sort((i,c)=>i.diff-c.diff)[0];return n&&m.push({lineGuide:n.lineGuide,offset:n.offset,orientation:"H",snap:n.snap}),m};Qt.on("dragmove",s=>{if(Qt.find(".guid-line").forEach(n=>n.destroy()),!(s.target instanceof Ts.Transformer))return;const t=s.target.nodes()[0];t.moveTo(Qt);const u=la(t);if(u.length===0)return;const f=da(t),m=ua(u,f);if(!m.length)return;ca(m);const o=t.absolutePosition();m.forEach(n=>{switch(n.orientation){case"V":{o.x=n.lineGuide+n.offset;break}case"H":{o.y=n.lineGuide+n.offset;break}}}),t.absolutePosition(o)});Qt.on("dragend",s=>{if(!(s.target instanceof Ts.Transformer))return;s.target.nodes()[0].moveTo(window.editor.myProject.layers.static),Qt.find(".guid-line").forEach(u=>u.destroy())});const Zt={potrait:nr,landspace:ir,square:rr},ga={facebook:{icon:Qs,options:[{name:"Feed",width:1280,height:720,icon:Zt.landspace},{name:"Stories",width:1080,height:1920,icon:Zt.potrait},{name:"In-Stream Video Ad",width:1280,height:720,icon:Zt.landspace}]},instagram:{icon:tr,options:[{name:"Landscape Feed",width:1080,height:566,icon:Zt.landspace},{name:"Square Feed",width:1080,height:1080,icon:Zt.square},{name:"Vertical Feed",width:1080,height:1350,icon:Zt.potrait},{name:"Reels",width:1080,height:1920,icon:Zt.potrait}]}};var Vt;class fa{constructor(){$(this,"modal");dt(this,Vt);$(this,"isOpen",!1);this.modal=document.createElement("div"),this.modal.setAttribute("id","myModal"),ct(this,Vt,document.createElement("div")),Z(this,Vt).classList.add("modal-content"),this.modal.appendChild(Z(this,Vt)),document.body.appendChild(this.modal)}open(t){if(typeof t=="string"){const u=document.createElement("div");u.textContent=t,t=u}this.isOpen=!0,this.modal.style.display="flex";for(const u of Z(this,Vt).children)u.remove();Z(this,Vt).appendChild(t)}close(){this.modal.style.display="none",this.isOpen=!1;for(const t of Z(this,Vt).children)t.remove()}}Vt=new WeakMap;class ma extends fa{}const oe=new ma,pa="data:text/javascript;base64,Y2xhc3MgQXVkaW9EZWNvZGUgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIGNvbnN0cnVjdG9yKHsgcHJvY2Vzc29yT3B0aW9ucyB9KSB7CiAgICBzdXBlcigpOwogICAgdGhpcy50ZXN0ID0gMTI4ICogMTAwOyAvLyB0aGUgZnVrIG1hZ2ljIG51bWJlciAtIHNvbWVob3cgbmVlZGVkIHRvIHJlbW92ZSB0aGUgc3R1cGlkIHBhZGRpbmcKICAgIHRoaXMuZHVyYXRpb25TZWMgPSBwcm9jZXNzb3JPcHRpb25zLmR1cmF0aW9uU2VjIHx8IDA7CiAgICB0aGlzLmR1cmF0aW9uRnJhbWUgPSBNYXRoLnJvdW5kKHRoaXMuZHVyYXRpb25TZWMgKiBzYW1wbGVSYXRlKSArIHRoaXMudGVzdDsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsgLy8gR2V0IHRoZSBmaXJzdCBpbnB1dCBjaGFubmVsCiAgICBjb25zdCBvdXRwdXQgPSBvdXRwdXRzWzBdOyAvLyBHZXQgdGhlIGZpcnN0IG91dHB1dCBjaGFubmVsCgogICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgaW5wdXQgZGF0YQogICAgaWYgKGlucHV0Lmxlbmd0aCA+IDApIHsKICAgICAgLy8gQ29weSBpbnB1dCB0byBvdXRwdXQKICAgICAgZm9yIChsZXQgY2hhbm5lbCA9IDA7IGNoYW5uZWwgPCBpbnB1dC5sZW5ndGg7IGNoYW5uZWwrKykgewogICAgICAgIG91dHB1dFtjaGFubmVsXS5zZXQoaW5wdXRbY2hhbm5lbF0pOwogICAgICB9CiAgICB9CiAgICBpZiAoY3VycmVudEZyYW1lID4gdGhpcy50ZXN0KSB7CiAgICAgIHRoaXMucG9ydC5wb3N0TWVzc2FnZSh7CiAgICAgICAgYXVkaW9CdWY6IG91dHB1dCwKICAgICAgICBpc0xhc3Q6IGN1cnJlbnRGcmFtZSA+IHRoaXMuZHVyYXRpb25GcmFtZSwKICAgICAgICBzYW1wbGVTaXplOiBvdXRwdXRbMF0ubGVuZ3RoLCAvLyBieSBkb2NzIGl0IHNheXMgd2lsbCBzdGljayB0byAxMjgsIGJ1dCBzaW5jZSB0aGV5IGFsc28gbWlnaHQgaW5jcmVhc2UgdGhlIHNpemUgaW4gdGhlIGZ1dHVyZQogICAgICAgIHByb2dyZXNzOiB7CiAgICAgICAgICBwZXJjZW50OiAoY3VycmVudEZyYW1lIC8gdGhpcy5kdXJhdGlvbkZyYW1lKSAqIDEwMCwKICAgICAgICAgIHRpbWVMZWZ0OiAodGhpcy5kdXJhdGlvbkZyYW1lIC0gY3VycmVudEZyYW1lKSAvIHNhbXBsZVJhdGUsCiAgICAgICAgfSwKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIGN1cnJlbnRGcmFtZSA8IHRoaXMuZHVyYXRpb25GcmFtZTsgLy8gS2VlcCB0aGUgcHJvY2Vzc29yIGFsaXZlCiAgfQp9CgpyZWdpc3RlclByb2Nlc3NvcigiYXVkaW8tZGVjb2RlIiwgQXVkaW9EZWNvZGUpOwo=",ya="data:text/javascript;base64,Y2xhc3MgQXVkaW9BdXRvVHJpbSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvciB7CiAgI0FWR19TRUMgPSAwLjAxOyAvL2hvdyBtYW55IHNlYyBmb3IgMSBzYW1wbGUgYmF0Y2gKICAjQVZHX0ZSQU1FID0gc2FtcGxlUmF0ZSAqIHRoaXMuI0FWR19TRUM7IC8vIGhvdyBtdWNoIGZyYW1lIGluIGEgc2FtcGxlIGJhdGNoCiAgI1NJTEVOVF9UUkVTX01JTiA9IC0wLjAxOyAvLyBzaWxlbnQgdHJlc2hvbGQgbWluCiAgI1NJTEVOVF9UUkVTX01BWCA9IDAuMDE7IC8vIHNpbGVudCB0cmVzaG9sZCBtYXgKICAjQ1VUT0ZGX1NFQyA9IDE7IC8vIGhvdyBsb25nIHRoZSBzaWxlbnQgbmVlZCB0byBiZSBmb3IgaXQgY29uc2lkZXJlZCBhcyBzaWxlbnQgcGVyaW9kCgogICNhY2N1bVNhbXBsZSA9IDA7CiAgI2FjY3VtQXZnVmFsdWUgPSAwOwoKICAjc3RhcnRNYXJrZXIgPSAwOwogICNzdG9wTWFya2VyID0gMDsKICAjZ290U2lsZW5jZSA9IGZhbHNlOwogIGEgPSAwOwoKICBjb25zdHJ1Y3Rvcih7IHByb2Nlc3Nvck9wdGlvbnMgfSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuZHVyYXRpb25TZWMgPSBwcm9jZXNzb3JPcHRpb25zLmR1cmF0aW9uU2VjIHx8IDA7CiAgICB0aGlzLmR1cmF0aW9uRnJhbWUgPSBNYXRoLnJvdW5kKHRoaXMuZHVyYXRpb25TZWMgKiBzYW1wbGVSYXRlKTsKICB9CgogICNjaGVja1NhbXBsZSgpIHsKICAgIGlmICgKICAgICAgdGhpcy4jYWNjdW1BdmdWYWx1ZSA8PSB0aGlzLiNTSUxFTlRfVFJFU19NQVggJiYKICAgICAgdGhpcy4jYWNjdW1BdmdWYWx1ZSA+PSB0aGlzLiNTSUxFTlRfVFJFU19NSU4KICAgICkgewogICAgICBpZiAodGhpcy4jZ290U2lsZW5jZSA9PT0gZmFsc2UpIHsKICAgICAgICB0aGlzLiNzdGFydE1hcmtlciA9IGN1cnJlbnRGcmFtZSAvIHNhbXBsZVJhdGU7CiAgICAgIH0KCiAgICAgIHRoaXMuI2dvdFNpbGVuY2UgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHRoaXMuI2dvdFNpbGVuY2UgPT09IHRydWUpIHsKICAgICAgICB0aGlzLiNnb3RTaWxlbmNlID0gZmFsc2U7CiAgICAgICAgdGhpcy4jc3RvcE1hcmtlciA9IGN1cnJlbnRGcmFtZSAvIHNhbXBsZVJhdGU7CgogICAgICAgIGlmICh0aGlzLiNzdG9wTWFya2VyIC0gdGhpcy4jc3RhcnRNYXJrZXIgPiB0aGlzLiNDVVRPRkZfU0VDKSB7CiAgICAgICAgICB0aGlzLnBvcnQucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBpc0xhc3Q6IGZhbHNlLAogICAgICAgICAgICBzdGFydDogdGhpcy4jc3RhcnRNYXJrZXIsCiAgICAgICAgICAgIHN0b3A6IHRoaXMuI3N0b3BNYXJrZXIsCiAgICAgICAgICAgIGR1cmF0aW9uOiB0aGlzLiNzdG9wTWFya2VyIC0gdGhpcy4jc3RhcnRNYXJrZXIsCiAgICAgICAgICAgIHByb2dyZXNzOiB7CiAgICAgICAgICAgICAgcGVyY2VudDogKGN1cnJlbnRGcmFtZSAvIHRoaXMuZHVyYXRpb25GcmFtZSkgKiAxMDAsCiAgICAgICAgICAgICAgdGltZUxlZnQ6ICh0aGlzLmR1cmF0aW9uRnJhbWUgLSBjdXJyZW50RnJhbWUpIC8gc2FtcGxlUmF0ZSwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHRoaXMuI2FjY3VtU2FtcGxlID0gMDsKICAgIHRoaXMuI2FjY3VtQXZnVmFsdWUgPSAwOwogIH0KCiAgI2NoZWNrRmluYWxTYW1wbGUoKSB7CiAgICAvLyB0aGlzLnBvcnQub25tZXNzYWdlID0gKCkgPT4gewogICAgaWYgKHRoaXMuI2dvdFNpbGVuY2UgPT09IHRydWUpIHsKICAgICAgdGhpcy4jZ290U2lsZW5jZSA9IGZhbHNlOwogICAgICB0aGlzLiNzdG9wTWFya2VyID0gY3VycmVudEZyYW1lIC8gc2FtcGxlUmF0ZTsKICAgICAgaWYgKHRoaXMuI3N0b3BNYXJrZXIgLSB0aGlzLiNzdGFydE1hcmtlciA+IHRoaXMuI0NVVE9GRl9TRUMpIHsKICAgICAgICB0aGlzLnBvcnQucG9zdE1lc3NhZ2UoewogICAgICAgICAgaXNMYXN0OiB0cnVlLAogICAgICAgICAgc3RhcnQ6IHRoaXMuI3N0YXJ0TWFya2VyLAogICAgICAgICAgc3RvcDogdGhpcy4jc3RvcE1hcmtlciwKICAgICAgICAgIGR1cmF0aW9uOiB0aGlzLiNzdG9wTWFya2VyIC0gdGhpcy4jc3RhcnRNYXJrZXIsCiAgICAgICAgICBwcm9ncmVzczogewogICAgICAgICAgICBwZXJjZW50OiAoY3VycmVudEZyYW1lIC8gdGhpcy5kdXJhdGlvbkZyYW1lKSAqIDEwMCwKICAgICAgICAgICAgdGltZUxlZnQ6ICh0aGlzLmR1cmF0aW9uRnJhbWUgLSBjdXJyZW50RnJhbWUpIC8gc2FtcGxlUmF0ZSwKICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wb3J0LnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGlzTGFzdDogdHJ1ZSwKICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5wb3J0LnBvc3RNZXNzYWdlKHsKICAgICAgICBpc0xhc3Q6IHRydWUsCiAgICAgIH0pOwogICAgfQogICAgLy8gfTsKICB9CgogIHByb2Nlc3MoaW5wdXRzKSB7CiAgICB0cnkgewogICAgICBjb25zdCBjaCA9IGlucHV0c1swXTsKICAgICAgY29uc3Qgc2FtcGxlTGVuZ3RoID0gTWF0aC5tYXgoLi4uY2gubWFwKChjKSA9PiBjLmxlbmd0aCkpOwogICAgICAvLyBhdmVyYWdlIHRoaXMgc2FtcGxlIGJhdGNoIHRvIHNlZSBpZiBjYW4gYmUgY3V0CiAgICAgIGxldCB0b3RhbENoQXZnID0gMDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaC5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IHNhbXBsZXMgPSBjaFtpXTsKICAgICAgICBjb25zdCBhdmdWYWwgPQogICAgICAgICAgc2FtcGxlcy5yZWR1Y2UoKGFjYywgdmFsKSA9PiBhY2MgKyB2YWwsIDApIC8gc2FtcGxlcy5sZW5ndGg7CiAgICAgICAgdG90YWxDaEF2ZyArPSBhdmdWYWw7CiAgICAgIH0KICAgICAgdG90YWxDaEF2ZyA9IHRvdGFsQ2hBdmcgLyBjaC5sZW5ndGg7CgogICAgICB0aGlzLiNhY2N1bUF2Z1ZhbHVlICs9IHRvdGFsQ2hBdmc7CiAgICAgIHRoaXMuI2FjY3VtU2FtcGxlICs9IHNhbXBsZUxlbmd0aDsKCiAgICAgIGlmICh0aGlzLiNhY2N1bVNhbXBsZSA+PSB0aGlzLiNBVkdfRlJBTUUpIHsKICAgICAgICBpZiAoY3VycmVudEZyYW1lID4gdGhpcy5kdXJhdGlvbkZyYW1lKSB7CiAgICAgICAgICB0aGlzLiNjaGVja0ZpbmFsU2FtcGxlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuI2NoZWNrU2FtcGxlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGlmICh0aGlzLmEgPT09IDApIHsKICAgICAgICB0aGlzLnBvcnQucG9zdE1lc3NhZ2UoeyBlIH0pOwogICAgICAgIHRoaXMuYSsrOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZGlzY29ubmVjdCgpOwogICAgICAgIHRoaXMucG9ydC5jbG9zZSgpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsgLy8gS2VlcCB0aGUgcHJvY2Vzc29yIGFsaXZlCiAgfQp9CgpyZWdpc3RlclByb2Nlc3NvcigiYXVkaW8tYXV0b3RyaW0iLCBBdWRpb0F1dG9UcmltKTsK";var re,tt,ni,Gs,Fi,Fs,Ms,ks,Ns,Ls,Bs,ne,si,Os,Ds;const hi=class hi{constructor(t){dt(this,tt);$(this,"id",di());$(this,"isBackground",!1);$(this,"isMuted",!1);$(this,"isHidden",!1);$(this,"src");$(this,"type");$(this,"node");$(this,"tlContent");$(this,"srcElement");$(this,"originalW");$(this,"originalH");$(this,"attcAudioElement");$(this,"fileChunks");dt(this,re);$(this,"tlLayerParent");ct(this,re,t)}async create(t){return await q(this,tt,ni).call(this,t),this}async clone(t,{fileChunks:u,...f},m){return this.src=t,this.fileChunks=u,m&&(this.tlLayerParent=m),await q(this,tt,ni).call(this,f),this}async split(t,u=!0){return new Promise(f=>{if(!this.tlContent)return;const{tlStart:m,tlEnd:o,trimDuration:n,trimStart:i}=q(this,tt,ne).call(this);t&&window.editor.playHead.positionSec(+m+t);const c=window.editor.playHead.positionSec();c>+m&&c<+o&&this.getDataObject().then(l=>new hi(g=>{const v=c-Ft(Jt(this.tlContent.element.style.left)),C=Ct(c).toString();this.tlContent.dataset("tlEnd",C);const d=+n-(+n-v);this.tlContent.dataset("trimEnd",`${Ct(+i+d)}`),this.tlContent.dataset("trimDuration",`${Ct(d)}`),this.tlContent.element.style.width=`${It(+this.tlContent.dataset("trimDuration"))}px`,g.tlContent.dataset("tlStart",C),g.tlContent.dataset("trimStart",`${Ct(+i+v)}`),g.tlContent.dataset("trimDuration",`${Ct(+n-v)}`),g.tlContent.element.style.left=`${It(c)}px`,g.tlContent.element.style.width=`${It(+g.tlContent.dataset("trimDuration"))}px`,f(g)}).clone(this.src,l,this.tlContent.tlLayerParent)).then(l=>{u&&window.editor.myProject.nodes.push(l)})})}async getDataObject(){return{id:this.id,tlLayerCount:this.tlContent&&this.tlContent.getParentTlLayerCount(),type:this.type,fileChunks:this.fileChunks,timeline:q(this,tt,ne).call(this),node:this.node&&this.node.toObject(),isBackground:this.isBackground,isHidden:this.isHidden,isMuted:this.isMuted}}async populate({id:t,...u},f){return f&&(this.tlLayerParent=f),this.id=t,await q(this,tt,ni).call(this,u),this}transformerBlur(){this.tlContent&&this.tlContent.element.classList.remove("focus"),window.editor.myProject.transformer.nodes([]),window.editor.myProject.transformer.hide()}updateNodeSize(t){if(!this.node||!this.originalH||!this.originalW)return;const u=(t==null?void 0:t.w)||this.originalW,f=(t==null?void 0:t.h)||this.originalH;this.originalW=u,this.originalH=f;const m=1/window.editor.myProject.canvasPixelRatio;this.node.width(u*m),this.node.height(f*m)}delete(){window.editor.myProject.transformer.hide(),this.srcElement&&(this.srcElement.src="",this.srcElement.remove()),this.attcAudioElement&&(this.attcAudioElement.src="",this.attcAudioElement.remove()),this.tlContent&&this.tlContent.element.remove(),this.node&&this.node.destroy();const t=window.editor.myProject.nodes.findIndex(u=>u.id===this.id);window.editor.myProject.nodes.splice(t,1)}toggleMute(t){t!==void 0?this.isMuted=t:this.isMuted=!this.isMuted,this.attcAudioElement&&(this.attcAudioElement.muted=this.isMuted)}toggleHide(t){t!==void 0&&(this.isHidden=!t),this.isHidden?(this.isHidden=!1,window.editor.myProject.transformer.show(),this.node&&this.node.show(),this.tlContent&&this.tlContent.element.classList.remove("hide")):(this.isHidden=!0,window.editor.myProject.transformer.hide(),this.node&&this.node.hide(),this.tlContent&&this.tlContent.element.classList.add("hide"))}duplicate(){this.getDataObject().then(t=>new hi().clone(this.src,t)).then(t=>{window.editor.myProject.nodes.push(t)})}hasAudio(){return!(this.isMuted||this.isHidden||!(this.attcAudioElement||this.type==="audio"))}async getTrimmedAudioBuffer(t){const u=new AudioContext;return await u.audioWorklet.addModule(pa),new Promise((f,m)=>{const o=u.createMediaElementSource(new Audio(this.src)),{trimStart:n,tlStart:i,trimDuration:c}=q(this,tt,ne).call(this),l=new AudioWorkletNode(u,"audio-decode",{processorOptions:{durationSec:+c}});o.connect(l);const g=u.sampleRate,v=Math.round(window.editor.myProject.getProjectDuration()*g),C=new AudioBuffer({length:v,numberOfChannels:2,sampleRate:g});let d=Math.round(+i*g)||0;const a=(t==null?void 0:t.textContent)||"";l.port.onmessage=p=>{const{audioBuf:b,isLast:I,sampleSize:r,progress:e}=p.data;t&&e&&(t.textContent=`${a} - ${Math.round(e.percent)}%`);for(let y=0;y<b.length;y++)C.copyToChannel(b[y],y,d);d+=r,I&&(o.mediaElement.pause(),l.disconnect(),o.disconnect(),f(C))},l.onprocessorerror=()=>{m("onprocessorerror")},l.port.onmessageerror=()=>{m("onmessageerror")},u.state==="suspended"&&u.resume(),o.mediaElement.currentTime=+n||0,o.mediaElement.play()})}async autoTrim(){const t=new AudioContext,u=t.createMediaElementSource(new Audio(this.src));await t.audioWorklet.addModule(ya);const{trimStart:f,trimDuration:m,tlStart:o}=q(this,tt,ne).call(this),n=new AudioWorkletNode(t,"audio-autotrim",{processorOptions:{durationSec:+m}});u.connect(n);const i=a=>{console.error(a),u.mediaElement.pause(),u.disconnect(),n.disconnect(),n.port.close()};n.onprocessorerror=i,n.port.onmessageerror=i;const c=this.tlContent.tlLayerParent,l=[],g=c.setIsProcessing(!0),v="this layer is auto-trimming.. do not disturb.";g.textContent=v,u.mediaElement.currentTime=+f;let C,d;n.port.onmessage=async({data:{start:a,duration:p,isLast:b,progress:I}})=>{if(console.log({isLast:b}),a&&p&&(window.editor.playHead.positionSec(+o+a),C=d?await d.split(void 0,!1):await this.split(void 0,!1),d=await C.split(p,!1),C.delete(),l.push(d)),I&&(g.textContent=`${v} Est time:${Pi(I.timeLeft)} - ${Ct(I.percent)}%`),b&&u.mediaElement.paused===!1){C&&C.delete();const r=l.filter(e=>+e.tlContent.dataset("trimDuration")<=.1?(e.delete(),!1):(window.editor.myProject.nodes.push(e),!0));for(let e=0;e<r.length;e++)await r[e].moveToTimeline(e===0?0:+r[e-1].tlContent.dataset("tlEnd"));console.log("done"),c.setIsProcessing(!1),u.mediaElement.pause(),u.disconnect(),n.disconnect(),t.close()}},console.log("playy"),u.mediaElement.play()}moveToTimeline(t,u=.05){return new Promise(f=>{const{tlStart:m,tlEnd:o,trimStart:n,trimEnd:i}=q(this,tt,ne).call(this),c=t-+m,l=t-u,g=+o+c+u;this.tlContent.dataset("tlStart",l.toString()),this.tlContent.dataset("tlEnd",g.toString()),this.tlContent.dataset("trimStart",(+n-u).toString()),this.tlContent.dataset("trimEnd",(+i+u).toString()),this.tlContent.dataset("trimDuration",(g-l).toString()),this.tlContent.element.style.left=`${It(l)}px`,this.tlContent.element.style.width=`${It(g-l)}px`,f(!0)})}};re=new WeakMap,tt=new WeakSet,ni=async function({fileChunks:t,type:u,node:f,timeline:m,isBackground:o,isHidden:n,isMuted:i}){if(this.type=u,t){this.fileChunks=t;const c=t[0].toString().split("-")[0],l=window.blobUrls[c];if(l)this.src=l;else{const g=await Je.getFile(t);this.src=URL.createObjectURL(g),window.blobUrls[c]=this.src}}this.src&&q(this,tt,Gs).call(this,m,{isHidden:n,isBackground:o,isMuted:i}),q(this,tt,Ns).call(this,f)},Gs=function(t,u){switch(this.type){case"audio":this.srcElement=q(this,tt,Fi).call(this);break;case"video":this.srcElement=q(this,tt,Fs).call(this);break}return q(this,tt,Ms).call(this,t,u),this.srcElement},Fi=function(){const t=document.createElement("audio");return t.muted=!1,t.autoplay=!1,t.setAttribute("autoplay","false"),t.src=this.src,t.pause(),t},Fs=function(){const t=document.createElement("video");return t.width=100,t.height=100,t.muted=!0,t.autoplay=!1,t.setAttribute("autoplay","false"),t.src=this.src,t.pause(),this.attcAudioElement=q(this,tt,Fi).call(this),t},Ms=function(t,u){this.srcElement&&(this.srcElement.addEventListener("timeupdate",()=>{this.isHidden||this.type==="video"&&this.srcElement instanceof HTMLVideoElement&&this.node instanceof Mt.Image&&this.node.image()===void 0&&this.node.image(this.srcElement)}),oe.open("Loading media into timeline..."),this.srcElement.addEventListener("loadeddata",async()=>{if(this.type==="video"&&this.srcElement instanceof HTMLVideoElement){const f=this.srcElement.videoWidth,m=this.srcElement.videoHeight;this.srcElement.style.width=`${f}px`,this.srcElement.style.height=`${m}px`,t||(this.originalH=m,this.originalW=f,this.updateNodeSize({w:f,h:m}))}this.tlContent=new Cr(this.id,this.srcElement,t,this.tlLayerParent),q(this,tt,ks).call(this),q(this,tt,Bs).call(this),window.editor.myProject.layers.static.add(this.node),oe.close(),u&&(u.isMuted!==void 0&&this.toggleMute(u.isMuted),u.isHidden!==void 0&&this.toggleHide(u.isHidden),this.isBackground=u.isBackground!==void 0&&u.isBackground,this.isBackground&&this.node.moveToBottom()),Z(this,re)&&Z(this,re).call(this,this)},{once:!0}))},ks=function(){this.tlContent&&(this.tlContent.element.addEventListener("focus",()=>{this.isBackground===!1&&q(this,tt,si).call(this)}),this.tlContent.element.addEventListener("blur",()=>this.transformerBlur()))},Ns=function(t){if(t)switch(t.className){case"Image":this.node=new Mt.Image({id:this.id,draggable:!0,name:"node",image:this.srcElement,...t.attrs});break;case"Rect":this.node=new Mt.Rect({id:this.id,draggable:!0,name:"node",...t.attrs});break;default:this.node=Mt.Node.create(t);break}else switch(this.type){case"video":this.node=new Mt.Image({id:this.id,draggable:!0,name:"node",image:this.srcElement});break;default:this.node=new Mt.Rect({id:this.id,draggable:!0,name:"node"})}return q(this,tt,Ls).call(this),this.node},Ls=function(){this.node&&(this.node.on("pointerdown",t=>{t.target===this.node&&q(this,tt,si).call(this)}),this.node.on("contextmenu",t=>{var u;t.evt.preventDefault(),t.target===this.node&&ls.open([{title:"deselect",cb:()=>this.transformerBlur(),skip:!((u=this.tlContent)!=null&&u.element.classList.contains("focus"))},{title:"duplicate",cb:()=>this.duplicate()},{title:"attach to background",cb:()=>q(this,tt,Os).call(this),skip:this.type==="audio"||this.isBackground},{title:"detach from background",cb:()=>q(this,tt,Ds).call(this),skip:this.type==="audio"||!this.isBackground},{title:"delete",cb:()=>this.delete()}],t.evt.clientX,t.evt.clientY)}))},Bs=function(){window.editor.playHead.element.addEventListener("playheadplay",()=>{!this.attcAudioElement||!this.srcElement||(this.srcElement.paused&&this.srcElement.play().catch(()=>{}),this.attcAudioElement.currentTime=this.srcElement.currentTime,this.attcAudioElement.paused&&this.attcAudioElement.play().catch(()=>{}))}),window.editor.playHead.element.addEventListener("playheadstop",()=>{!this.attcAudioElement||!this.srcElement||(this.srcElement.paused===!1&&this.srcElement.pause(),this.attcAudioElement.currentTime=this.srcElement.currentTime,this.attcAudioElement.paused===!1&&this.attcAudioElement.pause())});let t=0;window.editor.playHead.element.addEventListener("positionupdate",u=>{var o;const{positionSec:f,isOnTlClick:m}=u.detail;if(m&&(t=0),!!this.srcElement)if(this.tlContent&&f>=+this.tlContent.element.dataset.tlStart&&f<=+this.tlContent.element.dataset.tlEnd&&this.isHidden===!1){if(this.srcElement.currentTime>=+this.tlContent.element.dataset.trimStart&&this.srcElement.currentTime<=+this.tlContent.element.dataset.trimEnd){const n=+this.tlContent.element.dataset.trimStart+(f-+this.tlContent.element.dataset.tlStart);this.srcElement.currentTime=n,window.editor.playHead.isPlaying&&t===0&&(this.srcElement.paused&&this.srcElement.play().catch(()=>{}),this.attcAudioElement&&(this.attcAudioElement.currentTime=this.srcElement.currentTime,this.attcAudioElement.paused&&this.attcAudioElement.play().catch(()=>{}))),t++}else this.srcElement.currentTime=+((o=this.tlContent)==null?void 0:o.element.dataset.trimStart);this.node&&this.node.isVisible()===!1&&this.node.show()}else this.srcElement.paused===!1&&this.srcElement.pause(),this.attcAudioElement&&this.attcAudioElement.paused===!1&&this.attcAudioElement.pause(),t=0,this.node&&this.node.isVisible()===!0&&this.node.hide()})},ne=function(){return this.tlContent&&this.tlContent.getAllDataset()},si=function(){if(this.tlContent){for(const t of this.tlContent.element.parentElement.parentElement.querySelectorAll(".focus"))t.classList.remove("focus");this.tlContent.element.classList.add("focus")}this.isBackground===!1?(this.node&&(window.editor.myProject.transformer.nodes([this.node]),this.node.moveToTop()),window.editor.myProject.transformer.moveToTop(),window.editor.myProject.transformer.show()):this.node&&this.node.moveToBottom()},Os=function(){if(window.editor.myProject.transformer.hide(),this.isBackground=!0,this.node){this.node.setAttrs({x:0,y:0,rotation:0,scale:{x:1,y:1}});const t=this.node.width(),u=this.node.height(),{orientation:f}=is(t,u),{height:m,width:o}=window.editor.myProject.getCanvasSize();switch(f){case"LANDSCAPE":{const n=m/u;this.node.setAttrs({dragBoundFunc:({x:i})=>({x:i,y:0}),width:t*n,height:m});break}case"POTRAIT":{const n=o/t;this.node.setAttrs({dragBoundFunc:({y:i})=>({x:0,y:i}),width:o,height:u*n});break}}this.node.moveToBottom()}},Ds=function(){if(this.isBackground=!1,this.updateNodeSize(),q(this,tt,si).call(this),this.node){const{height:t,width:u}=window.editor.myProject.getCanvasSize();this.node.setAttrs({dragBoundFunc:void 0,x:(u-this.node.width())/2,y:(t-this.node.height())/2})}};let ri=hi;const Ei=.8;var Et,ae,Pt,Mi,Vs,ki,Us;class Zn{constructor(){dt(this,Pt);dt(this,Et);$(this,"width");$(this,"height");$(this,"nodes");$(this,"stage");$(this,"layers");$(this,"transformer");dt(this,ae);$(this,"canvasPixelRatio");$(this,"isLoadFromPersisted",!1);ct(this,Et,ga.facebook.options[1]),this.width=Z(this,Et).width,this.height=Z(this,Et).height,this.nodes=[];const{canvasPixelRatio:t,...u}=this.getCanvasSize();ct(this,ae,u),this.canvasPixelRatio=t,this.stage=new Mt.Stage({container:"editor-preview",...Z(this,ae)}),this.layers={static:new Mt.Layer({id:"static-layer"}),dragging:Qt},this.transformer=new Mt.Transformer({rotationSnaps:(()=>{const f=[];for(let m=0;m<360;m++)m%45===0&&f.push(m);return f})()}),q(this,Pt,Mi).call(this)}async initPopulate(t){this.isLoadFromPersisted=!0,ct(this,Et,t==null?void 0:t.presetSize),this.width=t==null?void 0:t.width,this.height=t==null?void 0:t.height;const u={};t==null||t.nodes.forEach(m=>{u[m.tlLayerCount]=[...u[m.tlLayerCount]||[],m]});const f=Object.values(u);for(let m=0;m<f.length;m++){const o=f[m],n=new cs([]);for(let i=0;i<o.length;i++){const c=await new ri().populate(o[i],n);this.nodes.push(c)}}return q(this,Pt,Mi).call(this),this}save(t=!0){const u=document.getElementById("editor-save");u.disabled=!0,oe.open("saving in progress... do not refresh"),q(this,Pt,Vs).call(this).then(f=>rs.update(f,1)).finally(()=>{t&&oe.close(),u.disabled=!1,console.log("saved")}).catch(console.error)}recalculateCanvasSize(){this.width=Z(this,Et).width,this.height=Z(this,Et).height;const{canvasPixelRatio:t,...u}=this.getCanvasSize();ct(this,ae,u),this.canvasPixelRatio=t,this.stage.width(u.width),this.stage.height(u.height),Object.values(this.layers).forEach(f=>{f.getCanvas().setPixelRatio(t)}),window.editor.myProject.nodes.forEach(f=>{f.updateNodeSize()}),window.editor.myProject.stage.draw()}presetSize(t){return t&&(ct(this,Et,t),this.recalculateCanvasSize()),Z(this,Et)}getCanvasSize(){const{aspectRatio:t,orientation:u}=is(this.width,this.height),f=document.getElementById("editor-panel").getBoundingClientRect();let m=Math.round(f.height*Ei),o=Math.round(m*t);return o>f.width*Ei&&(o=Math.round(f.width*Ei),m=Math.round(o/t)),{width:o,height:m,canvasPixelRatio:this.width/o,aspectRatio:t,orientation:u}}insertNodeFromFile(t){if(!t.metadata.type.startsWith("video/")){console.log("temporaryly not supported");return}new ri().create({fileChunks:t.chunks,type:"video"}).then(u=>{this.nodes.push(u)})}async getVideoMetadataFromFile(t){return new Promise(u=>{const f=document.createElement("video");f.src=t,f.addEventListener("seeked",async()=>{f.frame=await q(this,Pt,ki).call(this,f),u(f)},{once:!0}),f.addEventListener("loadeddata",()=>{f.currentTime=1},{once:!0})})}async getImageMetadataFromFile(t){return new Promise(u=>{const f=document.createElement("img");f.src=t,f.addEventListener("load",async()=>{f.frame=await q(this,Pt,ki).call(this,f),u(f)})})}getTLSnapPoints(t){let u=[];return document.getElementById("timeline-content-wrapper").querySelectorAll(".timeline-layer").forEach(f=>{for(const m of f.children){if(t===m.id)return;const{tlStart:o,tlEnd:n}=m.dataset;u=[...u,It(+o),It(+n)]}}),u}getProjectDuration(){const t=q(this,Pt,Us).call(this);let u=0;for(const f of t)if(!f.classList.contains("hide"))for(const m of f.children)u=Math.max(u,+(m.dataset.tlEnd||0));return u}async exportVideo(t=30){(await Ii(()=>import("./export-video-B3eK1NXg.js"),[]).then(f=>f.default))(t)}}Et=new WeakMap,ae=new WeakMap,Pt=new WeakSet,Mi=function(){Object.values(this.layers).forEach(t=>{t.getCanvas().setPixelRatio(this.canvasPixelRatio),this.stage.add(t)}),this.layers.dragging.add(this.transformer)},Vs=async function(){const t=await Promise.all(this.nodes.map(u=>u.getDataObject()));return{presetSize:Z(this,Et),width:this.width,height:this.height,nodes:t}},ki=function(t){return new Promise(u=>{const f=document.createElement("canvas");f.width=t instanceof HTMLVideoElement?t.videoWidth:t.width,f.height=t instanceof HTMLVideoElement?t.videoHeight:t.height,f.getContext("2d").drawImage(t,0,0,f.width,f.height),u(f.toDataURL("image/webp",.1))})},Us=function(){return document.querySelectorAll('[id|="timeline-layer"].timeline-layer')};var Ut,li,Hs;class _a{constructor(){dt(this,li);$(this,"element");dt(this,Ut);$(this,"isPlaying",!1);this.element=document.getElementById("timeline-playhead"),q(this,li,Hs).call(this)}play(t){if(window.editor.myProject.transformer.hide(),Z(this,Ut))this.stop();else{let u=performance.now();t!==void 0&&this.positionSec(t);const f=document.getElementById("playhead-dur"),m=document.getElementById("proj-dur"),o=document.getElementById("play-btn"),n=window.editor.myProject.getProjectDuration();this.positionSec()>n&&this.positionSec(0),o.setAttribute("title","pause"),o.replaceChild($e(Qn),o.firstElementChild),m.textContent=Pi(n);const i=c=>{const l=this.positionSec();if(l>=n)return this.stop();const g=this.positionSec(l+(c-u)/1e3);u=c,f.textContent=Pi(g),ct(this,Ut,requestAnimationFrame(i))};ct(this,Ut,requestAnimationFrame(i)),this.isPlaying=!0,this.element.dispatchEvent(new Event("playheadplay"))}}stop(){Z(this,Ut)&&cancelAnimationFrame(Z(this,Ut)),ct(this,Ut,void 0);const t=document.getElementById("play-btn");this.isPlaying=!1,this.element.dispatchEvent(new Event("playheadstop")),t.setAttribute("title","play"),t.replaceChild($e(ts),t.firstElementChild)}positionPx(t,u=!1){t!==void 0&&(this.element.style.left=`${t}px`);const f=Jt(this.element.style.left);return this.element.dispatchEvent(new CustomEvent("positionupdate",{detail:{positionPx:f,positionSec:Ft(f),isOnTlClick:u}})),window.editor.myProject.stage.draw(),f}positionSec(t){return Ft(this.positionPx(t!==void 0?It(t):void 0))}}Ut=new WeakMap,li=new WeakSet,Hs=function(){const t=this.element.parentElement,u=f=>{const m=f.target;(["timeline","timeline-strip"].includes(m.id)||m.classList.contains("timeline-layer"))&&this.positionPx((m.id==="timeline"?t.scrollLeft:0)+f.offsetX,!0)};t.addEventListener("click",u),t.addEventListener("scroll",()=>{this.element.style.top=`${t.scrollTop}px`})};const va="0.0.0",Ca={version:va};window.onload=()=>{const s=document.createElement("p");s.textContent="preparing workspace...",oe.open(s),window.editor={VERSION:Ca.version,myProject:new Zn,audioContext:new AudioContext,playHead:new _a,DEBUG_RESET_DB:()=>{window.indexedDB.databases().then(t=>{t.forEach(u=>{window.indexedDB.deleteDatabase(u.name)})}).then(()=>{console.log("DB reset success")})}},Ii(()=>import("./index-5DIdEHWt.js"),__vite__mapDeps([0,1])),Ii(()=>import("./timeline-init-D0-9cywO.js"),[]),ti.connect("mydb",1).then(()=>(s.textContent="checking snapshot...",rs.findById(1))).then(({data:t})=>{if(t&&t.nodes.length>0)return s.textContent="loading snapshot... ",new Zn().initPopulate(t)}).then(t=>{t&&(window.editor.myProject=t)}).catch(t=>{console.error(t),alert("Issue accessing your IndexDB.. try refreshing the page")}).finally(()=>{window.editor.myProject.isLoadFromPersisted||oe.close()})};export{Je as F,er as M,ga as P,Ze as T,Aa as U,hr as W,$e as a,Jt as b,ls as c,Pi as d,fa as e,oe as f,wa as g,Sa as m,Ft as p};
